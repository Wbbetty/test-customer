(function(e){function t(t){for(var o,r,a=t[0],c=t[1],u=t[2],l=0,p=[];l<a.length;l++)r=a[l],Object.prototype.hasOwnProperty.call(i,r)&&i[r]&&p.push(i[r][0]),i[r]=0;for(o in c)Object.prototype.hasOwnProperty.call(c,o)&&(e[o]=c[o]);f&&f(t);while(p.length)p.shift()();return s.push.apply(s,u||[]),n()}function n(){for(var e,t=0;t<s.length;t++){for(var n=s[t],o=!0,r=1;r<n.length;r++){var a=n[r];0!==i[a]&&(o=!1)}o&&(s.splice(t--,1),e=c(c.s=n[0]))}return e}var o={},r={app:0},i={app:0},s=[];function a(e){return c.p+"js/"+({}[e]||e)+"."+{"chunk-4771dd73":"a894f9ff","chunk-2265b2f0":"aa254f69","chunk-227fd1dc":"ede1f7b7","chunk-2d7026f2":"aa095e58","chunk-f197b63e":"06627ab0","chunk-a404a7dc":"0dd5a778"}[e]+".js"}function c(t){if(o[t])return o[t].exports;var n=o[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,c),n.l=!0,n.exports}c.e=function(e){var t=[],n={"chunk-2265b2f0":1,"chunk-227fd1dc":1,"chunk-2d7026f2":1,"chunk-f197b63e":1,"chunk-a404a7dc":1};r[e]?t.push(r[e]):0!==r[e]&&n[e]&&t.push(r[e]=new Promise((function(t,n){for(var o="css/"+({}[e]||e)+"."+{"chunk-4771dd73":"31d6cfe0","chunk-2265b2f0":"59825a41","chunk-227fd1dc":"7014c242","chunk-2d7026f2":"045045eb","chunk-f197b63e":"2a2d2c26","chunk-a404a7dc":"08706079"}[e]+".css",i=c.p+o,s=document.getElementsByTagName("link"),a=0;a<s.length;a++){var u=s[a],l=u.getAttribute("data-href")||u.getAttribute("href");if("stylesheet"===u.rel&&(l===o||l===i))return t()}var p=document.getElementsByTagName("style");for(a=0;a<p.length;a++){u=p[a],l=u.getAttribute("data-href");if(l===o||l===i)return t()}var f=document.createElement("link");f.rel="stylesheet",f.type="text/css",f.onload=t,f.onerror=function(t){var o=t&&t.target&&t.target.src||i,s=new Error("Loading CSS chunk "+e+" failed.\n("+o+")");s.code="CSS_CHUNK_LOAD_FAILED",s.request=o,delete r[e],f.parentNode.removeChild(f),n(s)},f.href=i;var d=document.getElementsByTagName("head")[0];d.appendChild(f)})).then((function(){r[e]=0})));var o=i[e];if(0!==o)if(o)t.push(o[2]);else{var s=new Promise((function(t,n){o=i[e]=[t,n]}));t.push(o[2]=s);var u,l=document.createElement("script");l.charset="utf-8",l.timeout=120,c.nc&&l.setAttribute("nonce",c.nc),l.src=a(e);var p=new Error;u=function(t){l.onerror=l.onload=null,clearTimeout(f);var n=i[e];if(0!==n){if(n){var o=t&&("load"===t.type?"missing":t.type),r=t&&t.target&&t.target.src;p.message="Loading chunk "+e+" failed.\n("+o+": "+r+")",p.name="ChunkLoadError",p.type=o,p.request=r,n[1](p)}i[e]=void 0}};var f=setTimeout((function(){u({type:"timeout",target:l})}),12e4);l.onerror=l.onload=u,document.head.appendChild(l)}return Promise.all(t)},c.m=e,c.c=o,c.d=function(e,t,n){c.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},c.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.t=function(e,t){if(1&t&&(e=c(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(c.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)c.d(n,o,function(t){return e[t]}.bind(null,o));return n},c.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return c.d(t,"a",t),t},c.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},c.p="/",c.oe=function(e){throw console.error(e),e};var u=window["webpackJsonp"]=window["webpackJsonp"]||[],l=u.push.bind(u);u.push=t,u=u.slice();for(var p=0;p<u.length;p++)t(u[p]);var f=l;s.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"29f5":function(e,t,n){"use strict";n("79ef")},"56d7":function(e,t,n){"use strict";n.r(t);var o=n("2b0e"),r=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"app"}},[t("router-view")],1)},i=[],s={name:"App"},a=s,c=(n("29f5"),n("2877")),u=Object(c["a"])(a,r,i,!1,null,null,null),l=u.exports,p=n("8c4f");o["a"].use(p["a"]);const f=p["a"].prototype.push;p["a"].prototype.push=function(e){return f.call(this,e).catch(e=>e)};const d=new p["a"]({routes:[{path:"/agent",component:()=>Promise.all([n.e("chunk-4771dd73"),n.e("chunk-f197b63e")]).then(n.bind(null,"b548")),meta:{title:"客服",keepAlive:!1},children:[{path:"conversations",component:()=>n.e("chunk-a404a7dc").then(n.bind(null,"1567")),meta:{title:"会话",keepAlive:!1},children:[{path:"chat",component:()=>Promise.all([n.e("chunk-4771dd73"),n.e("chunk-2265b2f0")]).then(n.bind(null,"1054")),meta:{title:"聊天",keepAlive:!1}}]},{path:"customers",component:()=>Promise.all([n.e("chunk-4771dd73"),n.e("chunk-227fd1dc")]).then(n.bind(null,"ee3d")),meta:{title:"联系人",keepAlive:!1}}]},{path:"/customer",component:()=>Promise.all([n.e("chunk-4771dd73"),n.e("chunk-2d7026f2")]).then(n.bind(null,"4800"))}]});var h=d,y=n("f264"),m=n.n(y);o["a"].config.productionTip=!1;const v=m.a.getInstance({host:Object({NODE_ENV:"production",BASE_URL:"/"}).VUE_APP_ENV+"hangzhou.goeasy.io",appkey:"PC-66e2d0459383432293edf91fb915f249",modules:["im"]});o["a"].prototype.GoEasy=m.a,o["a"].prototype.goEasy=v,o["a"].prototype.im=v.im,o["a"].prototype.pubsub=v.pubsub,o["a"].prototype.global={},new o["a"]({router:h,render:e=>e(l)}).$mount("#app")},"79ef":function(e,t,n){},f264:function(e,t,n){(function(t,o,r){(function(t,n){e.exports=n()})(0,(function(){"use strict";var e="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof t?t:"undefined"!==typeof self?self:{};function i(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e["default"]:e}var s={},a={};(function(e){e.__esModule=!0,e.NetworkStatus=void 0,function(e){e["DISCONNECTED"]="disconnected",e["DISCONNECTING"]="disconnecting",e["CONNECTING"]="connecting",e["CONNECTED"]="connected",e["RECONNECTING"]="reconnecting",e["RECONNECTED"]="reconnected",e["EXPIRED_RECONNECTED"]="reconnected",e["CONNECT_FAILED"]="connect_failed"}(e.NetworkStatus||(e.NetworkStatus={}))})(a);var c={},u={},l={};(function(e){e.__esModule=!0,e.Permission=void 0,function(e){e["WRITE"]="WRITE",e["READ"]="READ",e["NONE"]="NONE"}(e.Permission||(e.Permission={}))})(l);var p={__esModule:!0,Emitter:void 0},f=a,d=function(){function e(e){this.socket=e}return e.prototype.emit=function(e){this.socket.status!==f.NetworkStatus.CONNECT_FAILED&&this.socket.status!==f.NetworkStatus.DISCONNECTED?(e.start(),this.doEmit(e)):e.fail({resultCode:"409",content:"Please connect first"})},e.prototype.doEmit=function(e){var t=this;if(e.isTimeout())e.fail({resultCode:408,content:"Host unreachable or timeout"});else if(this.socket.status!==f.NetworkStatus.CONNECT_FAILED)if(this.authenticated())if(this.hasPermission(e)){var n=[f.NetworkStatus.CONNECTED,f.NetworkStatus.RECONNECTED,f.NetworkStatus.EXPIRED_RECONNECTED];if(n.includes(this.socket.status)){if(!e.complete){var o=setTimeout((function(){t.doEmit(e)}),e.singleTimeout);e.unique&&(e.params.retried=e.retried),this.socket.doEmit(e.name,e.params,(function(t){clearTimeout(o),200===t.resultCode||200==t.code?e.success(t):e.fail(t)})),e.retried++}}else setTimeout((function(){t.doEmit(e)}),500)}else e.fail({resultCode:401,content:"No permission"});else setTimeout((function(){t.doEmit(e)}),500);else e.fail({resultCode:408,content:"Failed to connect GoEasy."})},e.prototype.hasPermission=function(e){return!!this.socket.permissions.find((function(t){return t===e.permission}))},e.prototype.authenticated=function(){var e=[f.NetworkStatus.CONNECTED,f.NetworkStatus.RECONNECTING,f.NetworkStatus.RECONNECTED,f.NetworkStatus.EXPIRED_RECONNECTED];return e.includes(this.socket.status)},e}();function h(e){return h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},h(e)}p.Emitter=d;var y={exports:{}},m=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,v=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],g=function(e){var t=e,n=e.indexOf("["),o=e.indexOf("]");-1!=n&&-1!=o&&(e=e.substring(0,n)+e.substring(n,o).replace(/:/g,";")+e.substring(o,e.length));var r=m.exec(e||""),i={},s=14;while(s--)i[v[s]]=r[s]||"";return-1!=n&&-1!=o&&(i.source=t,i.host=i.host.substring(1,i.host.length-1).replace(/;/g,":"),i.authority=i.authority.replace("[","").replace("]","").replace(/;/g,":"),i.ipv6uri=!0),i},b={exports:{}},S={exports:{}},E=1e3,_=60*E,C=60*_,w=24*C,M=365.25*w,T=function(e,t){t=t||{};var n=h(e);if("string"===n&&e.length>0)return I(e);if("number"===n&&!1===isNaN(e))return t["long"]?O(e):A(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))};function I(e){if(e=String(e),!(e.length>100)){var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(t){var n=parseFloat(t[1]),o=(t[2]||"ms").toLowerCase();switch(o){case"years":case"year":case"yrs":case"yr":case"y":return n*M;case"days":case"day":case"d":return n*w;case"hours":case"hour":case"hrs":case"hr":case"h":return n*C;case"minutes":case"minute":case"mins":case"min":case"m":return n*_;case"seconds":case"second":case"secs":case"sec":case"s":return n*E;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}}}function A(e){return e>=w?Math.round(e/w)+"d":e>=C?Math.round(e/C)+"h":e>=_?Math.round(e/_)+"m":e>=E?Math.round(e/E)+"s":e+"ms"}function O(e){return N(e,w,"day")||N(e,C,"hour")||N(e,_,"minute")||N(e,E,"second")||e+" ms"}function N(e,t,n){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+n:Math.ceil(e/t)+" "+n+"s"}(function(e,t){function n(e){var n,o=0;for(n in e)o=(o<<5)-o+e.charCodeAt(n),o|=0;return t.colors[Math.abs(o)%t.colors.length]}function o(e){var o;function i(){if(i.enabled){var e=i,n=+new Date,r=n-(o||n);e.diff=r,e.prev=o,e.curr=n,o=n;for(var s=new Array(arguments.length),a=0;a<s.length;a++)s[a]=arguments[a];s[0]=t.coerce(s[0]),"string"!==typeof s[0]&&s.unshift("%O");var c=0;s[0]=s[0].replace(/%([a-zA-Z%])/g,(function(n,o){if("%%"===n)return n;c++;var r=t.formatters[o];if("function"===typeof r){var i=s[c];n=r.call(e,i),s.splice(c,1),c--}return n})),t.formatArgs.call(e,s);var u=i.log||t.log||console.log.bind(console);u.apply(e,s)}}return i.namespace=e,i.enabled=t.enabled(e),i.useColors=t.useColors(),i.color=n(e),i.destroy=r,"function"===typeof t.init&&t.init(i),t.instances.push(i),i}function r(){var e=t.instances.indexOf(this);return-1!==e&&(t.instances.splice(e,1),!0)}function i(e){var n;t.save(e),t.names=[],t.skips=[];var o=("string"===typeof e?e:"").split(/[\s,]+/),r=o.length;for(n=0;n<r;n++)o[n]&&(e=o[n].replace(/\*/g,".*?"),"-"===e[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")));for(n=0;n<t.instances.length;n++){var i=t.instances[n];i.enabled=t.enabled(i.namespace)}}function s(){t.enable("")}function a(e){if("*"===e[e.length-1])return!0;var n,o;for(n=0,o=t.skips.length;n<o;n++)if(t.skips[n].test(e))return!1;for(n=0,o=t.names.length;n<o;n++)if(t.names[n].test(e))return!0;return!1}function c(e){return e instanceof Error?e.stack||e.message:e}t=e.exports=o.debug=o["default"]=o,t.coerce=c,t.disable=s,t.enable=i,t.enabled=a,t.humanize=T,t.instances=[],t.names=[],t.skips=[],t.formatters={}})(S,S.exports),function(e,t){function n(){return!("undefined"===typeof window||!window.process||"renderer"!==window.process.type)||("undefined"===typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!==typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!==typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))}function r(e){var n=this.useColors;if(e[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+e[0]+(n?"%c ":" ")+"+"+t.humanize(this.diff),n){var o="color: "+this.color;e.splice(1,0,o,"color: inherit");var r=0,i=0;e[0].replace(/%[a-zA-Z%]/g,(function(e){"%%"!==e&&(r++,"%c"===e&&(i=r))})),e.splice(i,0,o)}}function i(){return"object"===("undefined"===typeof console?"undefined":h(console))&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function s(e){try{null==e?t.storage.removeItem("debug"):t.storage.debug=e}catch(n){}}function a(){var e;try{e=t.storage.debug}catch(n){}return!e&&"undefined"!==typeof o&&"env"in o&&(e=Object({NODE_ENV:"production",BASE_URL:"/"}).DEBUG),e}function c(){try{return window.localStorage}catch(e){}}t=e.exports=S.exports,t.log=i,t.formatArgs=r,t.save=s,t.load=a,t.useColors=n,t.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:c(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.formatters.j=function(e){try{return JSON.stringify(e)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}},t.enable(a())}(b,b.exports);var k=g,R=b.exports("socket.io-client:url"),P=x;function x(e,t){var n=e;t=t||"undefined"!==typeof location&&location,null==e&&(e=t.protocol+"//"+t.host),"string"===typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?t.protocol+e:t.host+e),/^(https?|wss?):\/\//.test(e)||(R("protocol-less url %s",e),e="undefined"!==typeof t?t.protocol+"//"+e:"https://"+e),R("parse %s",e),n=k(e)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";var o=-1!==n.host.indexOf(":"),r=o?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+r+":"+n.port,n.href=n.protocol+"://"+r+(t&&t.port===n.port?"":":"+n.port),n}var D={},F={exports:{}};(function(e){function t(e){if(e)return n(e)}function n(e){for(var n in t.prototype)e[n]=t.prototype[n];return e}e.exports=t,t.prototype.on=t.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},t.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this},t.prototype.off=t.prototype.removeListener=t.prototype.removeAllListeners=t.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,o=this._callbacks["$"+e];if(!o)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var r=0;r<o.length;r++)if(n=o[r],n===t||n.fn===t){o.splice(r,1);break}return this},t.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),n=this._callbacks["$"+e];if(n){n=n.slice(0);for(var o=0,r=n.length;o<r;++o)n[o].apply(this,t)}return this},t.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},t.prototype.hasListeners=function(e){return!!this.listeners(e).length}})(F);var G={}.toString,U=Array.isArray||function(e){return"[object Array]"==G.call(e)};(function(e){var t=b.exports("socket.io-parser"),n=F.exports,o=U;function r(){}e.protocol=4,e.types=["CONNECT","DISCONNECT","EVENT","ACK","ERROR","BINARY_EVENT","BINARY_ACK"],e.CONNECT=0,e.DISCONNECT=1,e.EVENT=2,e.ACK=3,e.ERROR=4,e.BINARY_EVENT=5,e.BINARY_ACK=6,e.Encoder=r,e.Decoder=c;var i=e.ERROR+'"encode error"';function s(n){var o=""+n.type;if(e.BINARY_EVENT!==n.type&&e.BINARY_ACK!==n.type||(o+=n.attachments+"-"),n.nsp&&"/"!==n.nsp&&(o+=n.nsp+","),null!=n.id&&(o+=n.id),null!=n.data){var r=a(n.data);if(!1===r)return i;o+=r}return t("encoded %j as %s",n,o),o}function a(e){try{return JSON.stringify(e)}catch(t){return!1}}function c(){this.reconstructor=null}function u(n){var r=0,i={type:Number(n.charAt(0))};if(null==e.types[i.type])return p("unknown packet type "+i.type);if(e.BINARY_EVENT===i.type||e.BINARY_ACK===i.type){var s="";while("-"!==n.charAt(++r))if(s+=n.charAt(r),r==n.length)break;if(s!=Number(s)||"-"!==n.charAt(r))throw new Error("Illegal attachments");i.attachments=Number(s)}if("/"===n.charAt(r+1)){i.nsp="";while(++r){var a=n.charAt(r);if(","===a)break;if(i.nsp+=a,r===n.length)break}}else i.nsp="/";var c=n.charAt(r+1);if(""!==c&&Number(c)==c){i.id="";while(++r){a=n.charAt(r);if(null==a||Number(a)!=a){--r;break}if(i.id+=n.charAt(r),r===n.length)break}i.id=Number(i.id)}if(n.charAt(++r)){var u=l(n.substr(r)),f=!1!==u&&(i.type===e.ERROR||o(u));if(!f)return p("invalid payload");i.data=u}return t("decoded %s as %j",n,i),i}function l(e){try{return JSON.parse(e)}catch(t){return!1}}function p(t){return{type:e.ERROR,data:"parser error: "+t}}r.prototype.encode=function(e,t){var n=s(e);t([n])},n(c.prototype),c.prototype.add=function(e){var t;if("string"!==typeof e)throw new Error("Unknown type: "+e);t=u(e),this.emit("decoded",t)},c.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()}})(D);var L={exports:{}},j={},B={},q=Object.keys||function(e){var t=[],n=Object.prototype.hasOwnProperty;for(var o in e)n.call(e,o)&&t.push(o);return t},V=U,H=Object.prototype.toString,W="function"===typeof Blob||"undefined"!==typeof Blob&&"[object BlobConstructor]"===H.call(Blob),z="function"===typeof File||"undefined"!==typeof File&&"[object FileConstructor]"===H.call(File),J=X;function X(e){if(!e||"object"!==h(e))return!1;if(V(e)){for(var t=0,n=e.length;t<n;t++)if(X(e[t]))return!0;return!1}if("function"===typeof r&&r.isBuffer&&r.isBuffer(e)||"function"===typeof ArrayBuffer&&e instanceof ArrayBuffer||W&&e instanceof Blob||z&&e instanceof File)return!0;if(e.toJSON&&"function"===typeof e.toJSON&&1===arguments.length)return X(e.toJSON(),!0);for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)&&X(e[o]))return!0;return!1}var Y=Q;function Q(e,t,n){var o=!1;return n=n||K,r.count=e,0===e?t():r;function r(e,i){if(r.count<=0)throw new Error("after called too many times");--r.count,e?(o=!0,t(e),t=n):0!==r.count||o||t(null,i)}}function K(){}
/*! https://mths.be/utf8js v2.1.2 by @mathias */var $,Z,ee,te=String.fromCharCode;function ne(e){var t,n,o=[],r=0,i=e.length;while(r<i)t=e.charCodeAt(r++),t>=55296&&t<=56319&&r<i?(n=e.charCodeAt(r++),56320==(64512&n)?o.push(((1023&t)<<10)+(1023&n)+65536):(o.push(t),r--)):o.push(t);return o}function oe(e){var t,n=e.length,o=-1,r="";while(++o<n)t=e[o],t>65535&&(t-=65536,r+=te(t>>>10&1023|55296),t=56320|1023&t),r+=te(t);return r}function re(e,t){if(e>=55296&&e<=57343){if(t)throw Error("Lone surrogate U+"+e.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}function ie(e,t){return te(e>>t&63|128)}function se(e,t){if(0==(4294967168&e))return te(e);var n="";return 0==(4294965248&e)?n=te(e>>6&31|192):0==(4294901760&e)?(re(e,t)||(e=65533),n=te(e>>12&15|224),n+=ie(e,6)):0==(4292870144&e)&&(n=te(e>>18&7|240),n+=ie(e,12),n+=ie(e,6)),n+=te(63&e|128),n}function ae(e,t){t=t||{};var n,o=!1!==t.strict,r=ne(e),i=r.length,s=-1,a="";while(++s<i)n=r[s],a+=se(n,o);return a}function ce(){if(ee>=Z)throw Error("Invalid byte index");var e=255&$[ee];if(ee++,128==(192&e))return 63&e;throw Error("Invalid continuation byte")}function ue(e){var t,n,o,r,i;if(ee>Z)throw Error("Invalid byte index");if(ee==Z)return!1;if(t=255&$[ee],ee++,0==(128&t))return t;if(192==(224&t)){if(n=ce(),i=(31&t)<<6|n,i>=128)return i;throw Error("Invalid continuation byte")}if(224==(240&t)){if(n=ce(),o=ce(),i=(15&t)<<12|n<<6|o,i>=2048)return re(i,e)?i:65533;throw Error("Invalid continuation byte")}if(240==(248&t)&&(n=ce(),o=ce(),r=ce(),i=(7&t)<<18|n<<12|o<<6|r,i>=65536&&i<=1114111))return i;throw Error("Invalid UTF-8 detected")}function le(e,t){t=t||{};var n=!1!==t.strict;$=ne(e),Z=$.length,ee=0;var o,r=[];while(!1!==(o=ue(n)))r.push(o);return oe(r)}var pe={version:"2.1.2",encode:ae,decode:le},fe="undefined"!==typeof fe?fe:"undefined"!==typeof WebKitBlobBuilder?WebKitBlobBuilder:"undefined"!==typeof MSBlobBuilder?MSBlobBuilder:"undefined"!==typeof MozBlobBuilder&&MozBlobBuilder,de=function(){try{var e=new Blob(["hi"]);return 2===e.size}catch(t){return!1}}(),he=de&&function(){try{var e=new Blob([new Uint8Array([1,2])]);return 2===e.size}catch(t){return!1}}(),ye=fe&&fe.prototype.append&&fe.prototype.getBlob;function me(e){return e.map((function(e){if(e.buffer instanceof ArrayBuffer){var t=e.buffer;if(e.byteLength!==t.byteLength){var n=new Uint8Array(e.byteLength);n.set(new Uint8Array(t,e.byteOffset,e.byteLength)),t=n.buffer}return t}return e}))}function ve(e,t){t=t||{};var n=new fe;return me(e).forEach((function(e){n.append(e)})),t.type?n.getBlob(t.type):n.getBlob()}function ge(e,t){return new Blob(me(e),t||{})}"undefined"!==typeof Blob&&(ve.prototype=Blob.prototype,ge.prototype=Blob.prototype);var be=function(){return de?he?Blob:ge:ye?ve:void 0}();(function(e){var t=q,n=J,o=Y,r=pe;"undefined"!==typeof navigator&&/Android/i.test(navigator.userAgent),"undefined"!==typeof navigator&&/PhantomJS/i.test(navigator.userAgent),e.protocol=3;var i=e.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},s=t(i),a={type:"error",data:"parser error"},c=be;function u(e){try{e=r.decode(e,{strict:!1})}catch(t){return!1}return e}function l(e,t,n){for(var r=new Array(e.length),i=o(e.length,n),s=function(e,n,o){t(n,(function(t,n){r[e]=n,o(t,r)}))},a=0;a<e.length;a++)s(a,e[a],i)}e.encodePacket=function(e,t,n,o){"function"===typeof t&&(o=t,t=!1),"function"===typeof n&&(o=n,n=null),void 0===e.data||e.data.buffer||e.data;var s=i[e.type];return void 0!==e.data&&(s+=n?r.encode(String(e.data),{strict:!1}):String(e.data)),o(""+s)},e.decodePacket=function(e,t,n){if(void 0===e)return a;if("string"===typeof e){if(n&&(e=u(e),!1===e))return a;var o=e.charAt(0);return Number(o)==o&&s[o]?e.length>1?{type:s[o],data:e.substring(1)}:{type:s[o]}:a}var r=new Uint8Array(e),i=(o=r[0],sliceBuffer(e,1));return c&&"blob"===t&&(i=new c([i])),{type:s[o],data:i}},e.encodePayload=function(t,o,r){"function"===typeof o&&(r=o,o=null);var i=n(t);if(!t.length)return r("0:");function s(e){return e.length+":"+e}function a(t,n){e.encodePacket(t,!!i&&o,!0,(function(e){n(null,s(e))}))}l(t,a,(function(e,t){return r(t.join(""))}))},e.decodePayload=function(t,n,o){var r;if("function"===typeof n&&(o=n,n=null),""===t)return o(a,0,1);for(var i,s,c="",u=0,l=t.length;u<l;u++){var p=t.charAt(u);if(":"===p){if(""===c||c!=(i=Number(c)))return o(a,0,1);if(s=t.substr(u+1,i),c!=s.length)return o(a,0,1);if(s.length){if(r=e.decodePacket(s,n,!0),a.type===r.type&&a.data===r.data)return o(a,0,1);var f=o(r,u+i,l);if(!1===f)return}u+=i,c=""}else c+=p}return""!==c?o(a,0,1):void 0}})(B);var Se=B,Ee=F.exports,_e=Ce;function Ce(e){this.path=e.path,this.hostname=e.hostname,this.port=e.port,this.secure=e.secure,this.query=e.query,this.timestampParam=e.timestampParam,this.timestampRequests=e.timestampRequests,this.readyState="",this.agent=e.agent||!1,this.socket=e.socket,this.enablesXDR=e.enablesXDR,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.forceNode=e.forceNode,this.isReactNative=e.isReactNative,this.extraHeaders=e.extraHeaders,this.localAddress=e.localAddress}Ee(Ce.prototype),Ce.prototype.onError=function(e,t){var n=new Error(e);return n.type="TransportError",n.description=t,this.emit("error",n),this},Ce.prototype.open=function(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this},Ce.prototype.close=function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this},Ce.prototype.send=function(e){if("open"!==this.readyState)throw new Error("Transport not open");this.write(e)},Ce.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},Ce.prototype.onData=function(e){var t=Se.decodePacket(e,this.socket.binaryType);this.onPacket(t)},Ce.prototype.onPacket=function(e){this.emit("packet",e)},Ce.prototype.onClose=function(){this.readyState="closed",this.emit("close")};var we,Me={encode:function(e){var t="";for(var n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t},decode:function(e){for(var t={},n=e.split("&"),o=0,r=n.length;o<r;o++){var i=n[o].split("=");t[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return t}},Te=function(e,t){var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e},Ie="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),Ae=64,Oe={},Ne=0,ke=0;function Re(e){var t="";do{t=Ie[e%Ae]+t,e=Math.floor(e/Ae)}while(e>0);return t}function Pe(e){var t=0;for(ke=0;ke<e.length;ke++)t=t*Ae+Oe[e.charAt(ke)];return t}function xe(){var e=Re(+new Date);return e!==we?(Ne=0,we=e):e+"."+Re(Ne++)}for(;ke<Ae;ke++)Oe[Ie[ke]]=ke;xe.encode=Re,xe.decode=Pe;var De=xe,Fe={exports:{}},Ge={exports:{}},Ue=1e3,Le=60*Ue,je=60*Le,Be=24*je,qe=365.25*Be,Ve=function(e,t){t=t||{};var n=h(e);if("string"===n&&e.length>0)return He(e);if("number"===n&&!1===isNaN(e))return t["long"]?ze(e):We(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))};function He(e){if(e=String(e),!(e.length>100)){var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(t){var n=parseFloat(t[1]),o=(t[2]||"ms").toLowerCase();switch(o){case"years":case"year":case"yrs":case"yr":case"y":return n*qe;case"days":case"day":case"d":return n*Be;case"hours":case"hour":case"hrs":case"hr":case"h":return n*je;case"minutes":case"minute":case"mins":case"min":case"m":return n*Le;case"seconds":case"second":case"secs":case"sec":case"s":return n*Ue;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}}}function We(e){return e>=Be?Math.round(e/Be)+"d":e>=je?Math.round(e/je)+"h":e>=Le?Math.round(e/Le)+"m":e>=Ue?Math.round(e/Ue)+"s":e+"ms"}function ze(e){return Je(e,Be,"day")||Je(e,je,"hour")||Je(e,Le,"minute")||Je(e,Ue,"second")||e+" ms"}function Je(e,t,n){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+n:Math.ceil(e/t)+" "+n+"s"}(function(e,t){function n(e){var n,o=0;for(n in e)o=(o<<5)-o+e.charCodeAt(n),o|=0;return t.colors[Math.abs(o)%t.colors.length]}function o(e){var o;function i(){if(i.enabled){var e=i,n=+new Date,r=n-(o||n);e.diff=r,e.prev=o,e.curr=n,o=n;for(var s=new Array(arguments.length),a=0;a<s.length;a++)s[a]=arguments[a];s[0]=t.coerce(s[0]),"string"!==typeof s[0]&&s.unshift("%O");var c=0;s[0]=s[0].replace(/%([a-zA-Z%])/g,(function(n,o){if("%%"===n)return n;c++;var r=t.formatters[o];if("function"===typeof r){var i=s[c];n=r.call(e,i),s.splice(c,1),c--}return n})),t.formatArgs.call(e,s);var u=i.log||t.log||console.log.bind(console);u.apply(e,s)}}return i.namespace=e,i.enabled=t.enabled(e),i.useColors=t.useColors(),i.color=n(e),i.destroy=r,"function"===typeof t.init&&t.init(i),t.instances.push(i),i}function r(){var e=t.instances.indexOf(this);return-1!==e&&(t.instances.splice(e,1),!0)}function i(e){var n;t.save(e),t.names=[],t.skips=[];var o=("string"===typeof e?e:"").split(/[\s,]+/),r=o.length;for(n=0;n<r;n++)o[n]&&(e=o[n].replace(/\*/g,".*?"),"-"===e[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")));for(n=0;n<t.instances.length;n++){var i=t.instances[n];i.enabled=t.enabled(i.namespace)}}function s(){t.enable("")}function a(e){if("*"===e[e.length-1])return!0;var n,o;for(n=0,o=t.skips.length;n<o;n++)if(t.skips[n].test(e))return!1;for(n=0,o=t.names.length;n<o;n++)if(t.names[n].test(e))return!0;return!1}function c(e){return e instanceof Error?e.stack||e.message:e}t=e.exports=o.debug=o["default"]=o,t.coerce=c,t.disable=s,t.enable=i,t.enabled=a,t.humanize=Ve,t.instances=[],t.names=[],t.skips=[],t.formatters={}})(Ge,Ge.exports),function(e,t){function n(){return!("undefined"===typeof window||!window.process||"renderer"!==window.process.type)||("undefined"===typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!==typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!==typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))}function r(e){var n=this.useColors;if(e[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+e[0]+(n?"%c ":" ")+"+"+t.humanize(this.diff),n){var o="color: "+this.color;e.splice(1,0,o,"color: inherit");var r=0,i=0;e[0].replace(/%[a-zA-Z%]/g,(function(e){"%%"!==e&&(r++,"%c"===e&&(i=r))})),e.splice(i,0,o)}}function i(){return"object"===("undefined"===typeof console?"undefined":h(console))&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function s(e){try{null==e?t.storage.removeItem("debug"):t.storage.debug=e}catch(n){}}function a(){var e;try{e=t.storage.debug}catch(n){}return!e&&"undefined"!==typeof o&&"env"in o&&(e=Object({NODE_ENV:"production",BASE_URL:"/"}).DEBUG),e}function c(){try{return window.localStorage}catch(e){}}t=e.exports=Ge.exports,t.log=i,t.formatArgs=r,t.save=s,t.load=a,t.useColors=n,t.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:c(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.formatters.j=function(e){try{return JSON.stringify(e)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}},t.enable(a())}(Fe,Fe.exports);var Xe={exports:{}};try{Xe.exports="undefined"!==typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(Qf){Xe.exports=!1}var Ye=Xe.exports,Qe=function(e){var t=e.xdomain,n=e.xscheme,o=e.enablesXDR;try{if("undefined"!==typeof XMLHttpRequest&&(!t||Ye))return new XMLHttpRequest}catch(r){}try{if("undefined"!==typeof XDomainRequest&&!n&&o)return new XDomainRequest}catch(r){}if(!t)try{return new(self[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(r){}},Ke=_e,$e=Me,Ze=B,et=Te,nt=De,ot=Fe.exports("engine.io-client:polling"),rt=st,it=function(){var e=Qe,t=new e({xdomain:!1});return null!=t.responseType}();function st(e){var t=e&&e.forceBase64;it&&!t||(this.supportsBinary=!1),Ke.call(this,e)}et(st,Ke),st.prototype.name="polling",st.prototype.doOpen=function(){this.poll()},st.prototype.pause=function(e){var t=this;function n(){ot("paused"),t.readyState="paused",e()}if(this.readyState="pausing",this.polling||!this.writable){var o=0;this.polling&&(ot("we are currently polling - waiting to pause"),o++,this.once("pollComplete",(function(){ot("pre-pause polling complete"),--o||n()}))),this.writable||(ot("we are currently writing - waiting to pause"),o++,this.once("drain",(function(){ot("pre-pause writing complete"),--o||n()})))}else n()},st.prototype.poll=function(){ot("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},st.prototype.onData=function(e){var t=this;ot("polling got data %s",e);var n=function(e,n,o){if("opening"===t.readyState&&t.onOpen(),"close"===e.type)return t.onClose(),!1;t.onPacket(e)};Ze.decodePayload(e,this.socket.binaryType,n),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState?this.poll():ot('ignoring poll - transport state "%s"',this.readyState))},st.prototype.doClose=function(){var e=this;function t(){ot("writing close packet"),e.write([{type:"close"}])}"open"===this.readyState?(ot("transport open - closing"),t()):(ot("transport not open - deferring close"),this.once("open",t))},st.prototype.write=function(e){var t=this;this.writable=!1;var n=function(){t.writable=!0,t.emit("drain")};Ze.encodePayload(e,this.supportsBinary,(function(e){t.doWrite(e,n)}))},st.prototype.uri=function(){var e=this.query||{},t=this.secure?"https":"http",n="";!1!==this.timestampRequests&&(e[this.timestampParam]=nt()),this.supportsBinary||e.sid||(e.b64=1),e=$e.encode(e),this.port&&("https"===t&&443!==Number(this.port)||"http"===t&&80!==Number(this.port))&&(n=":"+this.port),e.length&&(e="?"+e);var o=-1!==this.hostname.indexOf(":");return t+"://"+(o?"["+this.hostname+"]":this.hostname)+n+this.path+e};var at,ct=rt,ut=Te,lt=yt,pt=/\n/g,ft=/\\n/g;function dt(){}function ht(){return"undefined"!==typeof self?self:"undefined"!==typeof window?window:"undefined"!==typeof e?e:{}}function yt(e){if(ct.call(this,e),this.query=this.query||{},!at){var t=ht();at=t.___eio=t.___eio||[]}this.index=at.length;var n=this;at.push((function(e){n.onData(e)})),this.query.j=this.index,"function"===typeof addEventListener&&addEventListener("beforeunload",(function(){n.script&&(n.script.onerror=dt)}),!1)}ut(yt,ct),yt.prototype.supportsBinary=!1,yt.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),ct.prototype.doClose.call(this)},yt.prototype.doPoll=function(){var e=this,t=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),t.async=!0,t.src=this.uri(),t.onerror=function(t){e.onError("jsonp poll error",t)};var n=document.getElementsByTagName("script")[0];n?n.parentNode.insertBefore(t,n):(document.head||document.body).appendChild(t),this.script=t;var o="undefined"!==typeof navigator&&/gecko/i.test(navigator.userAgent);o&&setTimeout((function(){var e=document.createElement("iframe");document.body.appendChild(e),document.body.removeChild(e)}),100)},yt.prototype.doWrite=function(e,t){var n=this;if(!this.form){var o,r=document.createElement("form"),i=document.createElement("textarea"),s=this.iframeId="eio_iframe_"+this.index;r.className="socketio",r.style.position="absolute",r.style.top="-1000px",r.style.left="-1000px",r.target=s,r.method="POST",r.setAttribute("accept-charset","utf-8"),i.name="d",r.appendChild(i),document.body.appendChild(r),this.form=r,this.area=i}function a(){c(),t()}function c(){if(n.iframe)try{n.form.removeChild(n.iframe)}catch(t){n.onError("jsonp polling iframe removal error",t)}try{var e='<iframe src="javascript:0" name="'+n.iframeId+'">';o=document.createElement(e)}catch(t){o=document.createElement("iframe"),o.name=n.iframeId,o.src="javascript:0"}o.id=n.iframeId,n.form.appendChild(o),n.iframe=o}this.form.action=this.uri(),c(),e=e.replace(ft,"\\\n"),this.area.value=e.replace(pt,"\\n");try{this.form.submit()}catch(u){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"===n.iframe.readyState&&a()}:this.iframe.onload=a};var mt,vt,gt=_e,bt=B,St=Me,Et=Te,_t=De,Ct=Fe.exports("engine.io-client:websocket");if("undefined"===typeof uni&&"undefined"===typeof wx||"undefined"!==typeof WebSocket)if("undefined"!==typeof WebSocket)mt=WebSocket;else if("undefined"!==typeof self)mt=self.WebSocket||self.MozWebSocket;else try{vt=n("7f73")}catch(Kf){}var wt=mt||vt;("undefined"===typeof uni&&"undefined"===typeof wx||"undefined"!==typeof WebSocket)&&"undefined"===typeof GameGlobal||(wt=function(e){var t=this;if(t.onopen=function(){},t.onclose=function(){},t.onmessage=function(e){},t.onerror=function(e){},"object"===("undefined"===typeof tt?"undefined":h(tt))&&tt.getSystemInfo){var n=tt.connectSocket({url:e});t.send=function(e){n.send({data:e})},t.close=function(){n.close()},n.onOpen((function(){t.onopen()})),n.onError((function(e){t.onerror(e)})),n.onMessage((function(e){t.onmessage(e)})),n.onClose((function(){t.onclose()}))}else if("undefined"!==typeof uni)if("undefined"!==typeof my)my.connectSocket({url:e}),t.send=function(e){my.sendSocketMessage({data:e})},t.close=function(e){my.closeSocket()},my.onSocketOpen((function(e){t.onopen()})),my.onSocketError((function(e){t.onerror(e)})),my.onSocketMessage((function(e){t.onmessage(e)})),my.onSocketClose((function(e){t.onclose(e)}));else{var o=uni.connectSocket({url:e,complete:function(){}});t.send=function(e){o.send({data:e})},t.close=function(){o.close()},o.onOpen((function(e){t.onopen()})),o.onError((function(e){t.onerror(e)})),o.onMessage((function(e){t.onmessage(e)})),o.onClose((function(e){t.onclose()}))}else{var r=wx.connectSocket({url:e});t.send=function(e){r.send({data:e})},t.close=function(e){r.close({code:1e3})},r.onOpen((function(){t.onopen()})),r.onError((function(e){t.onerror(e)})),r.onMessage((function(e){t.onmessage(e)})),r.onClose((function(e){t.onclose(e)}))}});var Mt=Tt;function Tt(e){var t=e&&e.forceBase64;t&&(this.supportsBinary=!1),("undefined"===typeof uni&&"undefined"===typeof wx||"undefined"!==typeof WebSocket)&&(this.perMessageDeflate=e.perMessageDeflate,this.usingBrowserWebSocket=mt&&!e.forceNode,this.protocols=e.protocols,this.usingBrowserWebSocket||(wt=vt)),gt.call(this,e)}Et(Tt,gt),Tt.prototype.name="websocket",Tt.prototype.supportsBinary=!1,Tt.prototype.doOpen=function(){if(this.check()){var e,t,n=this.uri();("undefined"===typeof uni&&"undefined"===typeof wx||"undefined"!==typeof WebSocket)&&(e=this.protocols),t="undefined"===typeof uni&&"undefined"===typeof wx||"undefined"!==typeof WebSocket?{agent:this.agent,perMessageDeflate:this.perMessageDeflate}:{agent:this.agent},t.pfx=this.pfx,t.key=this.key,t.passphrase=this.passphrase,t.cert=this.cert,t.ca=this.ca,t.ciphers=this.ciphers,t.rejectUnauthorized=this.rejectUnauthorized,this.extraHeaders&&(t.headers=this.extraHeaders),this.localAddress&&(t.localAddress=this.localAddress);try{"undefined"===typeof uni&&"undefined"===typeof wx||"undefined"!==typeof WebSocket?this.ws=this.usingBrowserWebSocket&&!this.isReactNative?e?new wt(n,e):new wt(n):new wt(n,e,t):this.ws=new wt(n)}catch(Qf){return this.emit("error",Qf)}void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="nodebuffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()}},Tt.prototype.addEventListeners=function(){var e=this;this.ws.onopen=function(){e.onOpen()},this.ws.onclose=function(){e.onClose()},this.ws.onmessage=function(t){e.onData(t.data)},this.ws.onerror=function(t){e.onError("websocket error",t)}},Tt.prototype.write=function(e){var t=this;this.writable=!1;for(var n=e.length,o=0,i=n;o<i;o++)(function(e){bt.encodePacket(e,t.supportsBinary,(function(o){if("undefined"===typeof uni&&"undefined"===typeof wx||"undefined"!==typeof WebSocket){if(!t.usingBrowserWebSocket){var i={};if(e.options&&(i.compress=e.options.compress),t.perMessageDeflate){var a="string"===typeof o?r.byteLength(o):o.length;a<t.perMessageDeflate.threshold&&(i.compress=!1)}}try{t.usingBrowserWebSocket?t.ws.send(o):t.ws.send(o,i)}catch(Kf){Ct("websocket closed before onclose event")}}else try{t.ws.send(o)}catch(Kf){Ct("websocket closed before onclose event")}--n||s()}))})(e[o]);function s(){t.emit("flush"),setTimeout((function(){t.writable=!0,t.emit("drain")}),0)}},Tt.prototype.onClose=function(){gt.prototype.onClose.call(this)},Tt.prototype.doClose=function(){"undefined"!==typeof this.ws&&this.ws.close()},Tt.prototype.uri=function(){var e=this.query||{},t=this.secure?"wss":"ws",n="";this.port&&("wss"===t&&443!==Number(this.port)||"ws"===t&&80!==Number(this.port))&&(n=":"+this.port),this.timestampRequests&&(e[this.timestampParam]=_t()),this.supportsBinary||(e.b64=1),e=St.encode(e),e.length&&(e="?"+e);var o=-1!==this.hostname.indexOf(":");return t+"://"+(o?"["+this.hostname+"]":this.hostname)+n+this.path+e},Tt.prototype.check=function(){return!!wt&&!("__initialize"in wt&&this.name===Tt.prototype.name)};var It=lt,At=Mt;function Ot(e){var t=!1,n=!1;if(e.jsonp,"undefined"!==typeof location){var o="https:"===location.protocol,r=location.port;r||(r=o?443:80),t=e.hostname!==location.hostname||r!==e.port,n=e.secure!==o}return e.xdomain=t,e.xscheme=n,new It(e)}j.polling=Ot,j.websocket=At;var Nt=[].indexOf,kt=function(e,t){if(Nt)return e.indexOf(t);for(var n=0;n<e.length;++n)if(e[n]===t)return n;return-1},Rt=j,Pt=F.exports,xt=Fe.exports("engine.io-client:socket"),Dt=kt,Ft=B,Gt=g,Ut=Me,Lt=jt;function jt(e,t){if(!(this instanceof jt))return new jt(e,t);t=t||{},e&&"object"===h(e)&&(t=e,e=null),e?(e=Gt(e),t.hostname=e.host,t.secure="https"===e.protocol||"wss"===e.protocol,t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=Gt(t.host).host),this.secure=null!=t.secure?t.secure:"undefined"!==typeof location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.agent=t.agent||!1,this.hostname=t.hostname||("undefined"!==typeof location?location.hostname:"localhost"),this.port=t.port||("undefined"!==typeof location&&location.port?location.port:this.secure?443:80),this.query=t.query||{},"string"===typeof this.query&&(this.query=Ut.decode(this.query)),this.upgrade=!1!==t.upgrade,this.path=(t.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!t.forceJSONP,this.jsonp=!1!==t.jsonp,this.forceBase64=!!t.forceBase64,this.enablesXDR=!!t.enablesXDR,this.timestampParam=t.timestampParam||"t",this.timestampRequests=t.timestampRequests,this.transports=t.transports||["polling","websocket"],this.transportOptions=t.transportOptions||{},this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.policyPort=t.policyPort||843,this.rememberUpgrade=t.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=t.onlyBinaryUpgrades,this.perMessageDeflate=!1!==t.perMessageDeflate&&(t.perMessageDeflate||{}),!0===this.perMessageDeflate&&(this.perMessageDeflate={}),this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024),this.pfx=t.pfx||null,this.key=t.key||null,this.passphrase=t.passphrase||null,this.cert=t.cert||null,this.ca=t.ca||null,this.ciphers=t.ciphers||null,this.rejectUnauthorized=void 0===t.rejectUnauthorized||t.rejectUnauthorized,this.forceNode=!!t.forceNode,this.isReactNative="undefined"!==typeof navigator&&"string"===typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),("undefined"===typeof self||this.isReactNative)&&(t.extraHeaders&&Object.keys(t.extraHeaders).length>0&&(this.extraHeaders=t.extraHeaders),t.localAddress&&(this.localAddress=t.localAddress)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingIntervalTimer=null,this.pingTimeoutTimer=null,this.open()}function Bt(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}jt.priorWebsocketSuccess=!1,Pt(jt.prototype),jt.protocol=Ft.protocol,jt.Socket=jt,jt.Transport=_e,jt.transports=j,jt.parser=B,jt.prototype.createTransport=function(e){xt('creating transport "%s"',e);var t=Bt(this.query);t.EIO=Ft.protocol,t.transport=e;var n=this.transportOptions[e]||{};this.id&&(t.sid=this.id);var o=new Rt[e]({query:t,socket:this,agent:n.agent||this.agent,hostname:n.hostname||this.hostname,port:n.port||this.port,secure:n.secure||this.secure,path:n.path||this.path,forceJSONP:n.forceJSONP||this.forceJSONP,jsonp:n.jsonp||this.jsonp,forceBase64:n.forceBase64||this.forceBase64,enablesXDR:n.enablesXDR||this.enablesXDR,timestampRequests:n.timestampRequests||this.timestampRequests,timestampParam:n.timestampParam||this.timestampParam,policyPort:n.policyPort||this.policyPort,pfx:n.pfx||this.pfx,key:n.key||this.key,passphrase:n.passphrase||this.passphrase,cert:n.cert||this.cert,ca:n.ca||this.ca,ciphers:n.ciphers||this.ciphers,rejectUnauthorized:n.rejectUnauthorized||this.rejectUnauthorized,perMessageDeflate:n.perMessageDeflate||this.perMessageDeflate,extraHeaders:n.extraHeaders||this.extraHeaders,forceNode:n.forceNode||this.forceNode,localAddress:n.localAddress||this.localAddress,requestTimeout:n.requestTimeout||this.requestTimeout,protocols:n.protocols||void 0,isReactNative:this.isReactNative});return o},jt.prototype.open=function(){var e;if(this.rememberUpgrade&&jt.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length){var t=this;return void setTimeout((function(){t.emit("error","No transports available")}),0)}e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(Kf){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)},jt.prototype.setTransport=function(e){xt("setting transport %s",e.name);var t=this;this.transport&&(xt("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=e,e.on("drain",(function(){t.onDrain()})).on("packet",(function(e){t.onPacket(e)})).on("error",(function(e){t.onError(e)})).on("close",(function(){t.onClose("transport close")}))},jt.prototype.probe=function(e){xt('probing transport "%s"',e);var t=this.createTransport(e,{probe:1}),n=!1,o=this;function r(){if(o.onlyBinaryUpgrades){var r=!this.supportsBinary&&o.transport.supportsBinary;n=n||r}n||(xt('probe transport "%s" opened',e),t.send([{type:"ping",data:"probe"}]),t.once("packet",(function(r){if(!n)if("pong"===r.type&&"probe"===r.data){if(xt('probe transport "%s" pong',e),o.upgrading=!0,o.emit("upgrading",t),!t)return;jt.priorWebsocketSuccess="websocket"===t.name,xt('pausing current transport "%s"',o.transport.name),o.transport.pause((function(){n||"closed"!==o.readyState&&(xt("changing transport and sending upgrade packet"),l(),o.setTransport(t),t.send([{type:"upgrade"}]),o.emit("upgrade",t),t=null,o.upgrading=!1,o.flush())}))}else{xt('probe transport "%s" failed',e);var i=new Error("probe error");i.transport=t.name,o.emit("upgradeError",i)}})))}function i(){n||(n=!0,l(),t.close(),t=null)}function s(n){var r=new Error("probe error: "+n);r.transport=t.name,i(),xt('probe transport "%s" failed because of error: %s',e,n),o.emit("upgradeError",r)}function a(){s("transport closed")}function c(){s("socket closed")}function u(e){t&&e.name!==t.name&&(xt('"%s" works - aborting "%s"',e.name,t.name),i())}function l(){t.removeListener("open",r),t.removeListener("error",s),t.removeListener("close",a),o.removeListener("close",c),o.removeListener("upgrading",u)}jt.priorWebsocketSuccess=!1,t.once("open",r),t.once("error",s),t.once("close",a),this.once("close",c),this.once("upgrading",u),t.open()},jt.prototype.onOpen=function(){if(xt("socket open"),this.readyState="open",jt.priorWebsocketSuccess="websocket"===this.transport.name,this.emit("open"),this.flush(),"open"===this.readyState&&this.upgrade&&this.transport.pause){xt("starting upgrade probes");for(var e=0,t=this.upgrades.length;e<t;e++)this.probe(this.upgrades[e])}},jt.prototype.onPacket=function(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(xt('socket receive: type "%s", data "%s"',e.type,e.data),this.emit("packet",e),this.emit("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emit("data",e.data),this.emit("message",e.data);break}else xt('packet received with socket readyState "%s"',this.readyState)},jt.prototype.onHandshake=function(e){this.emit("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.onOpen(),"closed"!==this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},jt.prototype.onHeartbeat=function(e){clearTimeout(this.pingTimeoutTimer);var t=this;t.pingTimeoutTimer=setTimeout((function(){"closed"!==t.readyState&&t.onClose("ping timeout")}),e||t.pingInterval+t.pingTimeout)},jt.prototype.setPing=function(){var e=this;clearTimeout(e.pingIntervalTimer),e.pingIntervalTimer=setTimeout((function(){xt("writing ping packet - expecting pong within %sms",e.pingTimeout),e.ping(),e.onHeartbeat(e.pingTimeout)}),e.pingInterval)},jt.prototype.ping=function(){var e=this;this.sendPacket("ping",(function(){e.emit("ping")}))},jt.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emit("drain"):this.flush()},jt.prototype.flush=function(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(xt("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},jt.prototype.write=jt.prototype.send=function(e,t,n){return this.sendPacket("message",e,t,n),this},jt.prototype.sendPacket=function(e,t,n,o){if("function"===typeof t&&(o=t,t=void 0),"function"===typeof n&&(o=n,n=null),"closing"!==this.readyState&&"closed"!==this.readyState){n=n||{},n.compress=!1!==n.compress;var r={type:e,data:t,options:n};this.emit("packetCreate",r),this.writeBuffer.push(r),o&&this.once("flush",o),this.flush()}},jt.prototype.close=function(){if("opening"===this.readyState||"open"===this.readyState){this.readyState="closing";var e=this;this.writeBuffer.length?this.once("drain",(function(){this.upgrading?o():t()})):this.upgrading?o():t()}function t(){e.onClose("forced close"),xt("socket closing - telling transport to close"),e.transport.close()}function n(){e.removeListener("upgrade",n),e.removeListener("upgradeError",n),t()}function o(){e.once("upgrade",n),e.once("upgradeError",n)}return this},jt.prototype.onError=function(e){xt("socket error %j",e),jt.priorWebsocketSuccess=!1,this.emit("error",e),this.onClose("transport error",e)},jt.prototype.onClose=function(e,t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){xt('socket close with reason: "%s"',e);var n=this;clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",e,t),n.writeBuffer=[],n.prevBufferLen=0}},jt.prototype.filterUpgrades=function(e){for(var t=[],n=0,o=e.length;n<o;n++)~Dt(this.transports,e[n])&&t.push(e[n]);return t},L.exports=Lt,L.exports.parser=B;var qt={exports:{}},Vt=Ht;function Ht(e,t){var n=[];t=t||0;for(var o=t||0;o<e.length;o++)n[o-t]=e[o];return n}var Wt=zt;function zt(e,t,n){return e.on(t,n),{destroy:function(){e.removeListener(t,n)}}}var Jt=[].slice,Xt=function(e,t){if("string"==typeof t&&(t=e[t]),"function"!=typeof t)throw new Error("bind() requires a function");var n=Jt.call(arguments,2);return function(){return t.apply(e,n.concat(Jt.call(arguments)))}};(function(e,t){var n=D,o=F.exports,r=Vt,i=Wt,s=Xt,a=b.exports("socket.io-client:socket"),c=Me,u=J;e.exports=f;var l={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},p=o.prototype.emit;function f(e,t,n){this.io=e,this.nsp=t,this.json=this,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,this.flags={},n&&n.query&&(this.query=n.query),this.io.autoConnect&&this.open()}o(f.prototype),f.prototype.subEvents=function(){if(!this.subs){var e=this.io;this.subs=[i(e,"open",s(this,"onopen")),i(e,"packet",s(this,"onpacket")),i(e,"close",s(this,"onclose"))]}},f.prototype.open=f.prototype.connect=function(){return this.connected||(this.subEvents(),this.io.open(),"open"===this.io.readyState&&this.onopen(),this.emit("connecting")),this},f.prototype.send=function(){var e=r(arguments);return e.unshift("message"),this.emit.apply(this,e),this},f.prototype.emit=function(e){if(l.hasOwnProperty(e))return p.apply(this,arguments),this;var t=r(arguments),o={type:(void 0!==this.flags.binary?this.flags.binary:u(t))?n.BINARY_EVENT:n.EVENT,data:t,options:{}};return o.options.compress=!this.flags||!1!==this.flags.compress,"function"===typeof t[t.length-1]&&(a("emitting packet with ack id %d",this.ids),this.acks[this.ids]=t.pop(),o.id=this.ids++),this.connected?this.packet(o):this.sendBuffer.push(o),this.flags={},this},f.prototype.packet=function(e){e.nsp=this.nsp,this.io.packet(e)},f.prototype.onopen=function(){if(a("transport is open - connecting"),"/"!==this.nsp)if(this.query){var e="object"===h(this.query)?c.encode(this.query):this.query;a("sending connect packet with query %s",e),this.packet({type:n.CONNECT,query:e})}else this.packet({type:n.CONNECT})},f.prototype.onclose=function(e){a("close (%s)",e),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",e)},f.prototype.onpacket=function(e){var t=e.nsp===this.nsp,o=e.type===n.ERROR&&"/"===e.nsp;if(t||o)switch(e.type){case n.CONNECT:this.onconnect();break;case n.EVENT:this.onevent(e);break;case n.BINARY_EVENT:this.onevent(e);break;case n.ACK:this.onack(e);break;case n.BINARY_ACK:this.onack(e);break;case n.DISCONNECT:this.ondisconnect();break;case n.ERROR:this.emit("error",e.data);break}},f.prototype.onevent=function(e){var t=e.data||[];a("emitting event %j",t),null!=e.id&&(a("attaching ack callback to event"),t.push(this.ack(e.id))),this.connected?p.apply(this,t):this.receiveBuffer.push(t)},f.prototype.ack=function(e){var t=this,o=!1;return function(){if(!o){o=!0;var i=r(arguments);a("sending ack %j",i),t.packet({type:u(i)?n.BINARY_ACK:n.ACK,id:e,data:i})}}},f.prototype.onack=function(e){var t=this.acks[e.id];"function"===typeof t?(a("calling ack %s with %j",e.id,e.data),t.apply(this,e.data),delete this.acks[e.id]):a("bad ack %s",e.id)},f.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},f.prototype.emitBuffered=function(){var e;for(e=0;e<this.receiveBuffer.length;e++)p.apply(this,this.receiveBuffer[e]);for(this.receiveBuffer=[],e=0;e<this.sendBuffer.length;e++)this.packet(this.sendBuffer[e]);this.sendBuffer=[]},f.prototype.ondisconnect=function(){a("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},f.prototype.destroy=function(){if(this.subs){for(var e=0;e<this.subs.length;e++)this.subs[e].destroy();this.subs=null}this.io.destroy(this)},f.prototype.close=f.prototype.disconnect=function(){return this.connected&&(a("performing disconnect (%s)",this.nsp),this.packet({type:n.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},f.prototype.compress=function(e){return this.flags.compress=e,this},f.prototype.binary=function(e){return this.flags.binary=e,this}})(qt);var Yt=Qt;function Qt(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}Qt.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-n:e+n}return 0|Math.min(e,this.max)},Qt.prototype.reset=function(){this.attempts=0},Qt.prototype.setMin=function(e){this.ms=e},Qt.prototype.setMax=function(e){this.max=e},Qt.prototype.setJitter=function(e){this.jitter=e};var Kt={},$t={},Zt={};(function(t){var n,o=e&&e.__values||function(e){var t="function"===typeof Symbol&&Symbol.iterator,n=t&&e[t],o=0;if(n)return n.call(e);if(e&&"number"===typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};t.__esModule=!0,t.PlatformDetector=t.Platform=void 0,function(e){e["BROWSER"]="BROWSER",e["UNKNOWN"]="UNKNOWN",e["APP_IOS"]="APP_IOS",e["APP_ANDROID"]="APP_ANDROID",e["APPLET_WX"]="APPLET_WX",e["APPLET_WX_GAME"]="APPLET_WX_GAME",e["APPLET_ALIPAY"]="APPLET_ALIPAY",e["APPLET_BYTEDANCE"]="APPLET_BYTEDANCE"}(n=t.Platform||(t.Platform={}));var r=function(){function e(){var e,t,r;this.platform=null,this.methods=(e={},e[n.BROWSER]=this.isBrowser,e[n.APP_IOS]=this.isAppiOS,e[n.APP_ANDROID]=this.isAppAndroid,e[n.APPLET_WX]=this.isWXApplet,e[n.APPLET_WX_GAME]=this.isWXGameApplet,e);var i=this.methods,s=Object.keys(i);try{for(var a=o(s),c=a.next();!c.done;c=a.next()){var u=c.value,l=i[u];if(l()){this.platform=u;break}}}catch(p){t={error:p}}finally{try{c&&!c.done&&(r=a["return"])&&r.call(a)}finally{if(t)throw t.error}}this.platform=this.platform||n.UNKNOWN,console.log("PlatformDetector constructor - ",this.platform)}return e.currentPlatform=function(){return e.instance.platform},e.prototype.isBrowser=function(){return"undefined"!==typeof navigator&&"undefined"!==typeof document&&!!document.getElementById&&"undefined"===typeof GameGlobal},e.prototype.isAppiOS=function(){return"object"===("undefined"===typeof uni?"undefined":h(uni))&&!!uni.getSystemInfoSync&&"ios"===uni.getSystemInfoSync().platform&&"object"===("undefined"===typeof plus?"undefined":h(plus))},e.prototype.isAppAndroid=function(){return"object"===("undefined"===typeof uni?"undefined":h(uni))&&!!uni.getSystemInfoSync&&"android"===uni.getSystemInfoSync().platform&&"object"===("undefined"===typeof plus?"undefined":h(plus))},e.prototype.isWXApplet=function(){return"object"===("undefined"===typeof wx?"undefined":h(wx))&&!!wx.getSystemInfoSync&&"undefined"===typeof WebSocket&&"undefined"===typeof XMLHttpRequest&&"undefined"===typeof plus},e.prototype.isWXGameApplet=function(){return"object"===("undefined"===typeof GameGlobal?"undefined":h(GameGlobal))},e.prototype.isAlipayApplet=function(){return!1},e.prototype.isBytedanceApplet=function(){return!1},e.prototype.isQQApplet=function(){return!1},e.prototype.isBaiduApplet=function(){return!1},e.instance=new e,e}();t.PlatformDetector=r})(Zt),function(t){var n=e&&e.__values||function(e){var t="function"===typeof Symbol&&Symbol.iterator,n=t&&e[t],o=0;if(n)return n.call(e);if(e&&"number"===typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};t.__esModule=!0,t.FrameworkDetector=t.Framework=void 0;var o,r=Zt;(function(e){e["UNIAPP"]="UNIAPP",e["REACT_NATIVE"]="REACT_NATIVE",e["TARO"]="TARO",e["IONIC"]="IONIC",e["NATIVE_APPLET_WX"]="NATIVE_APPLET_WX",e["NATIVE_APPLET_ALIPAY"]="NATIVE_APPLET_ALIPAY",e["UNKNOWN"]="UNKNOWN"})(o=t.Framework||(t.Framework={}));var i=function(){function t(){var e,t,r;this.framework=null,this.methods=(e={},e[o.UNIAPP]=this.isUniApp,e[o.REACT_NATIVE]=this.isReactNative,e[o.NATIVE_APPLET_WX]=this.isWXApplet,e);var i=this.methods,s=Object.keys(i);try{for(var a=n(s),c=a.next();!c.done;c=a.next()){var u=c.value,l=i[u];if(l()){this.framework=u;break}}}catch(p){t={error:p}}finally{try{c&&!c.done&&(r=a["return"])&&r.call(a)}finally{if(t)throw t.error}}this.framework=this.framework||o.UNKNOWN,console.log("FrameworkDetector constructor - ",this.framework)}return t.currentFramework=function(){return this.instance.framework},t.prototype.isUniApp=function(){return"object"===("undefined"===typeof uni?"undefined":h(uni))&&!!uni.getSystemInfoSync},t.prototype.isReactNative=function(){return"undefined"!==typeof e&&e.__fbGenNativeModule},t.prototype.isTaro=function(){return!1},t.prototype.isWXApplet=function(){return r.PlatformDetector.currentPlatform()===r.Platform.APPLET_WX&&"undefined"===typeof uni},t.instance=new t,t}();t.FrameworkDetector=i}($t),Kt.__esModule=!0,Kt.uniApp=void 0;var en=$t,tn=function(){function e(){this.uniAppRunningBackend=!1,this.listenAppRunning()}return e.prototype.listenAppRunning=function(){var e=this,t=en.FrameworkDetector.currentFramework();t===en.Framework.UNIAPP&&"object"===("undefined"===typeof plus?"undefined":h(plus))&&(plus.globalEvent.addEventListener("resume",(function(){e.uniAppRunningBackend=!1,console.log("app running frontend...:",e.uniAppRunningBackend)}),!1),plus.globalEvent.addEventListener("pause",(function(){e.uniAppRunningBackend=!0,console.log("app running background...:",e.uniAppRunningBackend)}),!1))},e.prototype.runningBackend=function(){return this.uniAppRunningBackend},e}(),nn=new tn;Kt.uniApp=nn;var on={},rn={};(function(e){e.__esModule=!0,e["default"]={maxNumber:5}})(rn);var sn={},an={},cn=e&&e.__values||function(e){var t="function"===typeof Symbol&&Symbol.iterator,n=t&&e[t],o=0;if(n)return n.call(e);if(e&&"number"===typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};an.__esModule=!0,an.Cookie=void 0;var un=function(){function e(){}return e.get=function(e){var t,n,o=encodeURIComponent(e)+"=",r=document.cookie.split("; ");try{for(var i=cn(r),s=i.next();!s.done;s=i.next()){var a=s.value;if(a.startsWith(o))return decodeURIComponent(a.substring(o.length))}}catch(c){t={error:c}}finally{try{s&&!s.done&&(n=i["return"])&&n.call(i)}finally{if(t)throw t.error}}return null},e.set=function(e,t,n,o,r,i){void 0===r&&(r="/"),void 0===i&&(i=!1);var s=encodeURIComponent(e)+"="+encodeURIComponent(t);n instanceof Date&&(s+="; expires="+n.toGMTString()),r&&(s+="; path="+r),o&&(s+="; domain="+o),i&&(s+="; secure"),document.cookie=s},e.remove=function(t,n,o,r){void 0===o&&(o="/"),void 0===r&&(r=!1),e.set(t,"",new Date(0),n,o,r)},e}();an.Cookie=un;var ln=e&&e.__values||function(e){var t="function"===typeof Symbol&&Symbol.iterator,n=t&&e[t],o=0;if(n)return n.call(e);if(e&&"number"===typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};sn.__esModule=!0,sn.LocalStorageDispatcher=void 0;var pn=an,fn=function(){function e(){this.domain=null;var e=/^(?:[A-za-z0-9-]+\.)+[A-za-z]{2,4}(?:[\/\?#][\/=\?%\-&~`@[\]\':+!\.#\w]*)?$/;this.domain="undefined"!==typeof location&&e.test(location.host)?location.host.split(".").slice(-2).join("."):null}return e.prototype.get=function(e){var t=pn.Cookie.get(e)||null;return JSON.parse(t)},e.prototype.put=function(e,t){var n=new Date(2030,12,31,0,0,0,0),o=this.domain;pn.Cookie.set(e,JSON.stringify(t),n,o)},e.prototype.remove=function(e){var t=this.domain;pn.Cookie.remove(e,t)},e.prototype.support=function(){return"undefined"!==typeof navigator&&!0===navigator.cookieEnabled},e}(),dn=function(){function e(){}return e.prototype.get=function(e){var t=localStorage.getItem(e);return JSON.parse(t)},e.prototype.put=function(e,t){var n=localStorage.setItem(e,JSON.stringify(t));JSON.stringify(n)},e.prototype.remove=function(e){localStorage.removeItem(e)},e.prototype.support=function(){return!("undefined"!==typeof GameGlobal||"undefined"===typeof localStorage||!localStorage.setItem)},e}(),hn=function(){function e(){}return e.prototype.get=function(e){var t=uni.getStorageSync(e)||null;return JSON.parse(t)},e.prototype.put=function(e,t){uni.setStorageSync(e,JSON.stringify(t))},e.prototype.remove=function(e){uni.removeStorageSync(e)},e.prototype.support=function(){return!("object"!==("undefined"===typeof uni?"undefined":h(uni))||!uni.getStorageSync)},e}(),yn=function(){function e(){}return e.prototype.get=function(e){var t=wx.getStorageSync(e)||null;return JSON.parse(t)},e.prototype.put=function(e,t){wx.setStorageSync(e,JSON.stringify(t))},e.prototype.remove=function(e){wx.removeStorageSync(e)},e.prototype.support=function(){return!("object"!==("undefined"===typeof wx?"undefined":h(wx))||!wx.getStorageSync)},e}(),mn=function(){function e(){this.supportedStorage=null;var t=e.storages;t.push(new hn),t.push(new dn),t.push(new yn),t.push(new fn),this.dispatch(),console.log("LocalStorageDispatcher constructor - ",this.supportedStorage)}return e.localStorage=function(){return this.instance.supportedStorage},e.prototype.dispatch=function(){var t,n;try{for(var o=ln(e.storages),r=o.next();!r.done;r=o.next()){var i=r.value;if(i.support()){this.supportedStorage=i;break}}}catch(s){t={error:s}}finally{try{r&&!r.done&&(n=o["return"])&&n.call(o)}finally{if(t)throw t.error}}},e.storages=new Array,e.instance=new e,e}();sn.LocalStorageDispatcher=mn,on.__esModule=!0,on.goEasyDomainNumber=void 0;var vn=rn,gn=sn,bn=function(){function e(){}return e.prototype.refreshNumber=function(){var t=e.GOEASY_DOMAIN_NUMBER,n=gn.LocalStorageDispatcher.localStorage(),o=Math.floor(Math.random()*(vn["default"].maxNumber-1)+1);return null!==n&&(o=parseInt(n.get(t))||o),o>0&&o<vn["default"].maxNumber?o+=1:o===vn["default"].maxNumber&&(o=1),null!==n&&n.put(t,o),o},e.GOEASY_DOMAIN_NUMBER="GOEASY_DOMAIN_NUMBER",e}(),Sn=new bn;on.goEasyDomainNumber=Sn;var En=L.exports,_n=qt.exports,Cn=F.exports,wn=D,Mn=Wt,Tn=Xt,In=b.exports("socket.io-client:manager"),An=kt,On=Yt,Nn=Kt.uniApp,kn=on.goEasyDomainNumber,Rn=Object.prototype.hasOwnProperty,Pn=xn;function xn(e,t){if(!(this instanceof xn))return new xn(e,t);e&&"object"===h(e)&&(t=e,e=void 0),t=t||{},t.path=t.path||"/socket.io",this.nsps={},this.subs=[],this.opts=t,this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(t.randomizationFactor||.5),this.backoff=new On({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this.readyState="closed",this.uri=e,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[];var n=t.parser||wn;this.encoder=new n.Encoder,this.decoder=new n.Decoder,this.autoConnect=!1!==t.autoConnect,this.autoConnect&&this.open()}function Dn(){var e=!1;return"object"===("undefined"===typeof uni?"undefined":h(uni))&&uni.getSystemInfo&&(e=!0),e&&Nn.runningBackend()}xn.prototype.emitAll=function(){for(var e in this.emit.apply(this,arguments),this.nsps)Rn.call(this.nsps,e)&&this.nsps[e].emit.apply(this.nsps[e],arguments)},xn.prototype.updateSocketIds=function(){for(var e in this.nsps)Rn.call(this.nsps,e)&&(this.nsps[e].id=this.generateId(e))},xn.prototype.generateId=function(e){return("/"===e?"":e+"#")+this.engine.id},Cn(xn.prototype),xn.prototype.reconnection=function(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection},xn.prototype.reconnectionAttempts=function(e){return arguments.length?(this._reconnectionAttempts=e,this):this._reconnectionAttempts},xn.prototype.reconnectionDelay=function(e){return arguments.length?(this._reconnectionDelay=e,this.backoff&&this.backoff.setMin(e),this):this._reconnectionDelay},xn.prototype.randomizationFactor=function(e){return arguments.length?(this._randomizationFactor=e,this.backoff&&this.backoff.setJitter(e),this):this._randomizationFactor},xn.prototype.reconnectionDelayMax=function(e){return arguments.length?(this._reconnectionDelayMax=e,this.backoff&&this.backoff.setMax(e),this):this._reconnectionDelayMax},xn.prototype.timeout=function(e){return arguments.length?(this._timeout=e,this):this._timeout},xn.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},xn.prototype.open=xn.prototype.connect=function(e,t){if(In("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;In("opening %s",this.uri),this.engine=En(this.uri,this.opts);var n=this.engine,o=this;this.readyState="opening",this.skipReconnect=!1;var r=Mn(n,"open",(function(){o.onopen(),e&&e()})),i=Mn(n,"error",(function(t){if("undefined"!==typeof window){var n=/[1-9][0-9]*/g,r=parseInt(o.uri.match(n)[0]),i=kn.refreshNumber();o.uri=o.uri.replace(r,i)}if(In("connect_error"),o.cleanup(),o.readyState="closed",o.emitAll("connect_error",t),e){var s=new Error("Connection error");s.data=t,e(s)}else o.maybeReconnectOnOpen()}));if(!1!==this._timeout){var s=this._timeout;In("connect attempt will timeout after %d",s);var a=setTimeout((function(){In("connect attempt timed out after %d",s),r.destroy(),n.close(),n.emit("error","timeout"),o.emitAll("connect_timeout",s)}),s);this.subs.push({destroy:function(){clearTimeout(a)}})}return this.subs.push(r),this.subs.push(i),this},xn.prototype.onopen=function(){In("open"),this.cleanup(),this.readyState="open",this.emit("open");var e=this.engine;this.subs.push(Mn(e,"data",Tn(this,"ondata"))),this.subs.push(Mn(e,"ping",Tn(this,"onping"))),this.subs.push(Mn(e,"pong",Tn(this,"onpong"))),this.subs.push(Mn(e,"error",Tn(this,"onerror"))),this.subs.push(Mn(e,"close",Tn(this,"onclose"))),this.subs.push(Mn(this.decoder,"decoded",Tn(this,"ondecoded")))},xn.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")},xn.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)},xn.prototype.ondata=function(e){this.decoder.add(e)},xn.prototype.ondecoded=function(e){this.emit("packet",e)},xn.prototype.onerror=function(e){In("error",e),this.emitAll("error",e)},xn.prototype.socket=function(e,t){var n=this.nsps[e];if(!n){n=new _n(this,e,t),this.nsps[e]=n;var o=this;n.on("connecting",r),n.on("connect",(function(){n.id=o.generateId(e)})),this.autoConnect&&r()}function r(){~An(o.connecting,n)||o.connecting.push(n)}return n},xn.prototype.destroy=function(e){var t=An(this.connecting,e);~t&&this.connecting.splice(t,1),this.connecting.length||this.close()},xn.prototype.packet=function(e){In("writing packet %j",e);var t=this;e.query&&0===e.type&&(e.nsp+="?"+e.query),t.encoding?t.packetBuffer.push(e):(t.encoding=!0,this.encoder.encode(e,(function(n){for(var o=0;o<n.length;o++)t.engine.write(n[o],e.options);t.encoding=!1,t.processPacketQueue()})))},xn.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var e=this.packetBuffer.shift();this.packet(e)}},xn.prototype.cleanup=function(){In("cleanup");for(var e=this.subs.length,t=0;t<e;t++){var n=this.subs.shift();n.destroy()}this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},xn.prototype.close=xn.prototype.disconnect=function(){In("disconnect"),this.skipReconnect=!0,this.reconnecting=!1,"opening"===this.readyState&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},xn.prototype.onclose=function(e){In("onclose"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",e),this._reconnection&&!this.skipReconnect&&this.reconnect()},xn.prototype.reconnect=function(){if(In("isUniRunningBackend() :"+Dn()),this.reconnecting||this.skipReconnect)return this;var e=this;if(this.backoff.attempts>=this._reconnectionAttempts)In("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var t=this.backoff.duration();In("will wait %dms before reconnect attempt",t),this.reconnecting=!0;var n=setTimeout((function(){e.skipReconnect||(In("attempting reconnect"),e.emitAll("reconnect_attempt",e.backoff.attempts),e.emitAll("reconnecting",e.backoff.attempts),e.skipReconnect||(Dn()?(In("Uniapp running backend, skipped reconnect..."),e.reconnecting=!1,e.reconnect(),e.emitAll("reconnect_error","Uniapp running backend, skipped reconnect...")):e.open((function(t){t?(In("reconnect attempt error"),e.reconnecting=!1,e.reconnect(),e.emitAll("reconnect_error",t.data)):(In("reconnect success"),e.onreconnect())}))))}),t);this.subs.push({destroy:function(){clearTimeout(n)}})}},xn.prototype.onreconnect=function(){var e=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",e)},function(e,t){var n=P,o=D,r=Pn,i=b.exports("socket.io-client");e.exports=t=a;var s=t.managers={};function a(e,t){"object"===h(e)&&(t=e,e=void 0),t=t||{};var o,a=n(e),c=a.source,u=a.id,l=a.path,p=s[u]&&l in s[u].nsps,f=t.forceNew||t["force new connection"]||!1===t.multiplex||p;return f?(i("ignoring socket cache for %s",c),o=r(c,t)):(s[u]||(i("new io instance for %s",c),s[u]=r(c,t)),o=s[u]),a.query&&!t.query&&(t.query=a.query),o.socket(a.path,t)}t.protocol=o.protocol,t.connect=a,t.Manager=Pn,t.Socket=qt.exports}(y,y.exports);var Fn={};(function(e){e.__esModule=!0;var t=function(){function e(){}return e.prototype.isDef=function(e){return!this.isUndef(e)},e.prototype.isUndef=function(e){return void 0===e||null===e},e.prototype.isPrimitive=function(e){return"string"===typeof e||"number"===typeof e||"symbol"===h(e)||"boolean"===typeof e},e.prototype.isObject=function(e){return null!==e&&"object"===h(e)},e.prototype.isPlainObject=function(e){return"[object Object]"===Object.prototype.toString.call(e)},e.prototype.isRegExp=function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},e.prototype.isValidArrayIndex=function(e){var t=parseFloat(String(e));return t>=0&&Math.floor(t)===t&&isFinite(e)},e.prototype.isString=function(e){return"string"===typeof e},e.prototype.isNumber=function(e){return"number"===typeof e},e.prototype.isStringOrNumber=function(e){return this.isString(e)||this.isNumber(e)},e.prototype.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},e.prototype.isEmpty=function(e){return this.isArray(e)?0===e.length:this.isObject(e)?!this.isDef(e):!this.isNumber(e)&&(this.isString(e)?""===e.trim():!this.isDef(e))},e.prototype.isNative=function(e){return"function"===typeof e&&/native code/.test(e.toString())},e.prototype.isFunction=function(e){return"function"===typeof e},e.prototype.isBoolean=function(e){return"boolean"===typeof e},e.prototype.isTrue=function(e){return!0===e},e.prototype.isFalse=function(e){return!1===e},e}(),n=new t;e["default"]=n})(Fn),function(e){e.__esModule=!0;var t=a,n=l,o=p,r=y.exports,i=Fn,s=function(){function e(){this.io=r,this.status=t.NetworkStatus.DISCONNECTED,this.permissions=[n.Permission.NONE],this.connectedObservers=[],this.disconnectedObservers=[],this.emitter=new o.Emitter(this)}return e.prototype.connect=function(){this.status=t.NetworkStatus.CONNECTING},e.prototype.emit=function(e){this.emitter.emit(e)},e.prototype.doEmit=function(e,t,n){},e.prototype.on=function(e,t){this.io.on(e,t)},e.prototype.disconnect=function(){this.io.disconnect()},e.prototype.getStatus=function(){return this.status},e.prototype.addConnectedObserver=function(e){i["default"].isFunction(e)&&this.connectedObservers.push(e)},e.prototype.addDisconnectedObserver=function(e){i["default"].isFunction(e)&&this.disconnectedObservers.push(e)},e.prototype.notify=function(e,t){for(var n=0;n<e.length;n++)e[n](t)},e}();e["default"]=s}(u);var Gn={};(function(t){var n=e&&e.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();t.__esModule=!0;var o=u,r=a,i=function(e){function t(t){var n=e.call(this)||this;return n.reconnectingObservers=[],n.addReconnectingObserver(t.onReconnecting),n.addDisconnectedObserver(t.onDisconnected),n}return n(t,e),t.prototype.connect=function(t){e.prototype.connect.call(this),this.io=this.io.connect(t.uri,t.opts),this.initListener()},t.prototype.doEmit=function(e,t,n){this.io.emit(e,t,n)},t.prototype.initListener=function(){var e=this;this.io.on("reconnecting",(function(t){e.status=r.NetworkStatus.CONNECTING,e.notify(e.reconnectingObservers,t)})),this.io.on("connect",(function(){e.status=r.NetworkStatus.CONNECTED,e.notify(e.connectedObservers)})),this.io.on("disconnect",(function(){e.status=r.NetworkStatus.DISCONNECTED,e.notify(e.disconnectedObservers)})),this.io.on("connect_error",(function(e){}))},t.prototype.addReconnectingObserver=function(e){this.reconnectingObservers.push(e)},t}(o["default"]);t["default"]=i})(Gn);var Un={},Ln={},jn={exports:{}},Bn="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(Bn){var qn=new Uint8Array(16);jn.exports=function(){return Bn(qn),qn}}else{var Vn=new Array(16);jn.exports=function(){for(var e,t=0;t<16;t++)0===(3&t)&&(e=4294967296*Math.random()),Vn[t]=e>>>((3&t)<<3)&255;return Vn}}for(var Hn=[],Wn=0;Wn<256;++Wn)Hn[Wn]=(Wn+256).toString(16).substr(1);function zn(e,t){var n=t||0,o=Hn;return[o[e[n++]],o[e[n++]],o[e[n++]],o[e[n++]],"-",o[e[n++]],o[e[n++]],"-",o[e[n++]],o[e[n++]],"-",o[e[n++]],o[e[n++]],"-",o[e[n++]],o[e[n++]],o[e[n++]],o[e[n++]],o[e[n++]],o[e[n++]]].join("")}var Jn,Xn,Yn=zn,Qn=jn.exports,Kn=Yn,$n=0,Zn=0;function eo(e,t,n){var o=t&&n||0,r=t||[];e=e||{};var i=e.node||Jn,s=void 0!==e.clockseq?e.clockseq:Xn;if(null==i||null==s){var a=Qn();null==i&&(i=Jn=[1|a[0],a[1],a[2],a[3],a[4],a[5]]),null==s&&(s=Xn=16383&(a[6]<<8|a[7]))}var c=void 0!==e.msecs?e.msecs:(new Date).getTime(),u=void 0!==e.nsecs?e.nsecs:Zn+1,l=c-$n+(u-Zn)/1e4;if(l<0&&void 0===e.clockseq&&(s=s+1&16383),(l<0||c>$n)&&void 0===e.nsecs&&(u=0),u>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");$n=c,Zn=u,Xn=s,c+=122192928e5;var p=(1e4*(268435455&c)+u)%4294967296;r[o++]=p>>>24&255,r[o++]=p>>>16&255,r[o++]=p>>>8&255,r[o++]=255&p;var f=c/4294967296*1e4&268435455;r[o++]=f>>>8&255,r[o++]=255&f,r[o++]=f>>>24&15|16,r[o++]=f>>>16&255,r[o++]=s>>>8|128,r[o++]=255&s;for(var d=0;d<6;++d)r[o+d]=i[d];return t||Kn(r)}var to=eo,no=jn.exports,oo=Yn;function ro(e,t,n){var o=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null),e=e||{};var r=e.random||(e.rng||no)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t)for(var i=0;i<16;++i)t[o+i]=r[i];return t||oo(r)}var io=ro,so=to,ao=io,co=ao;co.v1=so,co.v4=ao;var uo=co;(function(e){e.__esModule=!0;var t=uo,n=function(){function e(){}return e.get=function(){var e=t.v1();return e.replace(/-/g,"")},e}();e["default"]=n})(Ln),function(e){e.__esModule=!0;var t=Ln,n=l,o=function(){function e(e){var o=this;this.permission=n.Permission.NONE,this.singleTimeout=0,this.totalTimeout=0,this.startTime=0,this.complete=!1,this.retried=0,this.unique=!1,this.uuid=t["default"].get(),this.name=e.name,this.params=e.params,this.permission=e.permission,this.totalTimeout=e.totalTimeout,this.singleTimeout=e.singleTimeout,e.unique&&(this.unique=e.unique),this.success=function(t){o.complete||(o.complete=!0,e.success(t))},this.fail=function(t){o.complete||(o.complete=!0,e.fail(t))}}return e.prototype.start=function(){this.startTime=Date.now()},e.prototype.isTimeout=function(){var e=this.startTime+this.totalTimeout;return e<Date.now()},e}();e["default"]=o}(Un);var lo={},po={};(function(e){function t(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]}e.__esModule=!0,e["default"]=t})(po),lo.__esModule=!0,lo.MessageObserver=void 0;var fo=po,ho=function(){function e(e){this.callback=fo["default"],this.guidList=[],this.callback=e}return e.prototype.onMessage=function(e,t){if("string"==typeof t&&(t=JSON.parse(t)),t.i){var n=this.guidList.findIndex((function(e){return e===t.i}));if(n>-1)return;this.guidList.unshift(t.i),this.guidList.length>300&&this.guidList.pop()}this.callback(t)},e}();lo.MessageObserver=ho;var yo={};(function(e){e.__esModule=!0,e.SocketTimeout=void 0,function(e){e[e["connect"]=1500]="connect",e[e["reconnectionDelayMax"]=3e3]="reconnectionDelayMax",e[e["commonQuerySingle"]=2500]="commonQuerySingle",e[e["commonQueryTotal"]=12e3]="commonQueryTotal",e[e["commonRequestSingle"]=1700]="commonRequestSingle",e[e["commonRequestTotal"]=12e3]="commonRequestTotal",e[e["commonInfiniteSingle"]=1700]="commonInfiniteSingle",e[e["commonInfiniteTotal"]=864e5]="commonInfiniteTotal"}(e.SocketTimeout||(e.SocketTimeout={}))})(yo);var mo={__esModule:!0,AnonymousUserIdRepository:void 0},vo=Fn,go=sn,bo=function(){function e(){}return e.get=function(){var t=e.storage;if(null!==t){var n=t.get(e.ANONYMOUS_USER_ID_KEY);if(!vo["default"].isEmpty(n))return n.toString()}return null},e.put=function(t){var n=e.storage;null!==n&&n.put(e.ANONYMOUS_USER_ID_KEY,t.toString())},e.storage=go.LocalStorageDispatcher.localStorage(),e.ANONYMOUS_USER_ID_KEY="goeasy-anonymous-user-id",e}();mo.AnonymousUserIdRepository=bo;var So={__esModule:!0,clientInfo:void 0},Eo=Zt,_o=$t,Co=function(){function e(){this.platform=Eo.PlatformDetector.currentPlatform(),this.framework=_o.FrameworkDetector.currentFramework(),this.z=this.toZ()}return e.prototype.toZ=function(){for(var e=JSON.stringify({platform:this.platform,framework:this.framework}),t="",n=0;n<e.length;n++){var o=e.charCodeAt(n);t+=String.fromCharCode(o+5)}return t},e}(),wo=new Co;So.clientInfo=wo;var Mo={};(function(e){e.__esModule=!0,e.RocketTypes=void 0,function(e){e["authorize"]="authorize",e["manualDisconnect"]="manualDisconnect",e["subscribe"]="subscribe",e["unsubscribe"]="unsubscribe",e["publish"]="publish",e["ack"]="ack",e["historyMessages"]="historyMessages",e["hereNow"]="hereNow",e["hereNowByUserIds"]="hereNowByUserIds",e["imLastConversations"]="imLastConversations",e["markPrivateMessageAsRead"]="markPrivateMessageAsRead",e["markGroupMessageAsRead"]="markGroupMessageAsRead",e["imGroupOnlineCount"]="imGroupOnlineCount",e["imHereNow"]="imHereNow",e["imGroupHereNow"]="imGroupHereNow",e["publishIM"]="publishIM",e["subscribeUserPresence"]="subscribeUserPresence",e["unsubscribeUserPresence"]="unsubscribeUserPresence",e["subscribeGroupPresence"]="subscribeGroupPresence",e["unsubscribeGroupPresence"]="unsubscribeGroupPresence",e["removeConversation"]="removeConversation",e["topConversation"]="topConversation",e["imData"]="imData",e["subscribeGroups"]="subscribeGroups",e["unsubscribeGroup"]="unsubscribeGroup",e["IM_DELETE_MESSAGE"]="IM_DELETE_MESSAGE",e["IM_HISTORY"]="IM_HISTORY",e["IM_HISTORY_CHANGE"]="IM_HISTORY_CHANGE",e["IM_RECALL_MESSAGE"]="IM_RECALL_MESSAGE",e["IM_MARK_AS_READ"]="IM_MARK_AS_READ",e["RTC_ASK_NEW_TOKEN"]="RTC_ASK_NEW_TOKEN",e["RTC_DIAL"]="RTC_DIAL",e["RTC_ACCEPT"]="RTC_ACCEPT",e["RTC_ACCEPT_FAILED"]="RTC_ACCEPT_FAILED",e["RTC_MANUAL_END"]="RTC_MANUAL_END",e["RTC_CLIENT_BUSY"]="RTC_CLIENT_BUSY",e["RTC_TIMEOUT"]="RTC_TIMEOUT",e["RTC_CALL_DATA"]="RTC_CALL_DATA",e["CS_PENDING_CONVERSATION"]="CS_PENDING_CONVERSATION",e["CS_ACCEPT"]="CS_ACCEPT",e["CS_END"]="CS_END",e["CS_TRANSFER"]="CS_TRANSFER",e["CS_AGENTS"]="CS_AGENTS",e["CS_CUSTOMER_STATUS"]="CS_CUSTOMER_STATUS",e["CS_MY_TEAMS"]="CS_MY_TEAMS",e["CS_ONLINE"]="CS_ONLINE",e["CS_OFFLINE"]="CS_OFFLINE",e["CS_LIVE_SESSION"]="CS_LIVE_SESSION",e["CS_QUIT_LIVE"]="CS_QUIT_LIVE"}(e.RocketTypes||(e.RocketTypes={}))})(Mo);var To={__esModule:!0,GNS:void 0},Io=Fn,Ao=$t,Oo=Zt,No=Kt,ko=function(){function e(e){this.uniappPlugin=null,this.regIdPromise=null,this.onClickNotificationCallback=null,this.payloadAssemblers=new Array,this.allowNotification=e,this.supportNotification()&&(this.uniappPlugin=uni.requireNativePlugin("GoEasy-Uniapp"),this.uniappPlugin?this.regIdPromise=this.askRegId():console.warn("No GoEasy-Uniapp Native Plugin."))}return e.init=function(t){this.instance=new e(t)},e.prototype.addAssembler=function(e){this.payloadAssemblers.push(e)},e.prototype.assemblePayload=function(e){var t=this.payloadAssemblers.find((function(t){return t.support(e)}));return t?t.assemble(e):e},e.prototype.createLocalNotification=function(e,t,n){No.uniApp.runningBackend()&&(n.g=1,"undefined"!==typeof plus&&plus.push.createMessage(t,JSON.stringify(n),{title:e}))},e.prototype.askRegId=function(){var e=this,t=null,n=0,o=function o(){return new Promise((function(r,i){e.uniappPlugin.regId((function(e){console.log("askRegId - ",e),r(e)}),(function(r){if(console.log("askRegId error - ",r),!(1e6===r.data.code&&n<=10))return console.log("regId reject - ",r),clearTimeout(t),i(r);t=setTimeout((function(){n++,console.log("setTimeout askRegId - ",t),e.regIdPromise=o()}),3500)}))}))},r=o();return r},e.prototype.getRegIdPromise=function(){return this.regIdPromise},e.prototype.supportNotification=function(){var e=Oo.PlatformDetector.currentPlatform(),t=Ao.FrameworkDetector.currentFramework();return this.allowNotification&&t===Ao.Framework.UNIAPP&&(e===Oo.Platform.APP_ANDROID||e===Oo.Platform.APP_IOS)},e.prototype.listenPlusClickNotification=function(){var e=this;console.log("push.addEventListener click"),plus.push.addEventListener("click",(function(t){if(t&&e.availableIntent(t.payload))try{var n="string"===typeof t.payload?JSON.parse(t.payload):t.payload,o=e.assemblePayload(n);console.log("push parsedMessage - ",o),plus.push.clear(),e.onClickNotificationCallback(o)}catch(Kf){console.log("JSON parse error.",Kf)}}))},e.prototype.availableIntent=function(e){return e&&Object.keys(e).length&&e.g&&1===parseInt(e.g)},e.prototype.getIntentData=function(){var e=this;this.uniappPlugin.getIntentData((function(t){if(console.log("getIntentData - ",t),e.availableIntent(t)){var n=e.assemblePayload(t),o=Oo.PlatformDetector.currentPlatform();plus.push.clear(),o===Oo.Platform.APP_ANDROID&&e.uniappPlugin.clearAll(),e.onClickNotificationCallback(n)}}))},e.prototype.listenClick=function(){this.listenPlusClickNotification();var e=Oo.PlatformDetector.currentPlatform();this.uniappPlugin&&e===Oo.Platform.APP_ANDROID&&this.getIntentData()},e.prototype.onClickNotification=function(e){if(this.supportNotification()){if(!Io["default"].isFunction(e))throw new Error("The arguments must be a function.");null===this.onClickNotificationCallback?(this.onClickNotificationCallback=e,this.listenClick()):console.warn("The onClickNotification event has been listened on. Please do not listen to it more than once.")}else console.warn("The current environment doesn't support or allowNotification is false.")},e}();To.GNS=ko,function(t){var n=e&&e.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();t.__esModule=!0;var o=u,r=Gn,i=Un,c=l,p=a,f=lo,d=po,h=Fn,y=on,m=yo,v=s,g=Zt,b=mo,S=So,E=Mo,_=To,C=function(e){function t(t,n){var o=e.call(this)||this;return o.ioSocket=null,o.sid=null,o.appKey=null,o.anonymous=!1,o.userId=null,o.userData=null,o.otp=null,o.artifactVersion="0.0.0",o.uri=null,o.ioOpts=null,o.allowNotification=!1,o.reconnectingTimes=0,o.messageObservers={},o.connectFailedObservers=[],o.connectingObservers=[],o.expiredReconnectedObservers=[],o.onConnectSuccess=d["default"],o.onConnectFailed=d["default"],o.onConnectProgress=d["default"],o.setUriAndOpts(t),o.extendOptions(n),o.ioSocket=new r["default"]({onDisconnected:o.onIoDisconnected.bind(o),onReconnecting:o.onIoReconnecting.bind(o)}),o.ioSocket.addConnectedObserver(o.onIoReconnected.bind(o)),o.appKey=t.appkey,o.allowNotification=t.allowNotification,o.modules=t.modules,h["default"].isEmpty(n.id)?(o.anonymous=!0,o.userId=b.AnonymousUserIdRepository.get()):o.userId=n.id.toString(),o.artifactVersion=v["default"].version,o.addConnectedObserver(o.onConnectSuccess),o.addConnectFailedObserver(o.onConnectFailed),o.addConnectingObserver(o.onConnectProgress),o}return n(t,e),t.prototype.extendOptions=function(e){if(h["default"].isFunction(e.onSuccess)&&(this.onConnectSuccess=e.onSuccess),h["default"].isFunction(e.onFailed)&&(this.onConnectFailed=e.onFailed),h["default"].isFunction(e.onProgress)&&(this.onConnectProgress=e.onProgress),h["default"].isDef(e.data)&&!h["default"].isObject(e.data))throw{code:400,content:"TypeError: data requires an object."};var t=h["default"].isDef(e.data)?String(e.data).length:0;if(t>300){if(h["default"].isObject(e)&&h["default"].isFunction(e.onFailed))throw{code:400,content:"user.data-length limit 300 byte."}}else this.userData=e.data;if(h["default"].isObject(e.wxmpId)){if(h["default"].isEmpty(e.wxmpId.appid))throw{code:400,content:"wxmpId.appid is required."};if(h["default"].isEmpty(e.wxmpId.openid))throw{code:400,content:"wxmpId.openid is required. requires string."}}else if(h["default"].isPrimitive(e.wxmpId))throw{code:400,content:"TypeError: wxmpId requires an object."};h["default"].isDef(e.wxmpId)&&(this.wxmpId=e.wxmpId),this.otp=e.otp||null},t.prototype.setUriAndOpts=function(e){var t=!0;if(g.PlatformDetector.currentPlatform()===g.Platform.BROWSER){var n="://"+y.goEasyDomainNumber.refreshNumber()+e.host,o=void 0;!0===e.supportOldBrowser?(o=["polling","websocket"],t=!1):o=["websocket"],!1!==e.forceTLS&&t?this.uri="https"+n+":443":this.uri="http"+n+":80",this.ioOpts={transports:o,timeout:m.SocketTimeout.connect}}else this.uri="https://wx-"+e.host+":443",this.ioOpts={transports:["websocket"],reconnectionDelayMax:m.SocketTimeout.reconnectionDelayMax}},t.prototype.onIoReconnected=function(){this.status===p.NetworkStatus.RECONNECTING&&this.authorize()},t.prototype.emit=function(t){e.prototype.emit.call(this,t)},t.prototype.doEmit=function(e,t,n){t.sid=this.sid,this.ioSocket.doEmit(e,t,n)},t.prototype.sendAck=function(e,t){this.ioSocket.io.emit(e,t)},t.prototype.connect=function(){var t=this;e.prototype.connect.call(this),this.onConnecting(),this.ioSocket.connect({uri:this.uri,opts:this.ioOpts});var n=_.GNS.instance;n&&n.supportNotification()&&n.getRegIdPromise()?n.getRegIdPromise().then((function(e){console.log("Reg id is resolved: ",e),t.regId=e,t.authorize()}))["catch"]((function(e){console.warn("Failed to register the Manufacturers Push service:"+JSON.stringify(e)),t.authorize()})):this.authorize()},t.prototype.disconnect=function(){var e=this;return new Promise((function(t,n){var o=function(){e.status=p.NetworkStatus.DISCONNECTED,e.ioSocket.disconnect(),t()};if(e.allowNotification){var r=function(e){n(e)},s=new i["default"]({name:E.RocketTypes.manualDisconnect,params:{},permission:c.Permission.READ,singleTimeout:m.SocketTimeout.commonRequestSingle,totalTimeout:m.SocketTimeout.commonRequestTotal,fail:r,success:o});e.emit(s)}else o()}))},t.prototype.authorize=function(){var e={appkey:this.appKey,userId:this.userId,userData:JSON.stringify(this.userData),otp:this.otp,artifactVersion:this.artifactVersion,sid:this.sid,allowNT:this.allowNotification,regId:this.regId,wxmpId:this.wxmpId,modules:this.modules,a:this.anonymous,z:S.clientInfo.z};console.log("authorize params: ",JSON.stringify(e));var t=new i["default"]({name:E.RocketTypes.authorize,params:e,permission:c.Permission.NONE,singleTimeout:m.SocketTimeout.commonInfiniteSingle,totalTimeout:m.SocketTimeout.commonInfiniteTotal,success:this.onAuthorizeSuccess.bind(this),fail:this.onAuthorizeFailed.bind(this)});this.ioSocket.emit(t)},t.prototype.onConnecting=function(){this.notify(this.connectingObservers,this.reconnectingTimes)},t.prototype.onIoReconnecting=function(){this.reconnectingTimes++,this.status==p.NetworkStatus.CONNECTED||this.status==p.NetworkStatus.EXPIRED_RECONNECTED||this.status==p.NetworkStatus.RECONNECTING?this.status=p.NetworkStatus.RECONNECTING:this.status=p.NetworkStatus.CONNECTING,this.onConnecting()},t.prototype.onIoDisconnected=function(){this.status==p.NetworkStatus.DISCONNECTING&&(this.status=p.NetworkStatus.DISCONNECTED,this.notify(this.disconnectedObservers)),this.notify(this.disconnectedObservers)},t.prototype.onAuthorizeSuccess=function(e){if(!0===this.anonymous&&e.u&&(b.AnonymousUserIdRepository.put(e.u),this.userId=e.u),this.status===p.NetworkStatus.RECONNECTING){var t=this.sid!==e.sid;t?(this.status=p.NetworkStatus.EXPIRED_RECONNECTED,this.notify(this.expiredReconnectedObservers)):this.status=p.NetworkStatus.RECONNECTED}else this.status=p.NetworkStatus.CONNECTED,this.sid=e.sid;e.enablePublish&&(this.permissions.find((function(e){return e==c.Permission.WRITE}))||this.permissions.push(c.Permission.WRITE)),e.enableSubscribe&&(this.permissions.find((function(e){return e==c.Permission.READ}))||this.permissions.push(c.Permission.READ)),this.reconnectingTimes=0,this.notify(this.connectedObservers)},t.prototype.onAuthorizeFailed=function(e){this.ioSocket.disconnect(),this.status=p.NetworkStatus.CONNECT_FAILED;var t={code:e.resultCode||408,content:e.content||"Host unreachable or timeout"};this.notify(this.connectFailedObservers,t)},t.prototype.addConnectingObserver=function(e){h["default"].isFunction(e)&&this.connectingObservers.push(e)},t.prototype.addConnectFailedObserver=function(e){h["default"].isFunction(e)&&this.connectFailedObservers.push(e)},t.prototype.addExpiredReconnectedObserver=function(e){h["default"].isFunction(e)&&this.expiredReconnectedObservers.push(e)},t.prototype.addMessageObserver=function(e,t){var n=this;this.messageObservers[e]||(this.messageObservers[e]=[],this.ioSocket.io.on(e,(function(t){n.notifyMessageObservers(e,t)}))),this.messageObservers[e].push(new f.MessageObserver(t))},t.prototype.notifyMessageObservers=function(e,t){for(var n=this.messageObservers[e],o=0;o<n.length;o++)n[o].onMessage(e,t)},t}(o["default"]);t["default"]=C}(c);var Ro={__esModule:!0,ModuleTypes:void 0};Ro.ModuleTypes={IM:"IM",PUBSUB:"PUBSUB"};var Po={},xo={},Do={};(function(e){e.__esModule=!0;var t=Fn,n=function(){function e(){}return e.prototype.validateId=function(e,n){if(t["default"].isEmpty(e))throw{code:400,content:" ".concat(n," is required.")};if(!t["default"].isStringOrNumber(e))throw{code:400,content:"TypeError: ".concat(n," require string or number.")}},e.prototype.validateIdArray=function(e,n){if(!Array.isArray(e)||0===e.length)throw{code:400,content:"TypeError: ".concat(n," require array.")};if(e.length>300)throw{code:400,content:"".concat(n," is over max length 500.")};for(var o=0;o<e.length;o++){if(!t["default"].isStringOrNumber(e[o]))throw{code:400,content:"TypeError: ".concat(n," item require string or number.")};if(t["default"].isNumber(e[o])&&(e[o]=e[o].toString()),0==e[o].length)throw{code:400,content:"".concat(n," has empty item.")}}if(Array.from(new Set(e)).length<e.length)throw{code:400,content:"Duplicate element in ".concat(n)}},e.prototype.validateChannel=function(e,t){this.validateId(e,t)},e.prototype.validateChannelArray=function(e,t){this.validateIdArray(e,t)},e.prototype.validateChannelAndChannels=function(e,n){var o=!t["default"].isEmpty(e),r=!t["default"].isEmpty(n);if(!o&&!r)throw{code:400,content:"channel is required."};if(o&&r)throw{code:400,content:"subscribe to either channel or channels, not both."};o&&this.validateId(e,"channel"),r&&this.validateIdArray(n,"channels")},e.prototype.validateCallbackOptions=function(e){if(!t["default"].isObject(e))throw{code:400,content:"bad parameters"}},e.prototype.validateNotification=function(e){if(t["default"].isObject(e)){if(t["default"].isEmpty(e.title))throw{code:400,content:"notification.title is required."};if(!t["default"].isString(e.title))throw{code:400,content:"TypeError: notification.title requires string."};if(e.title.length>32)throw{code:400,content:"TypeError: notification.title over max length 32."};if(t["default"].isEmpty(e.body))throw{code:400,content:"notification.body is required."};if(!t["default"].isString(e.body))throw{code:400,content:"TypeError: notification.body must be string."};if(e.body.length>50)throw{code:400,content:"notification.body over max length 50."}}else if(t["default"].isPrimitive(e))throw{code:400,content:"TypeError: notification requires an object."}},e.prototype.validateValIsEmpty=function(e,n){if(t["default"].isUndef(e)||t["default"].isEmpty(e))throw{code:400,content:"".concat(n," is empty")}},e.prototype.validateWXMPTemplateMsg=function(e){if(t["default"].isObject(e)){if(!t["default"].isString(e.template_id))throw{code:400,content:"template_id must be string."};if(!t["default"].isEmpty(e.url)&&!t["default"].isString(e.url))throw{code:400,content:"url must be string"};if(!t["default"].isEmpty(e.miniprogram)&&(!t["default"].isString(e.miniprogram.appid)||!t["default"].isString(e.miniprogram.pagepath)))throw{code:400,content:"miniprogram.appid and miniprogram.pagepath must be strings."};if(!t["default"].isObject(e.data))throw{code:400,content:"data requires an object."}}else if(t["default"].isPrimitive(e))throw{code:400,content:"wxmpTemplateMsg must be an object."}},e}(),o=new n;e["default"]=o})(Do);var Fo={__esModule:!0,G:void 0},Go=function(){function e(){}return e.i=function(e){this.socket=e},e.s=function(){if(this.socket)return this.socket;throw new Error("Please connect first.")},e.u=function(){return this.s().userId},e.ud=function(){return this.s().userData},e}();Fo.G=Go,function(e){e.__esModule=!0;var t=po,n=Fn,o=Ln,r=Un,i=l,s=yo,a=Mo,c=Do,u=Fo,p=function(){function e(){}return e.prototype.publish=function(e){n["default"].isFunction(e.onFailed)||(e.onFailed=t["default"]),n["default"].isFunction(e.onSuccess)||(e.onSuccess=t["default"]),this.validate(e),e.channel=e.channel.toString();var c={channel:e.channel,content:e.message,nt:e.notification,at:e.accessToken,guid:o["default"].get()};e.wxmpTemplateMsg&&(c.wxmpTemplateMsg=e.wxmpTemplateMsg,c.wxmpTemplateMsg.data=JSON.stringify(c.wxmpTemplateMsg.data));var l=function(t){e.onSuccess({code:200,content:"ok"})},p=function(t){e.onFailed({code:t.resultCode,content:t.content})},f=new r["default"]({name:a.RocketTypes.publish,params:c,unique:!0,singleTimeout:s.SocketTimeout.commonRequestSingle,totalTimeout:s.SocketTimeout.commonRequestTotal,permission:i.Permission.WRITE,success:l,fail:p});u.G.s().emit(f)},e.prototype.validate=function(e){if(c["default"].validateChannel(e.channel,"channel"),n["default"].isEmpty(e.message))throw{code:400,content:"message is required."};if(!n["default"].isString(e.message))throw{code:400,content:"TypeError: message requires string."};if(e.message.length>2500)throw{code:400,content:"Message over max length 2500."};e.wxmpTemplateMsg&&c["default"].validateWXMPTemplateMsg(e.wxmpTemplateMsg),e.notification&&c["default"].validateNotification(e.notification)},e}();e["default"]=p}(xo);var Uo={},Lo={__esModule:!0,Subscription:void 0},jo=function(){function e(e){this.channels=e.channels,this.accessToken=e.accessToken,this.onSuccess=e.onSuccess,this.onFailed=e.onFailed,this.onMessage=e.onMessage}return e.prototype.empty=function(){},e}();Lo.Subscription=jo;var Bo={};(function(e){e.__esModule=!0,e.RemoteEvents=void 0,function(e){e["message"]="message",e["imMessage"]="imMessage",e["userPresence"]="userPresence",e["groupPresence"]="groupPresence",e["IM_MSG_READ"]="IM_MSG_READ",e["IM_MSG_DELETED"]="IM_MSG_DELETED",e["IM_MSG_RECALLED"]="IM_MSG_RECALLED",e["RTC_RING_EVENT"]="RTC_RING_EVENT",e["RTC_CANCEL_RING"]="RTC_CANCEL_RING",e["RTC_REMOTE_USER_LEFT"]="RTC_REMOTE_USER_LEFT",e["RTC_CALL_END"]="RTC_CALL_END",e["CS_ONLINE_CHANGED"]="CS_ONLINE_CHANGED"}(e.RemoteEvents||(e.RemoteEvents={}))})(Bo),Uo.__esModule=!0,Uo.Subscriber=void 0;var qo=po,Vo=Fn,Ho=Un,Wo=l,zo=Lo,Jo=yo,Xo=Mo,Yo=Bo,Qo=Do,Ko=To,$o=Fo,Zo=function(){function e(){this.subscriptions=[],Ko.GNS.instance.addAssembler(new(function(){function e(){}return e.prototype.assemble=function(e){return{channel:e.ch,content:e.ctt}},e.prototype.support=function(e){return!!e.ch},e}()))}return e.prototype.initialGoEasySocket=function(){$o.G.s().addMessageObserver(Yo.RemoteEvents.message,this.onNewMessage.bind(this)),$o.G.s().addExpiredReconnectedObserver(this.onExpiredReconnected.bind(this))},e.prototype.resubscribe=function(){var e=this.subscriptions.slice(0);this.subscriptions=[];for(var t=0;t<e.length;t++)0!=e[t].channels.length&&this.subscribe(e[t])},e.prototype.clearSubscriptions=function(){this.subscriptions=[]},e.prototype.onExpiredReconnected=function(){this.resubscribe()},e.prototype.onNewMessage=function(e){if(!(e.n.indexOf("_presence")>-1)){console.log("Subscriber -> onNewMessage: ",e),e.a&&$o.G.s().sendAck("ack",{publishGuid:e.i});var t={time:e.t,channel:e.n,content:e.c};this.createNotification(e);var n=this.findSubscriptionByChannel(t.channel);n.onMessage(t)}},e.prototype.createNotification=function(e){var t=Ko.GNS.instance.supportNotification();if(Vo["default"].isObject(e.nt)&&t){var n={ch:e.n,ctt:e.c};Ko.GNS.instance.createLocalNotification(e.nt.t,e.nt.c,n)}},e.prototype.formatOptions=function(e){this.formatCallback(e),Vo["default"].isFunction(e.onMessage)||(e.onMessage=qo["default"]),e.channel&&(e.channel=e.channel.toString(),e.channels=[e.channel]),e.channels&&(e.channels=e.channels.toString().split(","))},e.prototype.formatCallback=function(e){Vo["default"].isFunction(e.onSuccess)||(e.onSuccess=qo["default"]),Vo["default"].isFunction(e.onFailed)||(e.onFailed=qo["default"])},e.prototype.subscribe=function(e){var t=this;Qo["default"].validateChannelAndChannels(e.channel,e.channels),this.formatOptions(e);var n=function(){var n=new zo.Subscription({channels:e.channels,accessToken:e.accessToken,onSuccess:e.onSuccess,onFailed:e.onFailed,onMessage:e.onMessage});t.subscriptions.push(n),e.onSuccess({code:200,content:"ok"})},o=function(t){e.onFailed({code:t.resultCode,content:t.content})},r=new Ho["default"]({name:Xo.RocketTypes.subscribe,permission:Wo.Permission.READ,singleTimeout:Jo.SocketTimeout.commonInfiniteSingle,totalTimeout:Jo.SocketTimeout.commonInfiniteTotal,params:{channels:e.channels,accessToken:e.accessToken},success:n,fail:o});$o.G.s().emit(r)},e.prototype.unsubscribe=function(e){var t=this;if(Qo["default"].validateChannel(e.channel,"channel"),e.channel=e.channel.toString(),this.findSubscriptionByChannel(e.channel)){var n=function(){e.onSuccess({code:200,content:"ok"}),t.removeChannel(e.channel)},o=function(t){e.onFailed({code:t.resultCode,content:t.content})},r=new Ho["default"]({name:Xo.RocketTypes.unsubscribe,params:{channel:e.channel},permission:Wo.Permission.READ,singleTimeout:Jo.SocketTimeout.commonRequestSingle,totalTimeout:Jo.SocketTimeout.commonRequestTotal,success:n,fail:o});$o.G.s().emit(r)}else e.onFailed({code:400,content:"channel["+e.channel+"] is not subscribed"})},e.prototype.removeChannel=function(e){for(var t=0;t<this.subscriptions.length;t++)for(var n=this.subscriptions[t].channels,o=0;o<n.length;o++)if(n[o]==e){this.subscriptions[t].channels.splice(o,1);break}},e.prototype.findSubscriptionByChannel=function(e){for(var t=!1,n=null,o=this.subscriptions.length-1;o>=0;o--){for(var r=this.subscriptions[o].channels,i=0;i<r.length;i++)if(r[i]==e){t=!0,n=this.subscriptions[o];break}if(t)break}return n},e}();Uo.Subscriber=Zo;var er={__esModule:!0,History:void 0},tr=po,nr=Fn,or=Un,rr=l,ir=yo,sr=Mo,ar=Do,cr=Fo,ur=function(){function e(){}return e.prototype.get=function(e){nr["default"].isFunction(e.onSuccess)||(e.onSuccess=tr["default"]),nr["default"].isFunction(e.onFailed)||(e.onFailed=tr["default"]),ar["default"].validateChannel(e.channel,"channel"),e.channel=e.channel.toString();var t=function(t){e.onSuccess({code:t.resultCode||t.code||200,content:t.content})},n=function(t){e.onFailed({code:t.resultCode||t.code,content:t.content})},o=new or["default"]({name:sr.RocketTypes.historyMessages,permission:rr.Permission.READ,params:e,singleTimeout:ir.SocketTimeout.commonQuerySingle,totalTimeout:ir.SocketTimeout.commonQueryTotal,success:t,fail:n});cr.G.s().emit(o)},e}();er.History=ur;var lr={},pr={__esModule:!0,PresenceSubscription:void 0},fr=function(){function e(e){this.channels=e.channels,this.onSuccess=e.onSuccess,this.onFailed=e.onFailed,this.onPresence=e.onPresence}return e}();pr.PresenceSubscription=fr,lr.__esModule=!0,lr.PresenceSubscriber=void 0;var dr=po,hr=Fn,yr=Un,mr=l,vr=yo,gr=pr,br=Mo,Sr=Bo,Er=Do,_r=Fo,Cr=function(){function e(){this.presenters=[]}return e.prototype.initialGoEasySocket=function(){_r.G.s().addMessageObserver(Sr.RemoteEvents.message,this.onNewMessage.bind(this)),_r.G.s().addExpiredReconnectedObserver(this.onExpiredReconnected.bind(this))},e.prototype.resubscribe=function(){var e=this.presenters.slice(0);this.presenters=[];for(var t=0;t<e.length;t++){for(var n=0;n<e[t].channels.length;n++){var o=e[t].channels[n].split("_presence");e[t].channels[n]=o[0]}0!=e[t].channels.length&&this.subscribePresence(e[t])}},e.prototype.onExpiredReconnected=function(){this.resubscribe()},e.prototype.onNewMessage=function(e){if(-1!=e.n.indexOf("_presence")){var t=this.findPresenceByChannel(e.n);if(t){var n=JSON.parse(e.c);n.events=n.events.map((function(e){var t=e.userData?JSON.parse(e.userData):{};return{time:e.time,action:e.action,id:e.userId,data:t}})),t.onPresence(n)}}},e.prototype.formatOptions=function(e){this.formatCallback(e),hr["default"].isFunction(e.onPresence)||(e.onPresence=dr["default"]),e.channel&&(e.channel=e.channel.toString(),e.channels=[e.channel]),e.channels&&(e.channels=e.channels.toString().split(","))},e.prototype.formatCallback=function(e){hr["default"].isFunction(e.onSuccess)||(e.onSuccess=dr["default"]),hr["default"].isFunction(e.onFailed)||(e.onFailed=dr["default"])},e.prototype.subscribePresence=function(e){var t=this;Er["default"].validateChannelAndChannels(e.channel,e.channels),this.formatOptions(e),Array.isArray(e.channels)&&(e.channels=e.channels.map((function(e){return e+="_presence",e})));var n=function(){var n=new gr.PresenceSubscription({channels:e.channels,onSuccess:e.onSuccess,onFailed:e.onFailed,onPresence:e.onPresence});t.presenters.push(n),e.onSuccess({code:200,content:"ok"})},o=function(t){e.onFailed({code:t.resultCode,content:t.content})},r=new yr["default"]({name:br.RocketTypes.subscribe,permission:mr.Permission.READ,singleTimeout:vr.SocketTimeout.commonInfiniteSingle,totalTimeout:vr.SocketTimeout.commonInfiniteTotal,params:{channels:e.channels},success:n,fail:o});_r.G.s().emit(r)},e.prototype.unsubscribePresence=function(e){var t=this;if(this.formatCallback(e),hr["default"].isDef(e.channel))if(e.channel+="_presence",this.findPresenceByChannel(e.channel)){var n=new yr["default"]({name:br.RocketTypes.unsubscribe,params:{channel:e.channel},permission:mr.Permission.READ,singleTimeout:vr.SocketTimeout.commonRequestSingle,totalTimeout:vr.SocketTimeout.commonRequestTotal,success:function(){e.onSuccess({code:200,content:"ok"}),t.removeChannel(e.channel)},fail:function(t){e.onFailed({code:t.resultCode,content:t.content})}});_r.G.s().emit(n)}else e.onFailed({code:400,content:"channel["+e.channel+"] is not subscribed"});else e.onFailed({code:400,content:"channel is required"})},e.prototype.removeChannel=function(e){for(var t=0;t<this.presenters.length;t++)for(var n=this.presenters[t].channels,o=0;o<n.length;o++)if(n[o]==e){this.presenters[t].channels.splice(o,1);break}},e.prototype.findPresenceByChannel=function(e){for(var t=!1,n=null,o=this.presenters.length-1;o>=0;o--){for(var r=this.presenters[o].channels,i=0;i<r.length;i++)if(r[i]==e){t=!0,n=this.presenters[o];break}if(t)break}return n},e}();lr.PresenceSubscriber=Cr;var wr={__esModule:!0,HereNow:void 0},Mr=po,Tr=Fn,Ir=Un,Ar=l,Or=yo,Nr=Mo,kr=Do,Rr=Fo,Pr=function(){function e(){}return e.prototype.byChannel=function(e){var t={channels:[],includeUsers:!1,distinct:!1};Tr["default"].isFunction(e.onSuccess)||(e.onSuccess=Mr["default"]),Tr["default"].isFunction(e.onFailed)||(e.onFailed=Mr["default"]),kr["default"].validateChannelArray(e.channels,"channels"),t.channels=e.channels.toString().split(","),t.includeUsers=e.includeUsers||!1,t.distinct=e.distinct||!1;var n=function(t){var n=t.content,o=n.channels;for(var r in o)if(o.hasOwnProperty(r)){var i=o[r];i.users&&(i.users=i.users.map((function(e){return e.data=e.data?JSON.parse(e.data):{},e})))}e.onSuccess({code:t.resultCode||t.code||200,content:n})},o=function(t){e.onFailed({code:t.resultCode||t.code||200,content:t.content})},r=new Ir["default"]({name:Nr.RocketTypes.hereNow,permission:Ar.Permission.READ,params:t,singleTimeout:Or.SocketTimeout.commonQuerySingle,totalTimeout:Or.SocketTimeout.commonQueryTotal,success:n,fail:o});Rr.G.s().emit(r)},e.prototype.byUserId=function(e){var t={userIds:[],distinct:!0};Tr["default"].isFunction(e.onSuccess)||(e.onSuccess=Mr["default"]),Tr["default"].isFunction(e.onFailed)||(e.onFailed=Mr["default"]),kr["default"].validateIdArray(e.userIds,"userIds"),t.userIds=e.userIds.toString().split(","),0==e.distinct&&(t.distinct=!1);var n=function(t){var n=t.content;n=n.map((function(e){var t={id:e.userId,data:e.userData?JSON.parse(e.userData):{}};return t})),e.onSuccess({code:t.resultCode||t.code||200,content:n})},o=function(t){e.onFailed({code:t.resultCode||t.code||200,content:t.content})},r=new Ir["default"]({name:Nr.RocketTypes.hereNowByUserIds,permission:Ar.Permission.READ,params:t,singleTimeout:Or.SocketTimeout.commonQuerySingle,totalTimeout:Or.SocketTimeout.commonQueryTotal,success:n,fail:o});Rr.G.s().emit(r)},e}();wr.HereNow=Pr;var xr={__esModule:!0,CallbackUtils:void 0},Dr=Fn,Fr=function(){function e(){}return e.onSuccess=function(e,t){Dr["default"].isFunction(e.onSuccess)&&e.onSuccess(t)},e.onFailed=function(e,t){if(!Dr["default"].isObject(e)||!Dr["default"].isFunction(e.onFailed))throw t;e.onFailed(t)},e}();xr.CallbackUtils=Fr,Po.__esModule=!0,Po.PubSub=void 0;var Gr=xo,Ur=Uo,Lr=er,jr=lr,Br=wr,qr=xr,Vr=a,Hr=Ro,Wr=Fo,zr=function(){function e(e){this.subscriber=new Ur.Subscriber,this.options=e}return e.init=function(t){e.instance=new e(t)},e.prototype.initialGoEasySocket=function(){this.publisher=new Gr["default"],this.histories=new Lr.History,this.presence=new jr.PresenceSubscriber,this.hereNows=new Br.HereNow,this.subscriber.initialGoEasySocket(),this.presence.initialGoEasySocket()},e.prototype.initialBeforeConnect=function(){this.subscriber.clearSubscriptions()},e.prototype["catch"]=function(e,t){try{this.validateOptions(),e()}catch(Qf){qr.CallbackUtils.onFailed(t,Qf)}},e.prototype.validateOptions=function(){if(!Wr.G.s()||Wr.G.s().getStatus()!==Vr.NetworkStatus.CONNECTED)throw Error("Please call connect() first.");if(!this.options.modules||!this.options.modules.includes(Hr.ModuleTypes.PUBSUB))throw{code:400,content:"Invalid options: module '".concat(Hr.ModuleTypes.PUBSUB,"' is not enabled")}},e.prototype.publish=function(e){var t=this;this["catch"]((function(){t.publisher.publish(e)}),e)},e.prototype.subscribe=function(e){var t=this;this["catch"]((function(){t.subscriber.subscribe(e)}),e)},e.prototype.unsubscribe=function(e){var t=this;this["catch"]((function(){t.subscriber.unsubscribe(e)}),e)},e.prototype.subscribePresence=function(e){var t=this;this["catch"]((function(){t.presence.subscribePresence(e)}),e)},e.prototype.unsubscribePresence=function(e){var t=this;this["catch"]((function(){t.presence.unsubscribePresence(e)}),e)},e.prototype.history=function(e){var t=this;this["catch"]((function(){t.histories.get(e)}),e)},e.prototype.hereNow=function(e){var t=this;this["catch"]((function(){t.hereNows.byChannel(e)}),e)},e.prototype.hereNowByUserIds=function(e){var t=this;this["catch"]((function(){t.hereNows.byUserId(e)}),e)},e}();Po.PubSub=zr;var Jr={},Xr={},Yr={};(function(e){e.__esModule=!0,e.ImApiEvents=void 0,function(e){e["PRIVATE_MESSAGE_RECEIVED"]="PRIVATE_MESSAGE_RECEIVED",e["GROUP_MESSAGE_RECEIVED"]="GROUP_MESSAGE_RECEIVED",e["SYSTEM_MESSAGE_RECEIVED"]="SYSTEM_MESSAGE_RECEIVED",e["CONVERSATIONS_UPDATED"]="CONVERSATIONS_UPDATED",e["USER_PRESENCE"]="USER_PRESENCE",e["GROUP_PRESENCE"]="GROUP_PRESENCE",e["MESSAGE_DELETED"]="MESSAGE_DELETED",e["MESSAGE_READ"]="MESSAGE_READ",e["MESSAGE_RECALLED"]="MESSAGE_RECALLED",e["CS_MESSAGE_RECEIVED"]="CS_MESSAGE_RECEIVED",e["PENDING_CONVERSATIONS_UPDATED"]="PENDING_CONVERSATIONS_UPDATED"}(e.ImApiEvents||(e.ImApiEvents={}))})(Yr);var Qr={};(function(e){e.__esModule=!0,e.RTCApiEvents=void 0,function(e){e["RING"]="RING",e["USER_ACCEPTED"]="USER_ACCEPTED",e["CALL_ENDED"]="CALL_ENDED",e["USER_QUITED"]="USER_QUITED"}(e.RTCApiEvents||(e.RTCApiEvents={}))})(Qr),Xr.__esModule=!0,Xr.ApiEventCenter=void 0;var Kr=Yr,$r=Qr,Zr=F.exports,ei=Fn,ti=function(){function e(){this.emitter=new Zr}return e.prototype.on=function(e,t){if(!ei["default"].isString(e))throw Error("event require a string.");if(!ei["default"].isDef(Kr.ImApiEvents[e])&&!ei["default"].isDef($r.RTCApiEvents[e]))throw Error("An event that is not defined");if(!ei["default"].isFunction(t))throw Error("callback must be a function");this.emitter.on(e,t)},e.prototype.fire=function(e,t){this.emitter.emit(e,t)},e.prototype.off=function(e,t){this.emitter.off(e,t)},e}();Xr.ApiEventCenter=ti;var ni={},oi={},ri={},ii={};(function(e){e.__esModule=!0;var t=function(){function e(){}return e.prototype.upload=function(e,t){throw Error("Not implementation yet.")},e}();e["default"]=t})(ii);var si=e&&e.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();ri.__esModule=!0,ri.uniAppFileUploader=void 0;var ai=ii,ci=function(e){function t(){return e.call(this)||this}return si(t,e),t.prototype.upload=function(e,t){var n=this;try{return new Promise((function(o,r){var i=uni.uploadFile({url:e.host,filePath:n.getTempFilePath(e),name:"file",formData:e.parameters,success:function(t){if(200===t.statusCode){var n=e.payload;n.message=t.errMsg,o({code:200,content:n})}else r({code:t.statusCode,content:t.errMsg})},fail:function(e){r({code:500,content:e.errMsg})}});i.onProgressUpdate((function(e){t&&t(e)}))}))}catch(Kf){return new Promise((function(t,n){n({code:500,content:Kf})}))}},t.prototype.getTempFilePath=function(e){console.log("uploadRequest",e);var t=e.file,n=t.tempFilePath||t.fullPath||t.path;return n},t}(ai["default"]),ui=new ci;ri.uniAppFileUploader=ui;var li={},pi=e&&e.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();li.__esModule=!0,li.wxFileUploader=void 0;var fi=ii,di=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return pi(t,e),t.prototype.upload=function(e,t){var n=this;try{return new Promise((function(o,r){var i=wx.uploadFile({url:e.host,filePath:n.getTempFilePath(e),name:"file",formData:e.parameters,success:function(t){if(200===t.statusCode){var n=e.payload;n.message=t.errMsg,o({code:200,content:n})}else r({code:t.statusCode,content:t.errMsg})},fail:function(e){r({code:500,content:e.errMsg})}});i.onProgressUpdate((function(e){t&&t(e)}))}))}catch(Kf){return new Promise((function(t,n){n({code:500,content:Kf})}))}},t.prototype.getTempFilePath=function(e){var t=e.file||e.fileRes;return t.path||t.tempFilePath},t}(fi["default"]),hi=new di;li.wxFileUploader=hi;var yi={},mi=e&&e.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();yi.__esModule=!0,yi.htmlFileUploader=void 0;var vi=ii,gi=function(e){function t(){return e.call(this)||this}return mi(t,e),t.prototype.upload=function(e,t){try{return new Promise((function(n,o){var r=new XMLHttpRequest;for(var i in r.open("post",e.host,!0),e.headers)r.setRequestHeader(i,e.headers[i]);r.upload.onprogress=function(e){t&&t(e)},r.upload.onloadstart=function(e){t&&t(e)},r.upload.onloadend=function(e){t&&t(e)};var s=new FormData;for(var a in e.parameters)"fileRes"==a?s.append("file",e.parameters[a]):s.append(a,e.parameters[a]);r.send(s),r.onreadystatechange=function(){if(4==r.readyState)if(r.status>=200&&r.status<300||304==r.status){var t=e.payload;t.message=r.responseText,n({code:200,content:t})}else o({code:r.status,content:r.responseText})}}))}catch(Kf){return new Promise((function(t,n){n({code:500,content:Kf})}))}},t}(vi["default"]),bi=new gi;yi.htmlFileUploader=bi,oi.__esModule=!0,oi.fileUploader=oi.FileUploader=void 0;var Si=ri,Ei=li,_i=yi,Ci=$t,wi=function(){function e(){var e;this.uploader=(e={},e[Ci.Framework.UNIAPP]=Si.uniAppFileUploader,e[Ci.Framework.NATIVE_APPLET_WX]=Ei.wxFileUploader,e[Ci.Framework.UNKNOWN]=_i.htmlFileUploader,e)}return e.prototype.upload=function(e,t){var n=Ci.FrameworkDetector.currentFramework();return console.log("upload",n),this.uploader[n].upload(e,t)},e}();oi.FileUploader=wi;var Mi=new wi;oi.fileUploader=Mi;var Ti={},Ii={},Ai={};(function(e){e.__esModule=!0,e.OssType=void 0,function(e){e["aliYun"]="ALI",e["qiNiu"]="QN"}(e.OssType||(e.OssType={}))})(Ai);var Oi={},Ni={};(function(e){e.__esModule=!0;var t=function(){function e(e,t,n,o,r){this.host=e,this.headers=t,this.parameters=n,this.file=o,this.payload=r}return e}();e["default"]=t})(Ni);var ki={};(function(e){e.__esModule=!0;var t=function(){function e(){}return e.prototype.build=function(e,t,n){},e.prototype.newFileName=function(e){return e&&e.newFilename||""},e}();e["default"]=t})(ki);var Ri={};(function(e){e.__esModule=!0,e.MessageType=void 0,function(e){e["TEXT"]="text",e["IMAGE"]="image",e["FILE"]="file",e["VIDEO"]="video",e["AUDIO"]="audio"}(e.MessageType||(e.MessageType={}))})(Ri);var Pi=e&&e.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();Oi.__esModule=!0,Oi.aliYunOSSRequestBuilder=Oi.AliYunOSSRequestBuilder=void 0;var xi=Ni,Di=ki,Fi=Ri,Gi=function(e){function t(){return e.call(this)||this}return Pi(t,e),t.prototype.url=function(e){return e.host+"/"+e.dir+"/"+this.newFileName(e)},t.prototype.build=function(e,t,n){var o;o={key:e.dir+"/"+this.newFileName(e),OSSAccessKeyId:e.accessKeyId,policy:e.policy,signature:e.signature,success_action_status:"200",fileRes:t},Fi.MessageType.FILE===n&&(o={key:e.dir+"/"+this.newFileName(e),OSSAccessKeyId:e.accessKeyId,policy:e.policy,signature:e.signature,success_action_status:"200","Content-Disposition":"attachment;filename="+t.name,fileRes:t});var r={newFileName:this.newFileName(e),url:this.url(e)};return new xi["default"](e.host,null,o,t,r)},t}(Di["default"]);Oi.AliYunOSSRequestBuilder=Gi;var Ui=new Gi;Oi.aliYunOSSRequestBuilder=Ui;var Li={},ji=e&&e.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();Li.__esModule=!0,Li.qiNiuYunOSSRequestBuilder=void 0;var Bi=ki,qi=Ni,Vi=function(e){function t(){return e.call(this)||this}return ji(t,e),t.prototype.url=function(e){return e.downloadUrl},t.prototype.build=function(e,t){var n={key:this.newFileName(e),token:e.token,file:t},o={newFileName:this.newFileName(e),url:this.url(e)};return new qi["default"](e.host,null,n,t,o)},t}(Bi["default"]),Hi=new Vi;Li.qiNiuYunOSSRequestBuilder=Hi,Ii.__esModule=!0,Ii.OSSRequestFactory=void 0;var Wi=Ai,zi=Oi,Ji=Li,Xi=function(){function e(e){return e===Wi.OssType.aliYun?zi.aliYunOSSRequestBuilder:Ji.qiNiuYunOSSRequestBuilder}return e.prototype.build=function(e,t,n){},e}();Ii.OSSRequestFactory=Xi;var Yi={};(function(e){e.__esModule=!0;var t=Un,n=l,o=yo,r=Fo,i=function(){function e(){}return e.prototype.resolve=function(e){return new Promise((function(i,s){var a=new t["default"]({name:"uploadToken",params:{filename:e},permission:n.Permission.WRITE,singleTimeout:o.SocketTimeout.commonRequestSingle,totalTimeout:o.SocketTimeout.commonRequestTotal,fail:function(e){s(e)},success:function(e){200===e.code?i(e):s(e)}});r.G.s().emit(a)}))},e}();e["default"]=i})(Yi),function(e){e.__esModule=!0;var t=Ii,n=Yi,o=function(){function e(){this.uploadTokenResolver=new n["default"]}return e.prototype.build=function(e,n,o){var r=this;return new Promise((function(i,s){r.uploadTokenResolver.resolve(n).then((function(n){var r=n.content;i(new t.OSSRequestFactory(r.vendor).build(r,e,o))}))["catch"]((function(e){s(e)}))}))},e}();e["default"]=o}(Ti),ni.__esModule=!0,ni.GoEasyUploader=void 0;var Qi=oi,Ki=Ti,$i=function(){function e(){this.requestBuilder=new Ki["default"],this.fileUploader=Qi.fileUploader}return e.prototype.upload=function(e,t,n,o){var r=this;return new Promise((function(i,s){var a=r.requestBuilder.build(e,t,o);a.then((function(e){i(r.doUpload(e,n))}))["catch"]((function(e){s(e)}))}))},e.prototype.customizeUpload=function(e,t){this.doUpload(e,t)},e.prototype.doUpload=function(e,t){return this.fileUploader.upload(e,t)},e}();ni.GoEasyUploader=$i;var Zi={},es={},ts={},ns={__esModule:!0,AbstractPayloadImprover:void 0},os=function(){function e(){}return e}();ns.AbstractPayloadImprover=os;var rs=e&&e.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();ts.__esModule=!0,ts.FileMessagePayloadImprover=void 0;var is=ns,ss=ni,as=Ri,cs=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.goEasyUploader=new ss.GoEasyUploader,t}return rs(t,e),t.prototype.improve=function(e){var t=this,n=e.message;return new Promise((function(e,o){var r,i,s=n.buildOptions,a=s.createOptions;n.type===as.MessageType.VIDEO?(i=n.payload,r=i.video.name):(i=n.payload,r=i.name);var c=t.goEasyUploader.upload(a.file,r,a.onProgress,n.type);c.then((function(o){t.setPayload(o,n),e()}))["catch"]((function(e){o(e)}))}))},t.prototype.setPayload=function(e,t){var n=e.content,o=void 0===n?{}:n,r=t.payload;r.url=o.url},t}(is.AbstractPayloadImprover);ts.FileMessagePayloadImprover=cs;var us={},ls=e&&e.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();us.__esModule=!0,us.VideoMessagePayloadImprover=void 0;var ps=ts,fs=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ls(t,e),t.prototype.setPayload=function(e,t){e.content;var n=t.payload,o="?x-oss-process=video/snapshot,t_0000,f_jpg,w_"+n.video.width+",m_fast,ar_auto";n.video.url=e.content.url,n.thumbnail.url=e.content.url+o,n.video.name=e.content.newFileName},t}(ps.FileMessagePayloadImprover);us.VideoMessagePayloadImprover=fs,es.__esModule=!0,es.PayloadImprover=void 0;var ds=ts,hs=us,ys=Ri,ms=function(){function e(){var e;this.improvers=(e={},e[ys.MessageType.FILE]=new ds.FileMessagePayloadImprover,e[ys.MessageType.AUDIO]=new ds.FileMessagePayloadImprover,e[ys.MessageType.IMAGE]=new ds.FileMessagePayloadImprover,e[ys.MessageType.VIDEO]=new hs.VideoMessagePayloadImprover,e)}return e.prototype.improve=function(e){var t=this.improvers[e.message.type];return t?t.improve(e):Promise.resolve()},e}();es.PayloadImprover=ms;var vs={};(function(e){e.__esModule=!0;var t=Ri,n=s,o=function(){function e(e,t,o,r,i){this.validate(e),this.mt=e.type,this.to=t.id.toString(),this.d=JSON.stringify(t.data),this.p=JSON.stringify(e.payload),o&&(this.nt=o),i&&(this.at=i),r&&(r.data=JSON.stringify(r.data),this.wxmpTemplateMsg=r);var s=t.type;if(this.t=s,s===n.Scene.CS){var a=e;this.tid=a.teamId}this.guid=e.messageId}return e.prototype.validate=function(e){if(e.type===t.MessageType.TEXT){var n=JSON.stringify(e.payload).length;if(n>3072)throw Error("message-length limit 3kb")}},e}();e["default"]=o})(vs);var gs={},bs={__esModule:!0,EmitterEventDriver:void 0},Ss=F.exports,Es=function(){function e(){this.emitter=new Ss}return e.prototype.on=function(e,t){return this.emitter.on(e,t),this},e.prototype.once=function(e,t){return this.emitter.once(e,t),this},e.prototype.off=function(e,t){return this.emitter.off(e,t),this},e.prototype.fire=function(e,t){return this.emitter.emit(e,t),this},e}();bs.EmitterEventDriver=Es,gs.__esModule=!0,gs.GoEasyEventCenter=void 0;var _s=bs,Cs=function(){function e(){}return e.initial=function(){this.eventDriver=new _s.EmitterEventDriver},e.on=function(e,t){this.eventDriver.on(e,t)},e.off=function(e,t){this.eventDriver.off(e,t)},e.once=function(e,t){this.eventDriver.once(e,t)},e.fire=function(e,t){this.eventDriver.fire(e,t)},e}();gs.GoEasyEventCenter=Cs;var ws={};(function(e){e.__esModule=!0,e.IM_INTERNAL_EVENTS=void 0,function(e){e["MESSAGE_SENDING"]="IM_INTERNAL_MESSAGE_SENDING",e["MESSAGE_SEND_SUCCESS"]="IM_INTERNAL_MESSAGE_SEND_SUCCESS",e["MESSAGE_SEND_FAILED"]="IM_INTERNAL_MESSAGE_SEND_FAILED",e["MESSAGE_RECEIVED"]="IM_INTERNAL_MESSAGE_RECEIVED",e["MAX_MESSAGE_CHANGED"]="IM_INTERNAL_MAX_MESSAGE_CHANGED",e["UNREAD_AMOUNT_CHANGED"]="IM_INTERNAL_UNREAD_MESSAGE_CHANGED",e["CS_ONLINE_SUCCESS"]="CS_ONLINE_SUCCESS",e["CS_OFFLINE_SUCCESS"]="CS_OFFLINE_SUCCESS",e["CS_ACCEPTED"]="CS_ACCEPTED",e["CS_ENDED"]="CS_ENDED",e["CS_TRANSFER"]="CS_TRANSFER",e["CS_AGENT_MESSAGE_RECEIVED"]="CS_AGENT_MESSAGE_RECEIVED"}(e.IM_INTERNAL_EVENTS||(e.IM_INTERNAL_EVENTS={}))})(ws);var Ms={__esModule:!0,AbstractMessage:void 0},Ts=Fo,Is=function(){function e(){}return e.prototype.clearUseLessAttribute=function(){delete this.buildOptions},e.prototype.isOtherSent=function(){return this.senderId!==Ts.G.u()},e.prototype.getToData=function(){var e=this.buildOptions,t=e.createOptions;return t.to.data},e}();Ms.AbstractMessage=Is,function(e){e.__esModule=!0;var t=Un,n=l,o=yo,r=es,i=vs,a=gs,c=ws,u=s,p=Ms,f=Mo,d=Fo,h=xr,y=function(){function e(){this.payloadImprover=new r.PayloadImprover}return e.prototype.send=function(e){var t=this;this.validate(e);var n=e.message,o=e.accessToken,r=n.buildOptions,i=r.createOptions,s=i.notification,a=i.wxmpTemplateMsg,c=i.to;c.data||(c.data={}),n.status=u.MessageStatus.SENDING;var l=r.complete,p=this.payloadImprover.improve(e);Promise.all([l,p]).then((function(){t.doSend(n,c,s,a,o,e)}))["catch"]((function(t){n.status=u.MessageStatus.FAIL,h.CallbackUtils.onFailed(e,{code:t.code||400,content:t.content||t})}))},e.prototype.doSend=function(e,r,s,l,p,y){var m=new i["default"](e,r,s,l,p);a.GoEasyEventCenter.fire(c.IM_INTERNAL_EVENTS.MESSAGE_SENDING,e);var v=new t["default"]({name:f.RocketTypes.publishIM,params:m,unique:!0,permission:n.Permission.WRITE,singleTimeout:o.SocketTimeout.commonRequestSingle,totalTimeout:o.SocketTimeout.commonRequestTotal,fail:function(t){e.status=u.MessageStatus.FAIL,a.GoEasyEventCenter.fire(c.IM_INTERNAL_EVENTS.MESSAGE_SEND_FAILED,e),h.CallbackUtils.onFailed(y,{code:t.resultCode,content:t.content})},success:function(t){if(e.status=u.MessageStatus.SUCCESS,e.timestamp=t.content.timestamp,e.scene()===u.Scene.CS){var n=e;n.customerId()!==d.G.u()&&(n.sessionId=t.content.sessionId)}e.clearUseLessAttribute(),a.GoEasyEventCenter.fire(c.IM_INTERNAL_EVENTS.MESSAGE_SEND_SUCCESS,e),h.CallbackUtils.onSuccess(y,e)}});d.G.s().emit(v)},e.prototype.validate=function(e){var t=e.message;if(!(t instanceof p.AbstractMessage))throw new Error("it is invalid message");if(t.status!==u.MessageStatus.NEW)throw new Error("Please create a new message, a message can only be sent once")},e}();e["default"]=y}(Zi);var As={},Os={},Ns={},ks={},Rs={},Ps={},xs={__esModule:!0,SortedInserter:void 0},Ds=function(){function e(){}return e.prototype.insert=function(e,t){var n=this.binarySearch(e,t);if(n>=0)e.splice(n,1,t);else{var o=-n-1;e.splice(o,0,t)}},e.prototype.binarySearch=function(e,t){var n=0,o=e.length-1;while(n<=o){var r=o+n>>1,i=this.compare(t,e[r]);if(i>0)n=r+1;else{if(!(i<0))return r;o=r-1}}return-n-1},e}();xs.SortedInserter=Ds,function(t){var n=e&&e.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();t.__esModule=!0;var o=s,r=Fn,i=xs,a=function(){function e(e){this.messages=new Array,this.allLoaded=!1,this.target=e}return e.prototype.all=function(){return this.messages},e.prototype.sliceOverLengthMessages=function(){this.messages.length>e.CACHE_MAX_LENGTH&&(this.messages=this.messages.slice(-e.CACHE_MAX_LENGTH),!0===this.allLoaded&&(this.allLoaded=!1))},e.prototype.getMaxMessage=function(){return this.messages[this.messages.length-1]},e.prototype.loadLocalMessages=function(e,t){var n=[],o=this.messages.length;if(t){if(o>0){var r=this.messages[0].timestamp,i=this.messages[o-1].timestamp,s=t>=r&&t<=i;if(s)for(var a=o-1;a>=0;a--){var c=this.messages[a];if(c.timestamp<t){if(!(n.length<e))break;n.unshift(c)}}}}else n=this.messages.slice(-e);return n},e.prototype.cacheServerMessages=function(t,n){var o=this.messages[0],r=this.messages.length;this.messages.length<e.CACHE_MAX_LENGTH&&(!t.lastTimestamp||r>0&&o.timestamp===t.lastTimestamp)&&(this.messages=n.concat(this.messages),n.length<t.limit&&(this.allLoaded=!0))},e.prototype.findMessageByTime=function(e){return this.messages.find((function(t){return e===t.timestamp}))},e.prototype.findMessagesByTimes=function(e){var t=this,n=[];return e.forEach((function(e){var o=t.findMessageByTime(e);r["default"].isDef(o)&&n.push(o)})),n},e.prototype.existsMessage=function(e){return this.findMessageIndexById(e)>-1},e.prototype.findMessageIndexById=function(e){return this.messages.findIndex((function(t){return e===t.messageId}))},e.prototype.deleteMessage=function(e){var t=this.findMessageIndexById(e);t>=0&&this.messages.splice(t,1)},e.prototype.recallMessages=function(e){var t=this;e.forEach((function(e){var n=t.findMessageByTime(e.timestamp);r["default"].isDef(n)&&(n.recalled=!0),e.recalled=!0}))},e.prototype.isEmpty=function(){return 0===this.messages.length},e.prototype.deleteMessages=function(e){var t=this;e.forEach((function(e){t.deleteMessage(e.messageId)}))},e.prototype.saveMessage=function(t){e.sortedInserter.insert(this.messages,t),this.sliceOverLengthMessages()},e.prototype.maxSuccessMessageTime=function(){for(var e=this.messages.length-1;e>=0;e--)if(this.messages[e].status===o.MessageStatus.SUCCESS)return this.messages[e].timestamp;return 0},e.prototype.minTime=function(){return this.isEmpty()?0:this.messages[0].timestamp},e.prototype.correctPosition=function(e){this.deleteMessage(e.messageId),this.saveMessage(e)},e.CACHE_MAX_LENGTH=200,e.sortedInserter=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.compare=function(e,t){var n=e.timestamp-t.timestamp;return n>0?1:0===n?0:-1},t}(i.SortedInserter)),e}();t["default"]=a}(Ps);var Fs={},Gs={},Us={__esModule:!0,Target:void 0},Ls=s,js=Fn,Bs=Fo,qs=function(){function e(e,t,n){this.scene=e,this.id=t,js["default"].isDef(n)&&(this.teamId=n)}return e.prototype.toString=function(){return Ls.Scene.PRIVATE===this.scene||Ls.Scene.GROUP===this.scene?this.scene+"#"+this.id:this.scene+"#"+this.id+"#"+this.teamId},e.prototype.customerId=function(){if(Ls.Scene.CS===this.scene)return this.id===this.teamId?Bs.G.u():this.id},e.byScene=function(t,n,o){return new e(t,n,o)},e.byIMMessage=function(t){var n,o,r=t.scene();if(r===Ls.Scene.PRIVATE){var i=t.senderId,s=t.targetId();o=Bs.G.u()===i?s:i}else if(r===Ls.Scene.GROUP)o=t.targetId();else{if(r!==Ls.Scene.CS)throw{code:400,content:"scene ".concat(r," not exists")};o=t.targetId();var a=t;n=a.teamId}return new e(r,o,n)},e.byMessageReadRemoteEvent=function(t){var n,o=t.scene,r=t.targetId,i=t.markerId,s=t.teamId;return o===Ls.Scene.PRIVATE?n=Bs.G.u()===i?r:i:o===Ls.Scene.GROUP?n=r:o===Ls.Scene.CS&&(n=r===s?i===Bs.G.u()?s:i:i===Bs.G.u()?r:s),new e(o,n,s)},e.byIMMessageDeletedEvent=function(t){var n=t.scene,o=t.deleterId;if(n===Ls.Scene.PRIVATE){var r=Bs.G.u()===o?t.targetId:o;return new e(n,r)}if(n===Ls.Scene.GROUP)return new e(n,t.targetId)},e.byConversationDTO=function(e){var t=e.lastMessage;return this.byIMMessage(t)},e.byRemoteRecallEvent=function(t){var n;if(t.scene===Ls.Scene.PRIVATE){var o=t.conversationId.split(":",2);n=o[0]===Bs.G.u()?o[1]:o[0]}else n=t.conversationId;return new e(t.scene,n)},e}();Us.Target=qs,Gs.__esModule=!0,Gs.DeleteMessageRequest=void 0;var Vs=s,Hs=Us,Ws=function(){function e(e){var t=this;this.times=new Array;var n=e[0],o=Hs.Target.byIMMessage(n);this.scene=o.scene,this.targetId=o.id,e.forEach((function(e){e.status===Vs.MessageStatus.SUCCESS&&t.times.push(e.timestamp)})),this.times.sort((function(e,t){return e<t?-1:e==t?0:1}))}return e}();Gs.DeleteMessageRequest=Ws,function(e){e.__esModule=!0;var t=s,n=Gs,o=Un,r=l,i=yo,a=Mo,c=Fo,u=function(){function e(){}return e.deleteServerMessages=function(e){var t=new n.DeleteMessageRequest(e);return t.times.length<0?Promise.resolve():new Promise((function(e,n){var s=new o["default"]({name:a.RocketTypes.IM_DELETE_MESSAGE,params:t,permission:r.Permission.WRITE,singleTimeout:i.SocketTimeout.commonQuerySingle,totalTimeout:i.SocketTimeout.commonQueryTotal,success:function(t){200===t.code?e(t):n(t)},fail:function(e){n(e)}});c.G.s().emit(s)}))},e.validate=function(e){for(var n=e.messages,o=0;o<n.length;o++){var r=n[o];if(r.status===t.MessageStatus.SENDING)throw{code:400,content:"message["+o+"] is '"+r.status+"' and cannot be deleted"}}},e}();e["default"]=u}(Fs);var zs={},Js={__esModule:!0,RecallMessageRequest:void 0},Xs=Us,Ys=function(){function e(e){var t=this;this.times=new Array;var n=e[0],o=Xs.Target.byIMMessage(n);this.scene=o.scene,this.targetId=o.id,e.forEach((function(e){t.times.push(e.timestamp)})),this.times.sort((function(e,t){return e<t?-1:e==t?0:1}))}return e}();Js.RecallMessageRequest=Ys,function(e){e.__esModule=!0;var t=s,n=Js,o=Un,r=l,i=yo,a=Mo,c=Fo,u=function(){function e(){}return e.recallServerMessages=function(e){var t=new n.RecallMessageRequest(e);return 0===t.times.length?Promise.resolve():new Promise((function(e,n){var s=new o["default"]({name:a.RocketTypes.IM_RECALL_MESSAGE,params:t,permission:r.Permission.WRITE,singleTimeout:i.SocketTimeout.commonRequestSingle,totalTimeout:i.SocketTimeout.commonRequestTotal,fail:function(e){n(e)},success:function(t){200===t.code?e(t):n(t)}});c.G.s().emit(s)}))},e.validate=function(e){for(var n=e.messages,o=0;o<n.length;o++){var r=n[o];if(r.status!==t.MessageStatus.SUCCESS)throw{code:400,content:"message["+o+"] is '"+r.status+"' and cannot be recalled"};if(r.recalled)throw{code:400,content:"message["+o+"] has been recalled"};if(r.senderId!==c.G.u())throw{code:400,content:"it is not allowed to recall messages sent by others"}}},e}();e["default"]=u}(zs);var Qs={},Ks={};(function(e){e.__esModule=!0;var t=function(){function e(e,t,n,o,r){this.scene=e,this.id=t,this.after=n,this.min=o,this.teamId=r}return e}();e["default"]=t})(Ks);var $s={__esModule:!0,ReadMessageMarkRequest:void 0},Zs=function(){function e(e,t,n,o){this.id=e,this.scene=t,this.lastTimestamp=n,this.teamId=o}return e}();$s.ReadMessageMarkRequest=Zs;var ea={},ta={},na=e&&e.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();ta.__esModule=!0,ta.PrivateMessage=void 0;var oa=Ms,ra=s,ia=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.read=!1,t}return na(t,e),t.prototype.scene=function(){return ra.Scene.PRIVATE},t.prototype.targetId=function(){return this.receiverId},t}(oa.AbstractMessage);ta.PrivateMessage=ia;var sa={},aa=e&&e.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();sa.__esModule=!0,sa.GroupMessage=void 0;var ca=Ms,ua=s,la=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return aa(t,e),t.prototype.scene=function(){return ua.Scene.GROUP},t.prototype.targetId=function(){return this.groupId},t}(ca.AbstractMessage);sa.GroupMessage=la;var pa={},fa=e&&e.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();pa.__esModule=!0,pa.CSMessage=void 0;var da=Ms,ha=s,ya=Fo,ma=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.accepted=!1,t}return fa(t,e),t.prototype.scene=function(){return ha.Scene.CS},t.prototype.targetId=function(){return ya.G.u()===this.customerId()?this.teamId:this.customerId()},t.prototype.sendByCustomer=function(){return this.to===this.teamId},t.prototype.customerId=function(){return this.sendByCustomer()?this.senderId:this.to},t.prototype.isOtherSent=function(){return ya.G.u()===this.customerId()?this.senderId!==ya.G.u():this.senderId===this.customerId()},t}(da.AbstractMessage);pa.CSMessage=ma;var va={};(function(e){e.__esModule=!0,e.CSMessageType=void 0,function(e){e["ACCEPT"]="CS_ACCEPT",e["END"]="CS_END",e["TRANSFER"]="CS_TRANSFER"}(e.CSMessageType||(e.CSMessageType={}))})(va),ea.__esModule=!0,ea.RemoteAbbrMessageBuilder=void 0;var ga=s,ba=ta,Sa=sa,Ea=pa,_a=Fn,Ca=Fo,wa=va,Ma=function(){function e(){}return e.prototype.build=function(e){var t,n=e.t;n===ga.Scene.PRIVATE?(t=new ba.PrivateMessage,t.read=!1,t.receiverId=e.r):n===ga.Scene.GROUP?(t=new Sa.GroupMessage,t.groupId=e.r,t.senderData=e.d?JSON.parse(e.d):{}):n===ga.Scene.CS&&(t=new Ea.CSMessage,t.to=e.r,t.teamId=e.tid,t.senderData=e.d?JSON.parse(e.d):{},t.accepted=e.accepted,t.customerId()!==Ca.G.u()&&(t.sessionId=e.sessionId)),t.senderId=e.s,t.messageId=e.i,t.timestamp=e.ts,t.type=e.mt;var o=e.p;if(_a["default"].isDef(o))if(n===ga.Scene.CS&&t.type===wa.CSMessageType.TRANSFER){var r=JSON.parse(o);r.transferTo.data=JSON.parse(r.transferTo.data),t.payload=r}else t.payload=JSON.parse(o);return t.recalled=e.rc,t.status=ga.MessageStatus.SUCCESS,t},e}();ea.RemoteAbbrMessageBuilder=Ma;var Ta=e&&e.__awaiter||function(e,t,n,o){function r(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function s(e){try{c(o.next(e))}catch(Kf){i(Kf)}}function a(e){try{c(o["throw"](e))}catch(Kf){i(Kf)}}function c(e){e.done?n(e.value):r(e.value).then(s,a)}c((o=o.apply(e,t||[])).next())}))},Ia=e&&e.__generator||function(e,t){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");while(s)try{if(n=1,o&&(r=2&i[0]?o["return"]:i[0]?o["throw"]||((r=o["return"])&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(r=s.trys,!(r=r.length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(Kf){i=[6,Kf],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Qs.__esModule=!0,Qs.RemoteHistory=void 0;var Aa=s,Oa=Ks,Na=Un,ka=Mo,Ra=l,Pa=yo,xa=Fo,Da=$s,Fa=ea,Ga=function(){function e(){this.builder=new Fa.RemoteAbbrMessageBuilder}return e.prototype.sync=function(e,t,n,o,r){var i=new Oa["default"](e,t,n,o,r);return new Promise((function(e,t){var n=new Na["default"]({name:ka.RocketTypes.IM_HISTORY_CHANGE,params:i,permission:Ra.Permission.READ,singleTimeout:Pa.SocketTimeout.commonQuerySingle,totalTimeout:Pa.SocketTimeout.commonQueryTotal,fail:function(e){t(e)},success:function(t){var n=t.content;e(n)}});xa.G.s().emit(n)}))},e.prototype.loadServerMessages=function(e,t){var n=this;return new Promise((function(o,r){var i=new Na["default"]({name:ka.RocketTypes.IM_HISTORY,params:t,permission:Ra.Permission.READ,singleTimeout:Pa.SocketTimeout.commonQuerySingle,totalTimeout:Pa.SocketTimeout.commonQueryTotal,fail:function(e){r(e)},success:function(t){var r=t.content;r.messages=n.convertServerMessages(e,r.messages),o(r)}});xa.G.s().emit(i)}))},e.prototype.convertServerMessages=function(e,t){var n=this,o=[],r=e.scene,i=e.id;return t.forEach((function(t){if(t.t=r,Aa.Scene.PRIVATE===r)t.r=t.s===xa.G.u()?i:xa.G.u();else if(Aa.Scene.GROUP===r)t.r=i;else if(Aa.Scene.CS===r){var s=e.customerId(),a=e.teamId;s===xa.G.u()?t.r=a:t.r=s}var c=n.builder.build(t);o.push(c)})),o},e.prototype.updateServerOffsets=function(e,t){return Ta(this,void 0,void 0,(function(){var n;return Ia(this,(function(o){return n=new Da.ReadMessageMarkRequest(t.id,t.scene,e,t.teamId),[2,new Promise((function(e,t){var o=new Na["default"]({name:ka.RocketTypes.IM_MARK_AS_READ,params:n,permission:Ra.Permission.WRITE,singleTimeout:Pa.SocketTimeout.commonRequestSingle,totalTimeout:Pa.SocketTimeout.commonRequestTotal,success:function(t){e(t)},fail:function(e){t(e)}});xa.G.s().emit(o)}))]}))}))},e.instance=new e,e}();Qs.RemoteHistory=Ga;var Ua={__esModule:!0,UserOffsets:void 0},La=Fn,ja=Fo,Ba=function(){function e(){this.offsetMap=new Map,this.markingTime=0,this.userId=ja.G.u()}return e.prototype.updateOffset=function(e,t){var n=this.offsetMap.get(e);return La["default"].isDef(n)?t>n&&(this.offsetMap.set(e,t),!0):(this.offsetMap.set(e,t),!0)},e.prototype.updateUserOffsets=function(e){var t=this;e.forEach((function(e){var n=e.userId,o=e.offset;t.updateOffset(n,o)}))},e.prototype.updateMyOffset=function(e){return this.updateOffset(this.userId,e)},e.prototype.myOffset=function(){return this.getOffset(this.userId)},e.prototype.getOffset=function(e){var t=this.offsetMap.get(e);return t||0},e}();Ua.UserOffsets=Ba;var qa={};(function(e){e.__esModule=!0;var t=function(){function e(e,t,n,o,r){this.id=e,this.scene=t,this.lastTimestamp=n,this.limit=o,this.teamId=r}return e}();e["default"]=t})(qa);var Va={__esModule:!0,UnreadAmountMaxMessageChangeDetector:void 0},Ha=gs,Wa=ws,za=function(){function e(e){this.history=e}return e.prototype.pre=function(){this.oldLastMessage=this.history.getMaxMessage(),this.oldUnreadAmount=this.history.unreadAmount(),this.oldLastMessage&&(this.oldLastMessageRecalled=this.oldLastMessage.recalled,this.oldLastMessageRead=this.oldLastMessage.read,this.oldLastMessageStatus=this.oldLastMessage.status)},e.prototype.post=function(){var e,t,n,o=this.history.unreadAmount(),r=this.history.getMaxMessage();r&&(n=r.status,e=r.read,t=r.recalled),this.oldLastMessage!==r||this.oldLastMessageRead!==e||this.oldLastMessageRecalled!==t||this.oldLastMessageStatus!==n?Ha.GoEasyEventCenter.fire(Wa.IM_INTERNAL_EVENTS.MAX_MESSAGE_CHANGED,r):this.oldUnreadAmount!==o&&Ha.GoEasyEventCenter.fire(Wa.IM_INTERNAL_EVENTS.UNREAD_AMOUNT_CHANGED,this.history.target)},e}();Va.UnreadAmountMaxMessageChangeDetector=za,function(t){var n=e&&e.__awaiter||function(e,t,n,o){function r(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function s(e){try{c(o.next(e))}catch(Kf){i(Kf)}}function a(e){try{c(o["throw"](e))}catch(Kf){i(Kf)}}function c(e){e.done?n(e.value):r(e.value).then(s,a)}c((o=o.apply(e,t||[])).next())}))},o=e&&e.__generator||function(e,t){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");while(s)try{if(n=1,o&&(r=2&i[0]?o["return"]:i[0]?o["throw"]||((r=o["return"])&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(r=s.trys,!(r=r.length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(Kf){i=[6,Kf],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},r=e&&e.__values||function(e){var t="function"===typeof Symbol&&Symbol.iterator,n=t&&e[t],o=0;if(n)return n.call(e);if(e&&"number"===typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};t.__esModule=!0;var i=s,a=xr,c=Yr,u=Ps,l=Fs,p=zs,f=Jr,d=Fo,h=Qs,y=Ua,m=qa,v=Fn,g=Va,b=gs,S=ws,E=function(){function e(e){this.expiredTime=0,this.remoteHistory=h.RemoteHistory.instance,this.target=e,this.userOffsets=new y.UserOffsets,this.messageCache=new u["default"](e)}return e.prototype.initMaxMessageAndOffsets=function(e,t){var n=this;this.existsMessage(e)||(this.messageCache.saveMessage(e),t.forEach((function(e){n.markLocalMessagesRead(n.messageCache.all(),e.userId,e.offset,!1)})))},e.prototype.existsMessage=function(e){return this.messageCache.existsMessage(e.messageId)},e.prototype.loadHistory=function(e,t){return n(this,void 0,void 0,(function(){return o(this,(function(n){switch(n.label){case 0:return this.expiredTime>0&&!this.messageCache.isEmpty()?[4,this.updateByServerChange()]:[3,2];case 1:n.sent(),n.label=2;case 2:return v["default"].isUndef(t)?t=10:t>30&&(t=30),[4,this.loadServerMessages(e,t)];case 3:return[2,n.sent()]}}))}))},e.prototype.loadServerMessages=function(e,t){return n(this,void 0,void 0,(function(){var n,r,i,s,a,c,u=this;return o(this,(function(o){switch(o.label){case 0:return n=this.messageCache.loadLocalMessages(t,e),!1!==this.messageCache.allLoaded||n.length===t?[3,2]:(r=t-n.length,i=n[0]?n[0].timestamp:e,s=new m["default"](this.target.id.toString(),this.target.scene,i,r,this.target.teamId),[4,this.remoteHistory.loadServerMessages(this.target,s)]);case 1:a=o.sent(),c=a.messages,n=c.concat(n),this.messageCache.cacheServerMessages(s,c),a.userOffsets.forEach((function(e){u.userOffsets.updateOffset(e.userId,e.offset)})),this.userOffsets.offsetMap.forEach((function(e,t){u.markLocalMessagesRead(c,t,e,!1)})),o.label=2;case 2:return[2,n]}}))}))},e.prototype.deleteMessages=function(e){return n(this,void 0,void 0,(function(){var t=this;return o(this,(function(r){switch(r.label){case 0:return[4,this.aopUnreadAmountMaxMessage((function(){return n(t,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:return t=e.messages,[4,l["default"].deleteServerMessages(t)];case 1:return n.sent(),this.messageCache.deleteMessages(t),a.CallbackUtils.onSuccess(e),[2]}}))}))}))];case 1:return r.sent(),[2]}}))}))},e.prototype.syncDeletedMessage=function(e,t){var n=this;this.aopUnreadAmountMaxMessage((function(){n.doSyncDeletedMessage(e,t)}))},e.prototype.doSyncDeletedMessage=function(e,t){if(e===d.G.u()){var n=this.messageCache.findMessagesByTimes(t);this.messageCache.deleteMessages(n),n.length>0&&f.IM.aec.fire(c.ImApiEvents.MESSAGE_DELETED,n)}},e.prototype.recallMessage=function(e){return n(this,void 0,void 0,(function(){var t=this;return o(this,(function(r){switch(r.label){case 0:return[4,this.aopUnreadAmountMaxMessage((function(){return n(t,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:return t=e.messages,[4,p["default"].recallServerMessages(t)];case 1:return n.sent(),this.messageCache.recallMessages(t),a.CallbackUtils.onSuccess(e),[2]}}))}))}))];case 1:return r.sent(),[2]}}))}))},e.prototype.syncRecalledMessage=function(e){var t=this;this.aopUnreadAmountMaxMessage((function(){return n(t,void 0,void 0,(function(){return o(this,(function(t){return this.doSyncRecalledMessage(e),[2]}))}))}))},e.prototype.doSyncRecalledMessage=function(e){var t=this.messageCache.findMessagesByTimes(e);t.length>0&&(this.messageCache.recallMessages(t),f.IM.aec.fire(c.ImApiEvents.MESSAGE_RECALLED,t))},e.prototype.expire=function(){this.messageCache.isEmpty()||(this.expiredTime=this.messageCache.maxSuccessMessageTime())},e.prototype.updateByServerChange=function(){return n(this,void 0,void 0,(function(){var e=this;return o(this,(function(t){switch(t.label){case 0:return[4,this.aopUnreadAmountMaxMessage((function(){return n(e,void 0,void 0,(function(){var e,t,n,r=this;return o(this,(function(o){switch(o.label){case 0:return[4,this.remoteHistory.sync(this.target.scene,this.target.id,this.expiredTime,this.messageCache.minTime(),this.target.teamId)];case 1:return e=o.sent(),e.userOffsets.forEach((function(e){r.markLocalMessagesRead(r.messageCache.all(),e.userId,e.offset,!0)})),t=e.deletedMessageTimes,t.length>0&&this.doSyncDeletedMessage(d.G.u(),t),n=e.recalled,n.length>0&&this.doSyncRecalledMessage(n),this.expiredTime=0,[2]}}))}))}))];case 1:return t.sent(),[2]}}))}))},e.prototype.markRead=function(){return n(this,void 0,void 0,(function(){var e=this;return o(this,(function(t){switch(t.label){case 0:return[4,this.aopUnreadAmountMaxMessage((function(){return n(e,void 0,void 0,(function(){var e,t;return o(this,(function(n){switch(n.label){case 0:return e=this.messageCache.maxSuccessMessageTime(),t=this.userOffsets.myOffset(),e>t?(this.userOffsets.markingTime=e,[4,this.remoteHistory.updateServerOffsets(e,this.target)]):[3,2];case 1:n.sent(),e===this.userOffsets.markingTime&&this.markLocalMessagesRead(this.messageCache.all(),d.G.u(),e,!0),n.label=2;case 2:return[2]}}))}))}))];case 1:return t.sent(),[2]}}))}))},e.prototype.syncMarkedMessage=function(e){var t=this;this.aopUnreadAmountMaxMessage((function(){t.markLocalMessagesRead(t.messageCache.all(),e.markerId,e.time,!0)}))},e.prototype.onMessageSending=function(e){var t=this;this.aopUnreadAmountMaxMessage((function(){t.messageCache.saveMessage(e)}))},e.prototype.onMessageSendSuccess=function(e){var t=this;this.aopUnreadAmountMaxMessage((function(){t.messageCache.correctPosition(e),t.markLocalMessagesRead(t.messageCache.all(),d.G.u(),e.timestamp,!0)}))},e.prototype.onMessageSendFailed=function(e){var t=this.getMaxMessage();t===e&&b.GoEasyEventCenter.fire(S.IM_INTERNAL_EVENTS.MAX_MESSAGE_CHANGED,e)},e.prototype.onMessageReceived=function(e){var t=this;this.aopUnreadAmountMaxMessage((function(){t.messageCache.saveMessage(e),t.markLocalMessagesRead(t.messageCache.all(),e.senderId,e.timestamp,!0)}))},e.prototype.aopUnreadAmountMaxMessage=function(e,t){return n(this,void 0,void 0,(function(){var n,r;return o(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),n=new g.UnreadAmountMaxMessageChangeDetector(this),n.pre(),[4,e()];case 1:return o.sent(),n.post(),[3,3];case 2:return r=o.sent(),a.CallbackUtils.onFailed(t,r),[3,3];case 3:return[2]}}))}))},e.prototype.markLocalMessagesRead=function(e,t,n,o){if(this.userOffsets.updateOffset(t,n),this.isOtherUserId(t)){var r=this.markMySentRead(e,n);o&&r.length>0&&f.IM.aec.fire(c.ImApiEvents.MESSAGE_READ,r)}else t===d.G.u()&&this.markOthersSentRead(e,n)},e.prototype.markOthersSentRead=function(e,t){if(this.target.scene===i.Scene.PRIVATE)for(var n=e.length-1;n>=0;n--){var o=e[n];if(o.isOtherSent()&&o.timestamp<=t){if(o.read)break;o.read=!0}}},e.prototype.markMySentRead=function(e,t){var n=new Array;if(this.target.scene===i.Scene.PRIVATE)for(var o=e.length-1;o>=0;o--){var r=e[o];if(!r.isOtherSent()&&r.timestamp<=t&&r.status===i.MessageStatus.SUCCESS){if(r.read)break;r.read=!0,n.push(r)}}return n},e.prototype.isOtherUserId=function(e){if(this.target.scene===i.Scene.CS){var t=this.target.customerId();return d.G.u()===t?e!==d.G.u():e===t}return e!==d.G.u()},e.prototype.unreadAmount=function(e){var t,n,o=0,i=this.userOffsets.myOffset(),s=this.messageCache.all();try{for(var a=r(s),c=a.next();!c.done;c=a.next()){var u=c.value;u.isOtherSent()&&!1===u.recalled&&u.timestamp>i&&(o+=1)}}catch(l){t={error:l}}finally{try{c&&!c.done&&(n=a["return"])&&n.call(a)}finally{if(t)throw t.error}}return o},e.prototype.getMaxMessage=function(e){return this.messageCache.getMaxMessage()},e.prototype.maxTime=function(e){var t=this.getMaxMessage();return v["default"].isDef(t)?t.timestamp:0},e}();t["default"]=E}(Rs);var Ja={},Xa={},Ya={__esModule:!0,LiveSessionRequest:void 0},Qa=function(){function e(e,t){this.teamId=e,this.customerId=t}return e}();Ya.LiveSessionRequest=Qa;var Ka={__esModule:!0,CustomerStatus:void 0},$a=function(){function e(){}return e}();Ka.CustomerStatus=$a;var Za={},ec={__esModule:!0,CSOnlineRequest:void 0},tc=function(){function e(e,t,n){this.teamId=e,this.teamData=JSON.stringify(t),this.agentData=JSON.stringify(n)}return e}();ec.CSOnlineRequest=tc;var nc={__esModule:!0,CSOfflineRequest:void 0},oc=function(){function e(e){this.teamId=e}return e}();nc.CSOfflineRequest=oc;var rc={__esModule:!0,CsAgentsQueryRequest:void 0},ic=function(){function e(e){this.teamId=e}return e}();rc.CsAgentsQueryRequest=ic;var sc=e&&e.__awaiter||function(e,t,n,o){function r(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function s(e){try{c(o.next(e))}catch(Kf){i(Kf)}}function a(e){try{c(o["throw"](e))}catch(Kf){i(Kf)}}function c(e){e.done?n(e.value):r(e.value).then(s,a)}c((o=o.apply(e,t||[])).next())}))},ac=e&&e.__generator||function(e,t){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");while(s)try{if(n=1,o&&(r=2&i[0]?o["return"]:i[0]?o["throw"]||((r=o["return"])&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(r=s.trys,!(r=r.length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(Kf){i=[6,Kf],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Za.__esModule=!0,Za.AgentStatus=void 0;var cc=Un,uc=Mo,lc=l,pc=yo,fc=Fn,dc=ec,hc=nc,yc=gs,mc=ws,vc=xr,gc=Fo,bc=rc,Sc=Bo,Ec=function(){function e(){this["synchronized"]=!0,gc.G.s().addDisconnectedObserver(this.onDisconnected.bind(this)),gc.G.s().addConnectedObserver(this.onConnected.bind(this)),gc.G.s().addMessageObserver(Sc.RemoteEvents.CS_ONLINE_CHANGED,this.onlineChanged.bind(this))}return e.getInstance=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.queryTeams=function(){var e=this;return this.queryMyTeamPromise||(this.queryMyTeamPromise=new Promise((function(t,n){console.log("start query team.");var o=new cc["default"]({name:uc.RocketTypes.CS_MY_TEAMS,params:{},permission:lc.Permission.READ,singleTimeout:pc.SocketTimeout.commonQuerySingle,totalTimeout:pc.SocketTimeout.commonQueryTotal,fail:function(e){n(e)},success:function(n){e.teamIds=new Set(n.content),e["synchronized"]=!0,t(e.teamIds)}});gc.G.s().emit(o)}))),this.queryMyTeamPromise},e.prototype.myTeams=function(){if(this["synchronized"]&&this.queryMyTeamPromise)return this.teamIds;throw"please query team first."},e.prototype.isOnline=function(e,t){return sc(this,void 0,void 0,(function(){return ac(this,(function(n){switch(n.label){case 0:return[4,this.queryTeams()];case 1:return n.sent(),vc.CallbackUtils.onSuccess(t,this.teamIds.has(e)),[2]}}))}))},e.prototype.online=function(e,t){var n=this;if(!fc["default"].isObject(t.agentData)||!fc["default"].isObject(t.teamData))throw{code:400,content:"agentData and teamData require an object"};var o=new dc.CSOnlineRequest(e,t.teamData,t.agentData),r=new cc["default"]({name:uc.RocketTypes.CS_ONLINE,params:o,permission:lc.Permission.WRITE,singleTimeout:pc.SocketTimeout.commonRequestSingle,totalTimeout:pc.SocketTimeout.commonRequestTotal,fail:function(e){vc.CallbackUtils.onFailed(t,e)},success:function(o){n.teamIds.add(e),vc.CallbackUtils.onSuccess(t),yc.GoEasyEventCenter.fire(mc.IM_INTERNAL_EVENTS.CS_ONLINE_SUCCESS)}});gc.G.s().emit(r)},e.prototype.offline=function(e,t){var n=this,o=new hc.CSOfflineRequest(e),r=new cc["default"]({name:uc.RocketTypes.CS_OFFLINE,params:o,permission:lc.Permission.WRITE,singleTimeout:pc.SocketTimeout.commonRequestSingle,totalTimeout:pc.SocketTimeout.commonRequestTotal,fail:function(e){vc.CallbackUtils.onFailed(t,e)},success:function(o){n.teamIds["delete"](e),vc.CallbackUtils.onSuccess(t),yc.GoEasyEventCenter.fire(mc.IM_INTERNAL_EVENTS.CS_OFFLINE_SUCCESS)}});gc.G.s().emit(r)},e.prototype.agents=function(e,t){var n=new bc.CsAgentsQueryRequest(e),o=new cc["default"]({name:uc.RocketTypes.CS_AGENTS,params:n,permission:lc.Permission.READ,singleTimeout:pc.SocketTimeout.commonQuerySingle,totalTimeout:pc.SocketTimeout.commonQueryTotal,fail:function(e){vc.CallbackUtils.onFailed(t,e)},success:function(e){e.content.forEach((function(e){e.data=JSON.parse(e.data)})),vc.CallbackUtils.onSuccess(t,e)}});gc.G.s().emit(o)},e.prototype.onlineChanged=function(e){e.online?this.teamIds.add(e.teamId):this.teamIds["delete"](e.teamId)},e.prototype.onDisconnected=function(){this.queryMyTeamPromise=null,this.teamIds=null},e.prototype.onConnected=function(){this["synchronized"]&&(this.queryMyTeamPromise=this.queryTeams())},e}();Za.AgentStatus=Ec;var _c=e&&e.__awaiter||function(e,t,n,o){function r(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function s(e){try{c(o.next(e))}catch(Kf){i(Kf)}}function a(e){try{c(o["throw"](e))}catch(Kf){i(Kf)}}function c(e){e.done?n(e.value):r(e.value).then(s,a)}c((o=o.apply(e,t||[])).next())}))},Cc=e&&e.__generator||function(e,t){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");while(s)try{if(n=1,o&&(r=2&i[0]?o["return"]:i[0]?o["throw"]||((r=o["return"])&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(r=s.trys,!(r=r.length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(Kf){i=[6,Kf],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Xa.__esModule=!0,Xa.LiveSession=void 0;var wc=s,Mc=Ya,Tc=Do,Ic=Un,Ac=Mo,Oc=l,Nc=yo,kc=xr,Rc=Fo,Pc=gs,xc=ws,Dc=Ka,Fc=va,Gc=Za,Uc=function(){function e(e){this.teamId=e,Pc.GoEasyEventCenter.on(xc.IM_INTERNAL_EVENTS.CS_AGENT_MESSAGE_RECEIVED,this.onMessageReceived),Pc.GoEasyEventCenter.on(xc.IM_INTERNAL_EVENTS.CS_ACCEPTED,this.onMessageReceived),Pc.GoEasyEventCenter.on(xc.IM_INTERNAL_EVENTS.CS_ENDED,this.onMessageReceived),Pc.GoEasyEventCenter.on(xc.IM_INTERNAL_EVENTS.CS_TRANSFER,this.onMessageReceived)}return e.live=function(t,n){return _c(this,void 0,void 0,(function(){var o,r,i,s=this;return Cc(this,(function(a){switch(a.label){case 0:return o=n.customerId,Tc["default"].validateId(o,"customerId"),r=new Mc.LiveSessionRequest(t,o),[4,Gc.AgentStatus.getInstance().queryTeams()];case 1:return a.sent(),i=new Ic["default"]({name:Ac.RocketTypes.CS_LIVE_SESSION,params:r,permission:Oc.Permission.WRITE,singleTimeout:Nc.SocketTimeout.commonRequestSingle,totalTimeout:Nc.SocketTimeout.commonRequestTotal,fail:function(e){kc.CallbackUtils.onFailed(n,e)},success:function(o){e.destroy(),s.session=new e(t),s.session.liveOptions=n;var r=o.content.customerStatus;"ACCEPTED"===r.status&&(r.agent.data=JSON.parse(r.agent.data)),s.session.status=r,s.session.liveOptions.onStatusUpdated(s.session.status),kc.CallbackUtils.onSuccess(n)}}),Rc.G.s().emit(i),[2]}}))}))},e.prototype.customerId=function(){return this.liveOptions.customerId},e.isMyCustomer=function(t){var n=e.session;if(n&&n.teamId===t.teamId&&n.customerId()===t.customerId()){var o=Gc.AgentStatus.getInstance().myTeams(),r=n.status.agent;return o.has(t.teamId)&&(!r||r.id===Rc.G.u())}return!0},e.quit=function(t){var n=e.session;if(n){var o=n.liveOptions.customerId;Tc["default"].validateId(o,"customerId");var r=new Mc.LiveSessionRequest(n.teamId,o),i=new Ic["default"]({name:Ac.RocketTypes.CS_QUIT_LIVE,params:r,permission:Oc.Permission.WRITE,singleTimeout:Nc.SocketTimeout.commonRequestSingle,totalTimeout:Nc.SocketTimeout.commonRequestTotal,fail:function(e){kc.CallbackUtils.onFailed(t,e)},success:function(n){e.destroy(),kc.CallbackUtils.onSuccess(t)}});Rc.G.s().emit(i)}},e.destroy=function(){var t=e.session;t&&(Pc.GoEasyEventCenter.off(xc.IM_INTERNAL_EVENTS.CS_AGENT_MESSAGE_RECEIVED,t.onMessageReceived),Pc.GoEasyEventCenter.off(xc.IM_INTERNAL_EVENTS.CS_ACCEPTED,t.onMessageReceived),Pc.GoEasyEventCenter.off(xc.IM_INTERNAL_EVENTS.CS_ENDED,t.onMessageReceived),Pc.GoEasyEventCenter.off(xc.IM_INTERNAL_EVENTS.CS_TRANSFER,t.onMessageReceived),e.session=null)},e.prototype.onMessageReceived=function(t){var n=e.session;if(t.scene()===wc.Scene.CS&&n.liveOptions){var o=t,r=n.liveOptions.customerId;n.teamId===o.teamId&&o.customerId()===r&&(n.tryUpdateStatus(o),n.liveOptions.onNewMessage(o))}},e.prototype.tryUpdateStatus=function(e){if(!("FREE"!==this.status.status&&this.status.sessionId>e.sessionId)){var t;switch(e.type){case Fc.CSMessageType.ACCEPT:t=new Dc.CustomerStatus,t.status="ACCEPTED",t.start=e.payload.sessionStart,t.sessionId=e.sessionId,t.agent=new wc.User(e.senderId,e.senderData);break;case Fc.CSMessageType.END:t=new Dc.CustomerStatus,t.status="FREE";break;case Fc.CSMessageType.TRANSFER:t=new Dc.CustomerStatus,t.status="ACCEPTED",t.start=e.payload.sessionStart,t.sessionId=e.sessionId,t.agent=e.payload.transferTo;break;default:"FREE"===this.status.status&&(t=new Dc.CustomerStatus,t.status="PENDING",t.start=e.timestamp,t.sessionId=e.sessionId);break}t&&(this.status=t,this.liveOptions.onStatusUpdated(t))}},e}();Xa.LiveSession=Uc,function(t){var n=e&&e.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),o=e&&e.__awaiter||function(e,t,n,o){function r(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function s(e){try{c(o.next(e))}catch(Kf){i(Kf)}}function a(e){try{c(o["throw"](e))}catch(Kf){i(Kf)}}function c(e){e.done?n(e.value):r(e.value).then(s,a)}c((o=o.apply(e,t||[])).next())}))},r=e&&e.__generator||function(e,t){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");while(s)try{if(n=1,o&&(r=2&i[0]?o["return"]:i[0]?o["throw"]||((r=o["return"])&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(r=s.trys,!(r=r.length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(Kf){i=[6,Kf],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};t.__esModule=!0;var i=qa,s=Rs,a=xr,c=Fn,u=gs,l=ws,p=Fo,f=va,d=Xa,h=function(e){function t(t){var n=e.call(this,t)||this;return n.unread=0,n.markingAmount=0,n}return n(t,e),t.prototype.loadHistory=function(e,t){return o(this,void 0,void 0,(function(){return r(this,(function(n){switch(n.label){case 0:return c["default"].isUndef(t)?t=10:t>30&&(t=30),[4,this.loadServerMessages(e,t)];case 1:return[2,n.sent()]}}))}))},t.prototype.loadServerMessages=function(e,t){return o(this,void 0,void 0,(function(){var n,o,s=this;return r(this,(function(r){switch(r.label){case 0:return n=new i["default"](this.target.id.toString(),this.target.scene,e,t,this.target.teamId),[4,this.remoteHistory.loadServerMessages(this.target,n)];case 1:return o=r.sent(),o.userOffsets.forEach((function(e){s.userOffsets.updateOffset(e.userId,e.offset)})),[2,o.messages]}}))}))},t.prototype.deleteMessages=function(e){return o(this,void 0,void 0,(function(){return r(this,(function(t){return a.CallbackUtils.onFailed(e,"Delete CS message is not supported yet"),[2]}))}))},t.prototype.recallMessage=function(e){return o(this,void 0,void 0,(function(){return r(this,(function(t){return a.CallbackUtils.onFailed(e,"Recall CS message is not supported yet"),[2]}))}))},t.prototype.initMaxMessageAndOffsets=function(e,t){var n=this;t.forEach((function(e){n.userOffsets.updateOffset(e.userId,e.offset)})),(c["default"].isUndef(this.acceptedMaxMessage)||this.acceptedMaxMessage.timestamp<e.timestamp)&&this.increaseUnreadAmount(e),this.saveAcceptedMessage(e)},t.prototype.initPendingMaxMessageAndOffsets=function(e,t){var n=this;t.forEach((function(e){n.userOffsets.updateOffset(e.userId,e.offset)})),this.savePendingMessage(e)},t.prototype.savePendingMessage=function(e){this.pendingMaxMessage?this.pendingMaxMessage.timestamp<e.timestamp&&(this.pendingMaxMessage=e):this.pendingMaxMessage=e},t.prototype.saveAcceptedMessage=function(e){this.acceptedMaxMessage?this.acceptedMaxMessage.timestamp<e.timestamp&&(this.acceptedMaxMessage=e):this.acceptedMaxMessage=e},t.prototype.onMessageSending=function(e){this.saveAcceptedMessage(e),u.GoEasyEventCenter.fire(l.IM_INTERNAL_EVENTS.MAX_MESSAGE_CHANGED,e)},t.prototype.onMessageSendSuccess=function(e){this.saveAcceptedMessage(e),this.userOffsets.updateOffset(e.senderId,e.timestamp),this.acceptedMaxMessage===e&&u.GoEasyEventCenter.fire(l.IM_INTERNAL_EVENTS.MAX_MESSAGE_CHANGED,e)},t.prototype.onMessageSendFailed=function(e){this.acceptedMaxMessage===e&&u.GoEasyEventCenter.fire(l.IM_INTERNAL_EVENTS.MAX_MESSAGE_CHANGED,e)},t.prototype.onMessageReceived=function(e){d.LiveSession.isMyCustomer(this.target)&&(!e.accepted||e.senderId!==p.G.u()&&e.type===f.CSMessageType.ACCEPT?this.savePendingMessage(e):this.saveAcceptedMessage(e),this.userOffsets.updateOffset(e.senderId,e.timestamp),this.increaseUnreadAmount(e),u.GoEasyEventCenter.fire(l.IM_INTERNAL_EVENTS.MAX_MESSAGE_CHANGED,e))},t.prototype.increaseUnreadAmount=function(e){if(e.sendByCustomer()||e.type===f.CSMessageType.TRANSFER&&e.senderId!==p.G.u()){var t=this.userOffsets.myOffset();t<e.timestamp&&e.accepted&&(this.unread+=1)}},t.prototype.markRead=function(){return o(this,void 0,void 0,(function(){var e;return r(this,(function(t){switch(t.label){case 0:return e=this.maxAcceptedMessageTime(),d.LiveSession.isMyCustomer(this.target)&&this.preMark(e)?[4,this.remoteHistory.updateServerOffsets(e,this.target)]:[3,2];case 1:t.sent(),this.postMark(e),t.label=2;case 2:return[2]}}))}))},t.prototype.preMark=function(e){var t=this.userOffsets.myOffset();return e>this.userOffsets.markingTime&&e>t&&(this.userOffsets.markingTime=e,this.markingAmount=this.unread,!0)},t.prototype.postMark=function(e){e===this.userOffsets.markingTime&&(this.unread-=this.markingAmount,this.markingAmount=0,this.userOffsets.updateOffset(p.G.u(),e),u.GoEasyEventCenter.fire(l.IM_INTERNAL_EVENTS.UNREAD_AMOUNT_CHANGED,this.target))},t.prototype.syncMarkedMessage=function(e){},t.prototype.getMaxMessage=function(e){return e?this.acceptedMaxMessage:this.pendingMaxMessage},t.prototype.unreadAmount=function(e){return e?this.unread:0},t.prototype.existsMessage=function(e){return this.acceptedMaxMessage&&this.acceptedMaxMessage.messageId===e.messageId||this.pendingMaxMessage&&this.pendingMaxMessage.messageId===e.messageId},t.prototype.maxAcceptedMessageTime=function(){return this.acceptedMaxMessage?this.acceptedMaxMessage.timestamp:0},t.prototype.maxTime=function(e){var t=this.getMaxMessage(e);return t?t.timestamp:0},t}(s["default"]);t["default"]=h}(Ja);var Lc={};(function(t){var n=e&&e.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),o=e&&e.__awaiter||function(e,t,n,o){function r(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function s(e){try{c(o.next(e))}catch(Kf){i(Kf)}}function a(e){try{c(o["throw"](e))}catch(Kf){i(Kf)}}function c(e){e.done?n(e.value):r(e.value).then(s,a)}c((o=o.apply(e,t||[])).next())}))},r=e&&e.__generator||function(e,t){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");while(s)try{if(n=1,o&&(r=2&i[0]?o["return"]:i[0]?o["throw"]||((r=o["return"])&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(r=s.trys,!(r=r.length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(Kf){i=[6,Kf],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};t.__esModule=!0;var i=Rs,s=xr,a=function(e){function t(t){return e.call(this,t)||this}return n(t,e),t.prototype.deleteMessages=function(e){return o(this,void 0,void 0,(function(){return r(this,(function(t){return s.CallbackUtils.onFailed(e,"Delete CS message is not supported yet"),[2]}))}))},t.prototype.recallMessage=function(e){return o(this,void 0,void 0,(function(){return r(this,(function(t){return s.CallbackUtils.onFailed(e,"Recall CS message is not supported yet"),[2]}))}))},t}(i["default"]);t["default"]=a})(Lc),function(t){var n=e&&e.__awaiter||function(e,t,n,o){function r(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function s(e){try{c(o.next(e))}catch(Kf){i(Kf)}}function a(e){try{c(o["throw"](e))}catch(Kf){i(Kf)}}function c(e){e.done?n(e.value):r(e.value).then(s,a)}c((o=o.apply(e,t||[])).next())}))},o=e&&e.__generator||function(e,t){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");while(s)try{if(n=1,o&&(r=2&i[0]?o["return"]:i[0]?o["throw"]||((r=o["return"])&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(r=s.trys,!(r=r.length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(Kf){i=[6,Kf],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};t.__esModule=!0;var r=s,i=Fn,a=Rs,c=Us,u=gs,l=ws,p=Ms,f=Fs,d=zs,h=Bo,y=Fo,m=xr,v=Ja,g=Lc,b=function(){function e(){this.map=new Map}return e.init=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.initialListeners=function(){var e=this;u.GoEasyEventCenter.on(l.IM_INTERNAL_EVENTS.MESSAGE_SENDING,(function(t){return e.onMessageSending(t)})),u.GoEasyEventCenter.on(l.IM_INTERNAL_EVENTS.MESSAGE_SEND_SUCCESS,(function(t){return e.onMessageSendSuccess(t)})),u.GoEasyEventCenter.on(l.IM_INTERNAL_EVENTS.MESSAGE_SEND_FAILED,(function(t){return e.onMessageSendFailed(t)})),u.GoEasyEventCenter.on(l.IM_INTERNAL_EVENTS.MESSAGE_RECEIVED,(function(t){return e.onMessageReceived(t)})),u.GoEasyEventCenter.on(l.IM_INTERNAL_EVENTS.CS_AGENT_MESSAGE_RECEIVED,(function(t){return e.onMessageReceived(t)})),u.GoEasyEventCenter.on(l.IM_INTERNAL_EVENTS.CS_ACCEPTED,(function(t){return e.onMessageReceived(t)})),u.GoEasyEventCenter.on(l.IM_INTERNAL_EVENTS.CS_ENDED,(function(t){return e.onMessageReceived(t)})),u.GoEasyEventCenter.on(l.IM_INTERNAL_EVENTS.CS_TRANSFER,(function(t){return e.onMessageReceived(t)})),y.G.s().addMessageObserver(h.RemoteEvents.IM_MSG_READ,this.onRemoteMarkRead.bind(this)),y.G.s().addMessageObserver(h.RemoteEvents.IM_MSG_DELETED,this.onRemoteMessageDeleted.bind(this)),y.G.s().addMessageObserver(h.RemoteEvents.IM_MSG_RECALLED,this.onRemoteMessageRecalled.bind(this)),y.G.s().addDisconnectedObserver(this.onDisconnected.bind(this))},e.prototype.loadHistory=function(e,t){return n(this,void 0,void 0,(function(){var n,r,i;return o(this,(function(o){switch(o.label){case 0:return n=this.queryToTarget(e,t),r=this.findOrCreateHistory(n),[4,r.loadHistory(e.lastTimestamp,e.limit)];case 1:return i=o.sent(),m.CallbackUtils.onSuccess(e,{code:200,content:i}),[2]}}))}))},e.prototype.queryToTarget=function(e,t){if(i["default"].isDef(e.userId))return new c.Target(r.Scene.PRIVATE,e.userId);if(i["default"].isDef(e.groupId))return new c.Target(r.Scene.GROUP,e.groupId);if(i["default"].isDef(e.type)){if(!Object.values(r.Scene).includes(e.type))throw new Error("incorrect type, must be: "+Object.values(r.Scene));if(i["default"].isUndef(e.id))throw new Error("If type is not empty, id is required.");return r.Scene.CS==e.type&&i["default"].isUndef(t)&&(t=e.id),new c.Target(e.type,e.id,t)}throw new Error("incorrect query options.")},e.prototype.onMessageSending=function(e){var t=c.Target.byIMMessage(e),n=this.findOrCreateHistory(t);n.onMessageSending(e)},e.prototype.onMessageSendSuccess=function(e){var t=c.Target.byIMMessage(e),n=this.findHistory(t);n.onMessageSendSuccess(e)},e.prototype.onMessageSendFailed=function(e){var t=c.Target.byIMMessage(e),n=this.findHistory(t);n.onMessageSendFailed(e)},e.prototype.onMessageReceived=function(e){var t=c.Target.byIMMessage(e),n=this.findOrCreateHistory(t);n.onMessageReceived(e)},e.prototype.privateMarkAsRead=function(e){return n(this,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:if(i["default"].isUndef(e.userId))throw new Error("userId could not be empty.");return t=c.Target.byScene(r.Scene.PRIVATE,e.userId),[4,this.markAsRead(t,e)];case 1:return n.sent(),[2]}}))}))},e.prototype.groupMarkAsRead=function(e){return n(this,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:if(i["default"].isUndef(e.groupId))throw new Error("groupId could not be empty.");return t=c.Target.byScene(r.Scene.GROUP,e.groupId),[4,this.markAsRead(t,e)];case 1:return n.sent(),[2]}}))}))},e.prototype.markMessageAsRead=function(e,t){return n(this,void 0,void 0,(function(){var n;return o(this,(function(o){switch(o.label){case 0:if(i["default"].isUndef(e.id))throw new Error("id could not be empty.");if(!Object.values(r.Scene).includes(e.type))throw new Error("incorrect type, must be: "+Object.values(r.Scene));return r.Scene.CS==e.type&&i["default"].isUndef(t)&&(t=e.id),n=c.Target.byScene(e.type,e.id,t),[4,this.markAsRead(n,e)];case 1:return o.sent(),[2]}}))}))},e.prototype.markAsRead=function(e,t){return n(this,void 0,void 0,(function(){var n;return o(this,(function(o){switch(o.label){case 0:return n=this.findHistory(e),n?[4,n.markRead()]:[3,2];case 1:o.sent(),o.label=2;case 2:return m.CallbackUtils.onSuccess(t),[2]}}))}))},e.prototype.onRemoteMarkRead=function(e){var t=c.Target.byMessageReadRemoteEvent(e),n=this.findHistory(t);n&&n.syncMarkedMessage(e)},e.prototype.deleteMessage=function(e){return n(this,void 0,void 0,(function(){var t,n,r;return o(this,(function(o){switch(o.label){case 0:return this.validateMessageArray(e.messages),f["default"].validate(e),t=e.messages[0],n=c.Target.byIMMessage(t),r=this.findHistory(n),r?[4,r.deleteMessages(e)]:[3,2];case 1:return o.sent(),[3,3];case 2:throw{code:400,content:"No message that could be deleted"};case 3:return[2]}}))}))},e.prototype.onRemoteMessageDeleted=function(e){var t=c.Target.byIMMessageDeletedEvent(e),n=this.findHistory(t);n&&n.syncDeletedMessage(e.deleterId,e.times)},e.prototype.recallMessage=function(e){return n(this,void 0,void 0,(function(){var t,n,r;return o(this,(function(o){switch(o.label){case 0:return this.validateMessageArray(e.messages),d["default"].validate(e),t=e.messages[0],n=c.Target.byIMMessage(t),r=this.findHistory(n),r?[4,r.recallMessage(e)]:[3,2];case 1:return o.sent(),[3,3];case 2:throw{code:400,content:"No message that could be recalled"};case 3:return[2]}}))}))},e.prototype.onRemoteMessageRecalled=function(e){var t=c.Target.byRemoteRecallEvent(e),n=this.findHistory(t);n&&n.syncRecalledMessage(e.times)},e.prototype.onDisconnected=function(){this.map.forEach((function(e,t){e.expire()}))},e.prototype.findOrCreateHistory=function(e){var t=this.findHistory(e);return t||(t=e.scene===r.Scene.CS?y.G.u()===e.customerId()?new g["default"](e):new v["default"](e):new a["default"](e),this.map.set(e.toString(),t),t)},e.get=function(t){return e.instance.findOrCreateHistory(t)},e.prototype.findHistory=function(e){return this.map.get(e.toString())},e.prototype.validateMessageArray=function(e){if(!i["default"].isArray(e)||i["default"].isEmpty(e))throw{code:400,content:"messages requires non empty array"};if(e.length>50)throw{code:400,content:"The maximum number of messages is 50"};for(var t=c.Target.byIMMessage(e[0]),n=0;n<e.length;n++){var o=e[n];if(!(o instanceof p.AbstractMessage))throw{code:400,content:"message["+n+"] is not a correct message"};if(n>0){var r=c.Target.byIMMessage(o);if(r.scene!==t.scene||r.id!==t.id)throw{code:400,content:"each message must be from the same friend or group"}}}},e}();t["default"]=b}(ks),Ns.__esModule=!0,Ns.Conversation=void 0;var jc=s,Bc=ks,qc=function(){function e(e){this.top=!1,this.data=null,this.dataLoaded=!1,this.target=e}return e.prototype.toDto=function(){var e=this.target.scene,t=this.target.id,n=new jc.ConversationDTO;return e===jc.Scene.PRIVATE?n.userId=t:e===jc.Scene.GROUP?n.groupId=t:e===jc.Scene.CS&&(n.id=this.target.teamId),n.type=e,n.lastMessage=this.getMaxMessage(),n.unread=this.getUnreadAmount(),n.top=this.top,n.data=this.data,n},e.prototype.getMaxMessage=function(){return Bc["default"].get(this.target).getMaxMessage()},e.prototype.getUnreadAmount=function(){return Bc["default"].get(this.target).unreadAmount()},e.prototype.maxMessageTime=function(){return Bc["default"].get(this.target).maxTime()},e}();Ns.Conversation=qc;var Vc={},Hc=e&&e.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();Vc.__esModule=!0,Vc.CSConversation=void 0;var Wc=Ns,zc=ks,Jc=s,Xc=function(e){function t(t){var n=e.call(this,t)||this;return n.accepted=!1,n}return Hc(t,e),t.prototype.toDto=function(){var e=new Jc.ConversationDTO,t=this.target.scene,n=this.target.id,o=this.target.teamId;return e.id=n,e.teamId=o,e.type=t,e.lastMessage=this.getMaxMessage(),e.unread=this.getUnreadAmount(),e.top=this.top,e.data=this.data,e},t.prototype.getMaxMessage=function(){return zc["default"].get(this.target).getMaxMessage(this.accepted)},t.prototype.getUnreadAmount=function(){return zc["default"].get(this.target).unreadAmount(this.accepted)},t.prototype.maxMessageTime=function(){return zc["default"].get(this.target).maxTime(this.accepted)},t}(Wc.Conversation);Vc.CSConversation=Xc;var Yc={},Qc={};(function(e){e.__esModule=!0;var t=function(){function e(e,t,n,o){this.type=e,this.top=t,this.targetId=n,this.teamId=o}return e}();e["default"]=t})(Qc);var Kc={};(function(e){e.__esModule=!0;var t=function(){function e(e,t,n){this.type=e,this.targetId=t,this.teamId=n}return e}();e["default"]=t})(Kc);var $c={};(function(e){e.__esModule=!0;var t=function(){function e(e,t,n){this.type=e,this.targetId=t,this.teamId=n}return e}();e["default"]=t})($c),function(t){var n=e&&e.__awaiter||function(e,t,n,o){function r(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function s(e){try{c(o.next(e))}catch(Kf){i(Kf)}}function a(e){try{c(o["throw"](e))}catch(Kf){i(Kf)}}function c(e){e.done?n(e.value):r(e.value).then(s,a)}c((o=o.apply(e,t||[])).next())}))},o=e&&e.__generator||function(e,t){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");while(s)try{if(n=1,o&&(r=2&i[0]?o["return"]:i[0]?o["throw"]||((r=o["return"])&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(r=s.trys,!(r=r.length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(Kf){i=[6,Kf],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};t.__esModule=!0;var r=Qc,i=Un,s=Mo,a=l,c=yo,u=Kc,p=Fo,f=$c,d=function(){function e(){}return e.prototype.top=function(e,t){var n=new r["default"](e.scene,t,e.id,e.teamId);return new Promise((function(e,t){var o=new i["default"]({name:s.RocketTypes.topConversation,params:n,permission:a.Permission.WRITE,singleTimeout:c.SocketTimeout.commonRequestSingle,totalTimeout:c.SocketTimeout.commonRequestTotal,success:function(n){200===n.code?e(n):t(n)},fail:function(e){t(e)}});p.G.s().emit(o)}))},e.prototype.remove=function(e){var t=new u["default"](e.scene,e.id,e.teamId);return new Promise((function(e,n){var o=new i["default"]({name:s.RocketTypes.removeConversation,params:t,permission:a.Permission.WRITE,singleTimeout:c.SocketTimeout.commonRequestSingle,totalTimeout:c.SocketTimeout.commonRequestTotal,success:function(t){200==t.code?e(t):n(t)},fail:function(e){n(e)}});p.G.s().emit(o)}))},e.prototype.query=function(e){var t=this;return new Promise((function(r,s){var u=new i["default"]({name:e,params:{},permission:a.Permission.READ,singleTimeout:c.SocketTimeout.commonQuerySingle,totalTimeout:c.SocketTimeout.commonQueryTotal,fail:function(e){s(e)},success:function(e){return n(t,void 0,void 0,(function(){return o(this,(function(t){return r(e),[2]}))}))}});p.G.s().emit(u)}))},e.prototype.loadData=function(e){var t=new f["default"](e.scene,e.id,e.teamId);return new Promise((function(e,n){var o=new i["default"]({name:s.RocketTypes.imData,params:t,permission:a.Permission.READ,singleTimeout:c.SocketTimeout.commonQuerySingle,totalTimeout:c.SocketTimeout.commonQueryTotal,success:function(t){var n=JSON.parse(t.content);e(n)},fail:function(e){n(e)}});p.G.s().emit(o)}))},e.instance=new e,e}();t["default"]=d}(Yc);var Zc=e&&e.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),eu=e&&e.__awaiter||function(e,t,n,o){function r(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function s(e){try{c(o.next(e))}catch(Kf){i(Kf)}}function a(e){try{c(o["throw"](e))}catch(Kf){i(Kf)}}function c(e){e.done?n(e.value):r(e.value).then(s,a)}c((o=o.apply(e,t||[])).next())}))},tu=e&&e.__generator||function(e,t){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");while(s)try{if(n=1,o&&(r=2&i[0]?o["return"]:i[0]?o["throw"]||((r=o["return"])&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(r=s.trys,!(r=r.length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(Kf){i=[6,Kf],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},nu=e&&e.__values||function(e){var t="function"===typeof Symbol&&Symbol.iterator,n=t&&e[t],o=0;if(n)return n.call(e);if(e&&"number"===typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Os.__esModule=!0,Os.Conversations=void 0;var ou=Ns,ru=xr,iu=s,su=ea,au=Mo,cu=Yr,uu=xs,lu=gs,pu=ws,fu=Us,du=Vc,hu=Jr,yu=Yc,mu=ks,vu=Fo,gu=va,bu=Fn,Su=function(){function e(){var e=this;this.list=new Array,this.builder=new su.RemoteAbbrMessageBuilder,this.remoteConversations=yu["default"].instance,this["synchronized"]=!1,lu.GoEasyEventCenter.on(pu.IM_INTERNAL_EVENTS.MAX_MESSAGE_CHANGED,(function(t){return e.onMaxMessageChanged(t)})),lu.GoEasyEventCenter.on(pu.IM_INTERNAL_EVENTS.UNREAD_AMOUNT_CHANGED,(function(t){return e.onUnreadMessageChanged(t)}))}return e.prototype.onUnreadMessageChanged=function(e){var t=this.findConversation(e);t&&this.fireUpdated()},e.prototype.fireUpdated=function(){var e=this.loadLocalConversations(),t=this.getUpdatedEventName();hu.IM.aec.fire(t,{unreadTotal:e.content.unreadTotal,conversations:e.content.conversations})},e.prototype.getUpdatedEventName=function(){return cu.ImApiEvents.CONVERSATIONS_UPDATED},e.prototype.latestConversations=function(e){return eu(this,void 0,void 0,(function(){var t;return tu(this,(function(n){switch(n.label){case 0:return this["synchronized"]?[3,2]:[4,this.loadServerConversations()];case 1:n.sent(),n.label=2;case 2:return t=this.loadLocalConversations(),ru.CallbackUtils.onSuccess(e,t),[2]}}))}))},e.prototype.loadServerConversations=function(){return eu(this,void 0,void 0,(function(){var e,t;return tu(this,(function(n){switch(n.label){case 0:return e=this.rocketName(),[4,this.remoteConversations.query(e)];case 1:return t=n.sent(),this.convertAbbrConversation(t.content),this["synchronized"]=!0,[2]}}))}))},e.prototype.rocketName=function(){return au.RocketTypes.imLastConversations},e.prototype.convertAbbrConversation=function(e){var t,n,o=e;try{for(var r=nu(o),i=r.next();!i.done;i=r.next()){var s=i.value,a=s.t,c=s.top,u=s.d?JSON.parse(s.d):{},l=s.userOffsets;s.lmsg.t=a;var p=s.lmsg,f=this.builder.build(p),d=fu.Target.byIMMessage(f),h=this.findConversation(d);bu["default"].isUndef(h)?(h=this.buildByAbbr(s,f),this.insertOne(h)):(h.top=c,h.data=u),mu["default"].get(d).initMaxMessageAndOffsets(f,l),this.correctPosition(h)}}catch(y){t={error:y}}finally{try{i&&!i.done&&(n=r["return"])&&n.call(r)}finally{if(t)throw t.error}}},e.prototype.onMaxMessageChanged=function(e){return eu(this,void 0,void 0,(function(){var t;return tu(this,(function(n){switch(n.label){case 0:return e.scene()===iu.Scene.CS&&(t=e,vu.G.u()!=t.customerId()&&(!1===t.accepted||t.type===gu.CSMessageType.ACCEPT&&t.senderId!=vu.G.u()))?[2]:[4,this.saveOrUpdateConversation(e)];case 1:return n.sent(),[2]}}))}))},e.prototype.saveOrUpdateConversation=function(e){return eu(this,void 0,void 0,(function(){var t,n,o,r;return tu(this,(function(i){switch(i.label){case 0:return t=e.status,n=fu.Target.byIMMessage(e),o=this.findConversation(n),bu["default"].isUndef(o)&&t!==iu.MessageStatus.FAIL?(o=this.buildByMessage(e),this.insertOne(o),t!==iu.MessageStatus.SUCCESS?[3,2]:(r=o,[4,this.remoteConversations.loadData(n)])):[3,2];case 1:r.data=i.sent(),o.dataLoaded=!0,i.label=2;case 2:return t===iu.MessageStatus.SENDING&&(o.data=e.getToData(),o.dataLoaded=!0),o&&o.dataLoaded&&(this.correctPosition(o),this.fireUpdated()),[2]}}))}))},e.prototype.loadLocalConversations=function(){var e,t,n=0,o=new Array;try{for(var r=nu(this.list),i=r.next();!i.done;i=r.next()){var s=i.value;if(s.dataLoaded&&s.getMaxMessage()){n+=s.getUnreadAmount();var a=s.toDto();o.push(a)}}}catch(c){e={error:c}}finally{try{i&&!i.done&&(t=r["return"])&&t.call(r)}finally{if(e)throw e.error}}return{code:200,content:{unreadTotal:n,conversations:o}}},e.prototype.findConversationIndex=function(e){return this.list.findIndex((function(t){return e.toString()===t.target.toString()}))},e.prototype.findConversation=function(e){var t=this.findConversationIndex(e);return this.list[t]},e.prototype.removeLocalConversation=function(e){var t=this.findConversationIndex(e.target);this.list.splice(t,1)},e.prototype.insertOne=function(t){e.sortedInserter.insert(this.list,t),this.list.length>e.CONVERSATIONS_MAX_LENGTH&&(this.list=this.list.slice(0,e.CONVERSATIONS_MAX_LENGTH))},e.prototype.correctPosition=function(e){this.removeLocalConversation(e),this.insertOne(e)},e.prototype.removeConversation=function(e){var t=fu.Target.byIMMessage(e),n=this.findConversation(t);n&&(this.removeLocalConversation(n),this.fireUpdated())},e.prototype.top=function(e,t,n){return eu(this,void 0,void 0,(function(){var o;return tu(this,(function(r){switch(r.label){case 0:if(!bu["default"].isBoolean(t))throw new Error("top must be boolean.");if(o=this.findConversation(e),!o)throw new Error("conversation does not exist.");return o.top==t?[3,2]:[4,this.remoteConversations.top(e,t)];case 1:r.sent(),o.top=t,this.correctPosition(o),r.label=2;case 2:return this.fireUpdated(),ru.CallbackUtils.onSuccess(n),[2]}}))}))},e.prototype.remove=function(e,t){return eu(this,void 0,void 0,(function(){var n;return tu(this,(function(o){switch(o.label){case 0:if(n=this.findConversation(e),!n)throw new Error("conversation does not exist.");return[4,this.remoteConversations.remove(e)];case 1:return o.sent(),this.removeLocalConversation(n),this.fireUpdated(),ru.CallbackUtils.onSuccess(t),[2]}}))}))},e.prototype.buildByAbbr=function(e,t){var n,o=fu.Target.byIMMessage(t);if(e.t===iu.Scene.CS){var r=t;vu.G.u()===r.customerId()?n=new ou.Conversation(o):(n=new du.CSConversation(o),n.accepted=r.accepted)}else n=new ou.Conversation(o);return n.dataLoaded=!0,n.top=e.top,n.data=e.d?JSON.parse(e.d):{},n},e.prototype.buildByMessage=function(e){var t,n=fu.Target.byIMMessage(e);if(e.scene()===iu.Scene.CS){var o=e;vu.G.u()===o.customerId()?t=new ou.Conversation(n):(t=new du.CSConversation(n),t.accepted=o.accepted)}else t=new ou.Conversation(n);return t},e.CONVERSATIONS_MAX_LENGTH=200,e.sortedInserter=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Zc(t,e),t.prototype.compare=function(e,t){var n;if(e.top==t.top){var o=e.maxMessageTime(),r=t.maxMessageTime();n=r-o}else n=e.top?-1:1;return 0===n?0:n>0?1:-1},t}(uu.SortedInserter)),e}();Os.Conversations=Su;var Eu={},_u=e&&e.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Cu=e&&e.__awaiter||function(e,t,n,o){function r(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function s(e){try{c(o.next(e))}catch(Kf){i(Kf)}}function a(e){try{c(o["throw"](e))}catch(Kf){i(Kf)}}function c(e){e.done?n(e.value):r(e.value).then(s,a)}c((o=o.apply(e,t||[])).next())}))},wu=e&&e.__generator||function(e,t){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");while(s)try{if(n=1,o&&(r=2&i[0]?o["return"]:i[0]?o["throw"]||((r=o["return"])&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(r=s.trys,!(r=r.length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(Kf){i=[6,Kf],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},Mu=e&&e.__values||function(e){var t="function"===typeof Symbol&&Symbol.iterator,n=t&&e[t],o=0;if(n)return n.call(e);if(e&&"number"===typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Eu.__esModule=!0,Eu.PendingConversations=void 0;var Tu=Os,Iu=s,Au=Mo,Ou=Us,Nu=gs,ku=ws,Ru=Yr,Pu=va,xu=ks,Du=Vc,Fu=Fo,Gu=Fn,Uu=function(e){function t(){var t=e.call(this)||this;return t.expired=!1,Nu.GoEasyEventCenter.on(ku.IM_INTERNAL_EVENTS.CS_ONLINE_SUCCESS,(function(){return t.onCSOnlineSuccess()})),Nu.GoEasyEventCenter.on(ku.IM_INTERNAL_EVENTS.CS_OFFLINE_SUCCESS,(function(){return t.onCSOfflineSuccess()})),Fu.G.s().addDisconnectedObserver(t.onDisconnected.bind(t)),Fu.G.s().addConnectedObserver(t.onConnected.bind(t)),t}return _u(t,e),t.prototype.onMaxMessageChanged=function(e){return Cu(this,void 0,void 0,(function(){var t;return wu(this,(function(n){switch(n.label){case 0:return e.scene()!==Iu.Scene.CS?[3,3]:(t=e,t.customerId()==Fu.G.u()||!1!==t.accepted&&t.type!==Pu.CSMessageType.ACCEPT?[3,3]:Pu.CSMessageType.ACCEPT!==e.type?[3,1]:(this.removeConversation(e),[3,3]));case 1:return[4,this.saveOrUpdateConversation(e)];case 2:n.sent(),n.label=3;case 3:return[2]}}))}))},t.prototype.latestConversations=function(t){return Cu(this,void 0,void 0,(function(){var n;return wu(this,(function(o){switch(o.label){case 0:return n=this["synchronized"],[4,e.prototype.latestConversations.call(this,t)];case 1:return o.sent(),this.list.length>0&&!n&&this.fireUpdated(),[2]}}))}))},t.prototype.onUnreadMessageChanged=function(e){},t.prototype.onCSOnlineSuccess=function(){return Cu(this,void 0,void 0,(function(){return wu(this,(function(e){switch(e.label){case 0:return[4,this.loadServerConversations()];case 1:return e.sent(),this.fireUpdated(),[2]}}))}))},t.prototype.onCSOfflineSuccess=function(){this.list=[],this.fireUpdated()},t.prototype.getUpdatedEventName=function(){return Ru.ImApiEvents.PENDING_CONVERSATIONS_UPDATED},t.prototype.rocketName=function(){return Au.RocketTypes.CS_PENDING_CONVERSATION},t.prototype.convertAbbrConversation=function(e){return Cu(this,void 0,void 0,(function(){var t,n,o,r,i,s,a,c,u,l,p,f,d,h;return wu(this,(function(y){t=e;try{for(n=Mu(t),o=n.next();!o.done;o=n.next())r=o.value,r.lastMessage.t=Iu.Scene.CS,i=r.customerData,s=r.lastMessage,a=r.userOffsets,c=i?JSON.parse(i):{},u=this.builder.build(s),l=Ou.Target.byIMMessage(u),p=this.findConversation(l),Gu["default"].isUndef(p)&&(p=new Du.CSConversation(l),p.accepted=u.accepted,p.dataLoaded=!0,this.insertOne(p)),p.top=!1,p.data=c,f=xu["default"].get(l),f.initPendingMaxMessageAndOffsets(u,a),this.correctPosition(p)}catch(m){d={error:m}}finally{try{o&&!o.done&&(h=n["return"])&&h.call(n)}finally{if(d)throw d.error}}return[2]}))}))},t.prototype.onDisconnected=function(){this.expired=!0},t.prototype.onConnected=function(){return Cu(this,void 0,void 0,(function(){return wu(this,(function(e){switch(e.label){case 0:return this.expired?(this.expired=!1,this.list=[],[4,this.loadServerConversations()]):[3,2];case 1:e.sent(),this.fireUpdated(),e.label=2;case 2:return[2]}}))}))},t}(Tu.Conversations);Eu.PendingConversations=Uu,function(e){e.__esModule=!0;var t=Os,n=Us,o=s,r=Eu,i=pa,a=Fo,c=function(){function e(){this.conversations=new t.Conversations,this.pendingConversations=new r.PendingConversations}return e.prototype.latestConversations=function(e){this.conversations.latestConversations(e)},e.prototype.latestPendingConversations=function(e){this.pendingConversations.latestConversations(e)},e.prototype.topPrivateConversation=function(e){var t=n.Target.byScene(o.Scene.PRIVATE,e.userId);this.conversations.top(t,e.top,e)},e.prototype.topGroupConversation=function(e){var t=n.Target.byScene(o.Scene.GROUP,e.groupId);this.conversations.top(t,e.top,e)},e.prototype.topConversation=function(e){var t=e.conversation;this.validateConversationDTO(t);var o=n.Target.byConversationDTO(t);this.conversations.top(o,e.top,e)},e.prototype.removePrivateConversation=function(e){var t=n.Target.byScene(o.Scene.PRIVATE,e.userId);this.conversations.remove(t,e)},e.prototype.removeGroupConversation=function(e){var t=n.Target.byScene(o.Scene.GROUP,e.groupId);this.conversations.remove(t,e)},e.prototype.removeConversation=function(e){var t=e.conversation;this.validateConversationDTO(t);var o=n.Target.byConversationDTO(t);this.conversations.remove(o,e)},e.prototype.validateConversationDTO=function(e){if(!(e instanceof o.ConversationDTO))throw new Error("Incorrect conversation object.");var t=e.lastMessage;if(t instanceof i.CSMessage&&t.customerId()!==a.G.u()&&!1===t.accepted)throw new Error("pending conversation cannot be topped or removed.")},e}();e["default"]=c}(As);var Lu={};(function(e){e.__esModule=!0;var t=ws,n=gs,o=ea,r=Bo,i=To,a=Fn,c=s,u=Fo,l=Yr,p=ks,f=Us,d=Jr,h=function(){function e(){this.builder=new o.RemoteAbbrMessageBuilder,i.GNS.instance.addAssembler(new(function(){function e(){}return e.prototype.assemble=function(e){var t={messageId:e.id,timestamp:e.tm,type:e.t,senderId:e.sid,toType:e.tt};return e.tt===c.Scene.GROUP&&(t.groupId=e.gid),t},e.prototype.support=function(e){return!!e.sid},e}()))}return e.prototype.initialGoEasySocket=function(){u.G.s().addMessageObserver(r.RemoteEvents.imMessage,this.onMessageReceived.bind(this))},e.prototype.onMessageReceived=function(e){if(e.t!==c.Scene.CS){console.log("IMReceiver -> onMessageReceived:",e);var o=this.builder.build(e);this.sendAck(o);var r=f.Target.byIMMessage(o),i=r.scene,s=p["default"].get(r);s.existsMessage(o)||(this.createNotification(e),n.GoEasyEventCenter.fire(t.IM_INTERNAL_EVENTS.MESSAGE_RECEIVED,o),i===c.Scene.PRIVATE?d.IM.aec.fire(l.ImApiEvents.PRIVATE_MESSAGE_RECEIVED,o):i===c.Scene.GROUP&&d.IM.aec.fire(l.ImApiEvents.GROUP_MESSAGE_RECEIVED,o))}},e.prototype.sendAck=function(e){u.G.s().sendAck("imAck",{publishGuid:e.messageId})},e.prototype.createNotification=function(e){var t=i.GNS.instance.supportNotification();if(a["default"].isObject(e.nt)&&e.s!==u.G.u()&&t){var n={id:e.i,tm:e.ts,t:e.mt,sid:e.s,tt:e.t};n.tt===c.Scene.GROUP&&(n.gid=e.r),i.GNS.instance.createLocalNotification(e.nt.t,e.nt.c,n)}},e}();e["default"]=h})(Lu);var ju={};(function(e){e.__esModule=!0;var t=Un,n=l,o=yo,r=Do,i=Mo,s=xr,a=Fo,c=function(){function e(){}return e.prototype.subscribe=function(e){r["default"].validateIdArray(e.groupIds,"groupIds"),e.groupIds=e.groupIds.toString().split(",");var c=new t["default"]({name:i.RocketTypes.subscribeGroups,params:{groupIds:e.groupIds,at:e.accessToken},permission:n.Permission.WRITE,singleTimeout:o.SocketTimeout.commonInfiniteSingle,totalTimeout:o.SocketTimeout.commonInfiniteTotal,success:function(){s.CallbackUtils.onSuccess(e,{code:200,content:"ok"})},fail:function(t){s.CallbackUtils.onFailed(e,{code:t.resultCode||408,content:t.content||"Failed to subscribe group message"})}});a.G.s().emit(c)},e.prototype.unsubscribe=function(e){r["default"].validateId(e.groupId,"groupId"),e.groupId=e.groupId.toString();var c=new t["default"]({name:i.RocketTypes.unsubscribeGroup,params:{groupId:e.groupId},permission:n.Permission.READ,singleTimeout:o.SocketTimeout.commonRequestSingle,totalTimeout:o.SocketTimeout.commonRequestTotal,success:function(){s.CallbackUtils.onSuccess(e,{code:200,content:"ok"})},fail:function(t){s.CallbackUtils.onFailed(e,{code:t.resultCode||408,content:t.content||"Failed to unsubscribe group message"})}});a.G.s().emit(c)},e}();e["default"]=c})(ju);var Bu={};(function(e){e.__esModule=!0;var t=Un,n=l,o=yo,r=Mo,i=Bo,s=Yr,a=Do,c=xr,u=Fo,p=Jr,f=function(){function e(){u.G.s().addMessageObserver(i.RemoteEvents.groupPresence,this.newMessageReceived.bind(this))}return e.prototype.presence=function(e){a["default"].validateIdArray(e.groupIds,"groupIds"),e.groupIds.toString().split(",");var t=function(){c.CallbackUtils.onSuccess(e,{code:200,content:"ok"})},n=function(t){c.CallbackUtils.onFailed(e,{code:t.code||408,content:t.content||"Failed to subscribe group message"})},i={groupIds:e.groupIds};this.emitRocket(r.RocketTypes.subscribeGroupPresence,i,t,n,o.SocketTimeout.commonInfiniteSingle,o.SocketTimeout.commonInfiniteTotal)},e.prototype.unPresence=function(e){a["default"].validateId(e.groupId,"groupId"),e.groupId=e.groupId.toString();var t=function(){c.CallbackUtils.onSuccess(e,{code:200,content:"ok"})},n=function(t){c.CallbackUtils.onFailed(e,{code:t.code||408,content:t.content||"Failed to unsubscribe presence"})},i={groupId:e.groupId};this.emitRocket(r.RocketTypes.unsubscribeGroupPresence,i,t,n,o.SocketTimeout.commonRequestSingle,o.SocketTimeout.commonRequestTotal)},e.prototype.emitRocket=function(e,o,r,i,s,a){var c=new t["default"]({name:e,params:o,singleTimeout:s,totalTimeout:a,permission:n.Permission.WRITE,success:r,fail:i});u.G.s().emit(c)},e.prototype.newMessageReceived=function(e){var t=null;e.c&&(t=JSON.parse(e.c)),t&&t.events&&t.events.map((function(e){var n=e.userData?JSON.parse(e.userData):{},o={time:e.time,action:e.action,groupOnlineCount:t.userAmount,groupId:t.groupId,id:e.userId,data:n};p.IM.aec.fire(s.ImApiEvents.GROUP_PRESENCE,o)}))},e}();e["default"]=f})(Bu);var qu={};(function(e){e.__esModule=!0;var t=Un,n=l,o=yo,r=Mo,i=Do,s=xr,a=Fo,c=function(){function e(){}return e.prototype.get=function(e){i["default"].validateId(e.groupId,"groupId"),e.groupId=e.groupId.toString();var c=new t["default"]({name:r.RocketTypes.imGroupOnlineCount,params:{groupId:e.groupId},permission:n.Permission.READ,singleTimeout:o.SocketTimeout.commonQuerySingle,totalTimeout:o.SocketTimeout.commonQueryTotal,fail:function(t){s.CallbackUtils.onFailed(e,t||{code:408,content:"Failed to query online group users"})},success:function(t){200==t.code?s.CallbackUtils.onSuccess(e,t):s.CallbackUtils.onFailed(e,t)}});a.G.s().emit(c)},e}();e["default"]=c})(qu);var Vu={};(function(e){e.__esModule=!0;var t=Un,n=l,o=yo,r=Mo,i=Do,s=xr,a=Fo,c=function(){function e(){}return e.prototype.hereNow=function(e){i["default"].validateId(e.groupId,"groupId"),e.groupId=e.groupId.toString();var c=new t["default"]({name:r.RocketTypes.imGroupHereNow,params:{groupId:e.groupId},permission:n.Permission.READ,singleTimeout:o.SocketTimeout.commonQuerySingle,totalTimeout:o.SocketTimeout.commonQueryTotal,fail:function(t){s.CallbackUtils.onFailed(e,{code:t.resultCode||408,content:t.content||"Failed to query online group users"})},success:function(t){if(200==t.code){var n=t.content;t.content=n.map((function(e){var t=e.userData?JSON.parse(e.userData):{};return{id:e.userId,data:t}})),s.CallbackUtils.onSuccess(e,t)}else s.CallbackUtils.onFailed(e,t)}});a.G.s().emit(c)},e}();e["default"]=c})(Vu);var Hu={};(function(e){e.__esModule=!0;var t=Un,n=l,o=yo,r=Do,i=Mo,s=Bo,a=Yr,c=xr,u=Fo,p=Jr,f=function(){function e(){u.G.s().addMessageObserver(s.RemoteEvents.userPresence,this.newMessageReceived.bind(this))}return e.prototype.presence=function(e){r["default"].validateIdArray(e.userIds,"userIds"),e.userIds.toString().split(",");var t=function(){c.CallbackUtils.onSuccess(e,{code:200,content:"ok"})},n=function(t){c.CallbackUtils.onFailed(e,{code:t.code||408,content:t.content||"Failed to subscribe group message"})},s={userIds:e.userIds};this.emitRocket(i.RocketTypes.subscribeUserPresence,s,t,n,o.SocketTimeout.commonInfiniteSingle,o.SocketTimeout.commonInfiniteTotal)},e.prototype.unPresence=function(e){r["default"].validateId(e.userId,"userId"),e.userId=e.userId.toString();var t=function(){c.CallbackUtils.onSuccess(e,{code:200,content:"ok"})},n=function(t){c.CallbackUtils.onFailed(e,{code:t.code||408,content:t.content||"Failed to unsubscribe presence"})},s={userId:e.userId};this.emitRocket(i.RocketTypes.unsubscribeUserPresence,s,t,n,o.SocketTimeout.commonRequestSingle,o.SocketTimeout.commonRequestTotal)},e.prototype.emitRocket=function(e,o,r,i,s,a){var c=new t["default"]({name:e,params:o,singleTimeout:s,totalTimeout:a,permission:n.Permission.WRITE,success:r,fail:i});u.G.s().emit(c)},e.prototype.newMessageReceived=function(e){var t=[];e.c&&(t=JSON.parse(e.c).events||[]),t.map((function(e){var t=e.userData?JSON.parse(e.userData):{},n={time:e.time,action:e.action,id:e.userId,data:t};p.IM.aec.fire(a.ImApiEvents.USER_PRESENCE,n)}))},e}();e["default"]=f})(Hu);var Wu={};(function(e){e.__esModule=!0;var t=Un,n=l,o=yo,r=Mo,i=Do,s=xr,a=Fo,c=function(){function e(){}return e.prototype.hereNow=function(e){var c=e.userIds;i["default"].validateIdArray(c,"userIds"),c.toString().split(",");var u=new t["default"]({name:r.RocketTypes.imHereNow,params:e,permission:n.Permission.READ,singleTimeout:o.SocketTimeout.commonQuerySingle,totalTimeout:o.SocketTimeout.commonQueryTotal,fail:function(t){s.CallbackUtils.onFailed(e,t)},success:function(t){if(200==t.code){var n=t.content;t.content=n.map((function(e){var t=e.userData?JSON.parse(e.userData):{};return{id:e.userId,data:t}})),s.CallbackUtils.onSuccess(e,t)}else s.CallbackUtils.onFailed(e,t)}});a.G.s().emit(u)},e}();e["default"]=c})(Wu);var zu={},Ju={},Xu={__esModule:!0,str:void 0},Yu=Fn,Qu=function(){function e(){}return e.prototype.fileExtension=function(e,t){if(Yu["default"].isString(e))try{var n=e.split(t);return n[n.length-1]}catch(Kf){throw Error(Kf)}},e}(),Ku=new Qu;Xu.str=Ku;var $u={},Zu={},el={__esModule:!0,AbstractMessagePayload:void 0},tl=function(){function e(){}return e}();el.AbstractMessagePayload=tl;var nl=e&&e.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();Zu.__esModule=!0,Zu.FileMessagePayload=void 0;var ol=el,rl=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.contentType="",t.name="",t.size=0,t.url="",t}return nl(t,e),t}(ol.AbstractMessagePayload);Zu.FileMessagePayload=rl;var il=e&&e.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();$u.__esModule=!0,$u.ImageMessagePayload=void 0;var sl=Zu,al=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.width=0,t.height=0,t}return il(t,e),t}(sl.FileMessagePayload);$u.ImageMessagePayload=al;var cl={},ul={__esModule:!0,AbstractPayloadBuilder:void 0},ll=function(){function e(){}return e.prototype.build=function(e){this.validate(e.createOptions);var t=this.create();return this.setPayload(e,t),t},e}();ul.AbstractPayloadBuilder=ll,function(t){var n=e&&e.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();t.__esModule=!0;var o=ul,r=Zu,i=Fn,s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.create=function(){return new r.FileMessagePayload},t.prototype.setPayload=function(e,t){var n=t,o=e.createOptions,r=o.file;n.url=r.path,n.name=r.name,n.size=r.size,n.contentType=r.type,e.complete=Promise.resolve()},t.prototype.validate=function(e){if(!i["default"].isObject(e))throw Error("it is an empty message.");if(!i["default"].isDef(e.file))throw Error("file is empty.")},t}(o.AbstractPayloadBuilder);t["default"]=s}(cl),function(t){var n=e&&e.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();t.__esModule=!0;var o=Xu,r=Fn,i=$u,s=cl,a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.create=function(){return new i.ImageMessagePayload},t.prototype.setPayload=function(t,n){e.prototype.setPayload.call(this,t,n);var i=t.createOptions,s=i.file,a=n,c=s.path||s.tempFilePath,u=r["default"].isEmpty(s.name)||void 0===s.name?c:s.name;a.name="wx-image."+o.str.fileExtension(u,"."),a.contentType="image/"+o.str.fileExtension(u,"."),a.url=c,a.size=s.size,t.complete=new Promise((function(e,t){wx.getImageInfo({src:a.url,success:function(t){a.width=t.width,a.height=t.height,e()},fail:function(e){t(e)}})}))},t.prototype.validate=function(t){e.prototype.validate.call(this,t)},t}(s["default"]);t["default"]=a}(Ju);var pl={},fl={},dl=e&&e.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();fl.__esModule=!0,fl.AudioMessagePayload=void 0;var hl=Zu,yl=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.duration=0,t}return dl(t,e),t}(hl.FileMessagePayload);fl.AudioMessagePayload=yl,function(t){var n=e&&e.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();t.__esModule=!0;var o=fl,r=Fn,i=Xu,s=cl,a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.create=function(){return new o.AudioMessagePayload},t.prototype.setPayload=function(t,n){e.prototype.setPayload.call(this,t,n);var o=t.createOptions,s=o.file,a=n,c=s.tempFilePath,u=r["default"].isEmpty(s.name)||void 0==s.name?c:s.name,l=s.duration,p=s.fileSize;a.url=c,a.size=p,a.duration=l/1e3,a.name="wx-audio."+i.str.fileExtension(u,"."),a.contentType="audio/"+i.str.fileExtension(u,"."),t.complete=Promise.resolve()},t.prototype.validate=function(t){e.prototype.validate.call(this,t)},t}(s["default"]);t["default"]=a}(pl);var ml={},vl={},gl=e&&e.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();vl.__esModule=!0,vl.TextMessagePayload=void 0;var bl=el,Sl=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.text="",t}return gl(t,e),t}(bl.AbstractMessagePayload);vl.TextMessagePayload=Sl;var El=e&&e.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();ml.__esModule=!0,ml.TextPayloadBuilder=void 0;var _l=ul,Cl=vl,wl=Fn,Ml=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return El(t,e),t.prototype.create=function(){return new Cl.TextMessagePayload},t.prototype.setPayload=function(e,t){var n=t,o=e.createOptions;n.text=o.text,e.complete=Promise.resolve()},t.prototype.validate=function(e){if(wl["default"].isEmpty(e.text))throw{code:400,content:"text is empty"};if(!wl["default"].isString(e.text))throw{code:400,content:"TypeError: text requires string."};if(""===e.text.trim())throw{code:400,content:"text is empty"};if(e.text.length>2500)throw{code:400,content:"Message text over max length 2500"}},t}(_l.AbstractPayloadBuilder);ml.TextPayloadBuilder=Ml;var Tl={},Il={},Al=e&&e.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();Il.__esModule=!0,Il.VideoMessagePayload=void 0;var Ol=el,Nl=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.video=new Rl,t.thumbnail=new kl,t}return Al(t,e),t}(Ol.AbstractMessagePayload);Il.VideoMessagePayload=Nl;var kl=function(){function e(){this.name="",this.url="",this.width=0,this.height=0,this.contentType=""}return e}(),Rl=function(){function e(){this.name="",this.url="",this.width=0,this.height=0,this.contentType="",this.size=0,this.duration=0}return e}();(function(t){var n=e&&e.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();t.__esModule=!0;var o=Il,r=Fn,i=Xu,s=ul,a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.create=function(){return new o.VideoMessagePayload},t.prototype.setPayload=function(e,t){var n=e.createOptions,o=n.file,s=t,a=s.video,c=s.thumbnail,u=o.duration,l=o.height,p=o.size,f=o.tempFilePath,d=o.thumbTempFilePath,h=o.width,y=o.name,m=void 0===y?"":y,v=r["default"].isEmpty(m)?f:m;a.contentType="video/"+i.str.fileExtension(v,"."),a.name="wx-video."+i.str.fileExtension(v,"."),a.url=f,a.width=c.width=h,a.height=c.height=l,a.size=p,a.duration=u,c.url=d,c.contentType="image/jpg",c.name="wx-thumbnail.jpg",e.complete=Promise.resolve()},t.prototype.validate=function(e){if(!r["default"].isObject(e))throw Error("it is an empty message.");if(!r["default"].isDef(e.file))throw Error("file is empty.")},t}(s.AbstractPayloadBuilder);t["default"]=a})(Tl);var Pl={},xl={};(function(t){var n=e&&e.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();t.__esModule=!0;var o=ul,r=Zu,i=Fn,s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.create=function(){return new r.FileMessagePayload},t.prototype.setPayload=function(e,t){var n=t,o=e.createOptions,r=o.file;n.url=r.fullPath,n.name=r.name,n.size=r.size,n.contentType=r.type,console.log("filePayload file.type",r.type),e.complete=Promise.resolve()},t.prototype.validate=function(e){if(!i["default"].isObject(e))throw Error("it is an empty message.");if(!i["default"].isDef(e.file))throw Error("file is empty.")},t}(o.AbstractPayloadBuilder);t["default"]=s})(xl),function(t){var n=e&&e.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();t.__esModule=!0;var o=Xu,r=Fn,i=$u,s=xl,a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.create=function(){return new i.ImageMessagePayload},t.prototype.setPayload=function(e,t){var n=t,i=e.createOptions,s=i.file;n.url=s.path,n.size=s.size;var a=r["default"].isEmpty(s.name)||void 0===s.name?s.path:s.name;n.contentType="image/"+o.str.fileExtension(a,"."),n.name="uni-image."+o.str.fileExtension(a,"."),e.complete=new Promise((function(e,t){uni.getImageInfo({src:s.path,success:function(t){n.width=t.width,n.height=t.height,e()},fail:function(e){t(e)}})}))},t.prototype.validate=function(t){e.prototype.validate.call(this,t)},t}(s["default"]);t["default"]=a}(Pl);var Dl={};(function(t){var n=e&&e.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();t.__esModule=!0;var o=Fn,r=Xu,i=fl,s=xl,a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.create=function(){return new i.AudioMessagePayload},t.prototype.setPayload=function(e,t){var n=e.createOptions,i=t,s=n.file,a=s.tempFilePath,c=o["default"].isEmpty(s.name)||void 0==s.name?a:s.name;i.url=a,i.name="uni-audio."+r.str.fileExtension(c,"."),i.contentType="audio/"+r.str.fileExtension(c,"."),e.complete=new Promise((function(e,t){uni.getFileInfo({filePath:a,success:function(r){var s=r.size;if(i.size=s,0===s)e();else if(o["default"].isDef(n.file.duration))i.duration=n.file.duration/1e3,e();else{var c=uni.createInnerAudioContext();c.src=a,c.onCanplay((function(n){n.errCode?(c.destroy(),t(n)):(i.duration=c.duration,c.destroy(),e())})),c.onError((function(n){c.destroy(),-99===n.errCode?e():t(n)}))}},fail:function(e){t(e)}})}))},t.prototype.validate=function(t){e.prototype.validate.call(this,t)},t}(s["default"]);t["default"]=a})(Dl);var Fl={};(function(t){var n=e&&e.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();t.__esModule=!0;var o=Fn,r=Xu,i=Il,s=ul,a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.create=function(){return new i.VideoMessagePayload},t.prototype.setPayload=function(e,t){var n=e.createOptions,i=n.file,s=t,a=s.video,c=s.thumbnail,u=i.duration,l=i.height,p=i.size,f=i.tempFilePath,d=i.width,h=i.name,y=void 0===h?"":h,m=o["default"].isEmpty(y)?f:y;a.size=p,a.width=d,a.height=l,a.url=f,a.duration=u,a.contentType="video/"+r.str.fileExtension(m,"."),a.name="uni-video."+r.str.fileExtension(m,"."),c.url=f,c.width=d,c.height=l,c.contentType="image/jpg",c.name="uni-thumbnail.jpg",e.complete=Promise.resolve()},t.prototype.validate=function(e){if(!o["default"].isObject(e))throw Error("it is an empty message.");if(!o["default"].isDef(e.file))throw Error("file is empty.")},t}(s.AbstractPayloadBuilder);t["default"]=a})(Fl);var Gl={},Ul={};(function(t){var n=e&&e.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();t.__esModule=!0;var o=ul,r=Zu,i=Fn,s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.create=function(){return new r.FileMessagePayload},t.prototype.setPayload=function(e,t){var n=t,o=e.createOptions,r=o.file,i=window.URL||window.webkitURL;n.url=i.createObjectURL(r),n.name=r.name,n.size=r.size,n.contentType=r.type,e.complete=Promise.resolve()},t.prototype.validate=function(e){if(!i["default"].isObject(e))throw Error("it is an empty message.");if(!(e.file instanceof File))throw Error("wrong file type.");if(0==e.file.size)throw Error("File size is 0.");if(e.file.size>524288e3)throw Error("message-length limit 30mib")},t}(o.AbstractPayloadBuilder);t["default"]=s})(Ul),function(t){var n=e&&e.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();t.__esModule=!0;var o=$u,r=Ul,i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.create=function(){return new o.ImageMessagePayload},t.prototype.setPayload=function(t,n){e.prototype.setPayload.call(this,t,n);var o=t.createOptions,r=o.file,i=n,s=window.URL||window.webkitURL,a=new Image;a.src=s.createObjectURL(r),t.complete=new Promise((function(e,t){a.onload=function(){i.width=a.width,i.height=a.height,s.revokeObjectURL(a.src),e()},a.onerror=function(e){s.revokeObjectURL(a.src),t(e)}}))},t.prototype.validate=function(t){e.prototype.validate.call(this,t);var n=["gif","jpg","png","jpeg"];if(!n.find((function(e){return e===t.file.type.split("/")[1].toLowerCase()})))throw Error("Only "+n.join(",")+" is supported image.")},t}(r["default"]);t["default"]=i}(Gl);var Ll={};(function(t){var n=e&&e.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();t.__esModule=!0;var o=fl,r=Ul,i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.create=function(){return new o.AudioMessagePayload},t.prototype.setPayload=function(t,n){e.prototype.setPayload.call(this,t,n);var o=t.createOptions,r=o.file,i=n,s=window.URL||window.webkitURL,a=document.createElement("audio");a.src=s.createObjectURL(r),t.complete=new Promise((function(e,t){a.onloadedmetadata=function(){i.duration=a.duration,s.revokeObjectURL(a.src),e()},a.onerror=function(e){s.revokeObjectURL(a.src),t(e)}}))},t.prototype.validate=function(t){e.prototype.validate.call(this,t);var n=["mp3","ogg","wav","wma","ape","acc","mpeg"];if(!n.find((function(e){return e===t.file.type.split("/")[1].toLowerCase()})))throw Error("Only "+n.join(",")+" is supported audio.")},t}(r["default"]);t["default"]=i})(Ll);var jl={};(function(t){var n=e&&e.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();t.__esModule=!0;var o=Il,r=ul,i=Fn,s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.create=function(){return new o.VideoMessagePayload},t.prototype.setPayload=function(e,t){var n=this,o=e.createOptions,r=o.file,i=t,s=i.video,a=i.thumbnail,c=window.URL||window.webkitURL,u=document.createElement("video");u.src=c.createObjectURL(r),s.size=r.size,s.name=r.name,s.contentType=r.type,s.url=u.src,a.name=r.name,a.contentType="image/jpg",e.complete=new Promise((function(e,t){u.onloadedmetadata=function(){s.duration=u.duration,s.width=u.videoWidth,s.height=u.videoHeight,a.width=u.videoWidth,a.height=u.videoHeight,a.url=n.getThumbnailUrl(u),c.revokeObjectURL(u.src),e()},u.onerror=function(e){c.revokeObjectURL(u.src),t(e)}}))},t.prototype.getThumbnailUrl=function(e){var t=document.createElement("canvas");return t.width=e.videoWidth,t.height=e.videoHeight,t.getContext("2d").drawImage(e,0,0,t.width,t.height),t.toDataURL("image/png")},t.prototype.validate=function(e){if(!i["default"].isObject(e))throw Error("it is an empty message.");if(!(e.file instanceof File))throw Error("wrong file type.");if(0==e.file.size)throw Error("File size is 0.");if(e.file.size>31457280)throw Error("message-length limit 30mib");var t=["avi","mov","rmvb","rm","flv","mp4","3gp","quicktime"];if(!t.find((function(t){return t===e.file.type.split("/")[1].toLowerCase()})))throw Error("Only "+t.join(",")+" is supported video.")},t}(r.AbstractPayloadBuilder);t["default"]=s})(jl);var Bl={},ql={};(function(t){var n=e&&e.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();t.__esModule=!0;var o=el,r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t}(o.AbstractMessagePayload);t["default"]=r})(ql);var Vl=e&&e.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();Bl.__esModule=!0,Bl.CustomPayloadBuilder=void 0;var Hl=ul,Wl=ql,zl=Fn,Jl=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Vl(t,e),t.prototype.create=function(){return new Wl["default"]},t.prototype.setPayload=function(e,t){var n=e.createOptions,o=t;o.payload=n.payload,e.complete=Promise.resolve()},t.prototype.validate=function(e){var t=e.type,n=e.payload;if(zl["default"].isEmpty(t))throw Error("type is empty.");if(!zl["default"].isString(t))throw Error("type require a string");if(zl["default"].isEmpty(n))throw Error("payload is empty.");if(!zl["default"].isPlainObject(n)&&!zl["default"].isStringOrNumber(n))throw Error("payload require object | string | number.")},t}(Hl.AbstractPayloadBuilder);Bl.CustomPayloadBuilder=Jl;var Xl={__esModule:!0,LocalIMMessageBuildOptions:void 0},Yl=function(){function e(e,t){this.type=e,this.createOptions=t}return e}();Xl.LocalIMMessageBuildOptions=Yl,zu.__esModule=!0,zu.IMMessageBuilder=void 0;var Ql=$t,Kl=Ju,$l=cl,Zl=pl,ep=ml,tp=Tl,np=Pl,op=xl,rp=Dl,ip=Fl,sp=Gl,ap=Ul,cp=Ll,up=jl,lp=Bl,pp=Xl,fp=Ln,dp=Fn,hp=s,yp=sa,mp=ta,vp=Do,gp=pa,bp=xr,Sp=Fo,Ep=function(){function e(){var e;this.framework=Ql.FrameworkDetector.currentFramework(),this.payloadBuilders=(e={},e[Ql.Framework.UNIAPP]={image:new np["default"],file:new op["default"],audio:new rp["default"],video:new ip["default"],text:new ep.TextPayloadBuilder},e[Ql.Framework.NATIVE_APPLET_WX]={image:new Kl["default"],file:new $l["default"],audio:new Zl["default"],video:new tp["default"],text:new ep.TextPayloadBuilder},e[Ql.Framework.UNKNOWN]={image:new sp["default"],file:new ap["default"],audio:new cp["default"],video:new up["default"],text:new ep.TextPayloadBuilder},e)}return e.prototype.buildMessage=function(e,t){var n=this.payloadBuilders[this.framework][e],o=new pp.LocalIMMessageBuildOptions(e,t);if(n){var r=n.build(o);o.payload=r}else{var i=new lp.CustomPayloadBuilder;r=i.build(o);o.payload=r.payload}var s=this.build(o);return o.complete.then((function(){bp.CallbackUtils.onSuccess(t,s)}))["catch"]((function(e){bp.CallbackUtils.onFailed(t,e)})),s},e.prototype.build=function(e){var t,n=e.type,o=e.payload,r=e.createOptions,i=r.to,s=i.type;return this.validate(r),s===hp.Scene.GROUP?(t=new yp.GroupMessage,t.groupId=i.id.toString(),t.senderData=Sp.G.ud()):s===hp.Scene.PRIVATE?(t=new mp.PrivateMessage,t.read=!1,t.receiverId=i.id.toString()):s===hp.Scene.CS&&(t=new gp.CSMessage,t.to=i.id.toString(),t.teamId=i.id.toString(),t.senderData=Sp.G.ud()),t.senderId=Sp.G.u(),t.messageId=fp["default"].get(),t.payload=o,t.timestamp=Date.now(),t.type=n,t.recalled=!1,t.status=hp.MessageStatus.NEW,t.buildOptions=e,t},e.prototype.validate=function(e){var t=e.to;if(!t)throw new Error("message require property to.");if(!dp["default"].isObject(t))throw new Error("TypeError: to requires an object.");if(!dp["default"].isObject(t.data))throw new Error("TypeError: to.data requires an object.");if(!t.type||t.type!==hp.Scene.GROUP&&t.type!==hp.Scene.PRIVATE&&t.type!==hp.Scene.CS)throw new Error("message require property to.type");if(dp["default"].isEmpty(t.id))throw new Error("message require property to.id");if(!dp["default"].isStringOrNumber(t.id))throw new Error("to.id should be a string or number.");if(Sp.G.u()===t.id)throw new Error("to.id can not be the same as your id.");e.notification&&vp["default"].validateNotification(e.notification),e.wxmpTemplateMsg&&vp["default"].validateWXMPTemplateMsg(e.wxmpTemplateMsg)},e}();zu.IMMessageBuilder=Ep;var _p={},Cp=e&&e.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();_p.__esModule=!0,_p.CsMessageReceiver=void 0;var wp=gs,Mp=ws,Tp=Za,Ip=Fo,Ap=Jr,Op=Yr,Np=Lu,kp=Us,Rp=ks,Pp=s,xp=Xa,Dp=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Cp(t,e),t.prototype.onMessageReceived=function(e){var t=this;if(e.t===Pp.Scene.CS){var n=this.builder.build(e);this.sendAck(n);var o=kp.Target.byIMMessage(n),r=Rp["default"].get(o);if(!r.existsMessage(n)){var i=n;if(i.customerId()===Ip.G.u())this.createNotification(e),wp.GoEasyEventCenter.fire(Mp.IM_INTERNAL_EVENTS.MESSAGE_RECEIVED,n),Ap.IM.aec.fire(Op.ImApiEvents.CS_MESSAGE_RECEIVED,n);else{var s=Tp.AgentStatus.getInstance().queryTeams();s.then((function(){xp.LiveSession.isMyCustomer(o)&&t.createNotification(e),wp.GoEasyEventCenter.fire(Mp.IM_INTERNAL_EVENTS.CS_AGENT_MESSAGE_RECEIVED,n)}))}}}},t}(Np["default"]);_p.CsMessageReceiver=Dp;var Fp=e&&e.__awaiter||function(e,t,n,o){function r(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function s(e){try{c(o.next(e))}catch(Kf){i(Kf)}}function a(e){try{c(o["throw"](e))}catch(Kf){i(Kf)}}function c(e){e.done?n(e.value):r(e.value).then(s,a)}c((o=o.apply(e,t||[])).next())}))},Gp=e&&e.__generator||function(e,t){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");while(s)try{if(n=1,o&&(r=2&i[0]?o["return"]:i[0]?o["throw"]||((r=o["return"])&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(r=s.trys,!(r=r.length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(Kf){i=[6,Kf],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Jr.__esModule=!0,Jr.IM=void 0;var Up=Xr,Lp=ni,jp=Zi,Bp=As,qp=Lu,Vp=ju,Hp=Bu,Wp=qu,zp=Vu,Jp=Hu,Xp=Wu,Yp=Fn,Qp=Ro,Kp=Do,$p=xr,Zp=zu,ef=Ri,tf=ks,nf=Fo,of=_p,rf=function(){function e(t){this._iMReceiver=new qp["default"],this.csMessageReceiver=new of.CsMessageReceiver,this.options=t,e.aec=new Up.ApiEventCenter,this._userHereNow=new Xp["default"],this.goEasyUploader=new Lp.GoEasyUploader,this._groupHereNow=new zp["default"],this._groupOnlineCount=new Wp["default"],this.groupMessageSubscriber=new Vp["default"]}return e.init=function(t){e.instance=new e(t)},e.prototype.afterConnect=function(){this._iMReceiver.initialGoEasySocket(),this.csMessageReceiver.initialGoEasySocket(),this.messageBuilder=new Zp.IMMessageBuilder,this.messageSender=new jp["default"],this.histories=tf["default"].init(),this.histories.initialListeners(),this.conversations=new Bp["default"],this._groupPresenceSubscriber=new Hp["default"],this._userPresenceSubscriber=new Jp["default"]},e.prototype.validateModules=function(){if(Yp["default"].isUndef(nf.G.s()))throw Error("Please call connect() first.");if(!this.options.modules||!this.options.modules.includes(Qp.ModuleTypes.IM))throw Error("Invalid options: module '".concat(Qp.ModuleTypes.IM,"' is not enabled"))},e.prototype["catch"]=function(e,t){return Fp(this,void 0,void 0,(function(){var n;return Gp(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),this.validateModules(),Kp["default"].validateCallbackOptions(t),[4,e()];case 1:return o.sent(),[3,3];case 2:return n=o.sent(),$p.CallbackUtils.onFailed(t,n),[3,3];case 3:return[2]}}))}))},e.prototype.on=function(t,n){e.aec.on(t,n)},e.prototype.off=function(t,n){e.aec.off(t,n)},e.prototype.createTextMessage=function(e){return this.validateModules(),this.messageBuilder.buildMessage(ef.MessageType.TEXT,e)},e.prototype.createImageMessage=function(e){return this.validateModules(),this.messageBuilder.buildMessage(ef.MessageType.IMAGE,e)},e.prototype.createFileMessage=function(e){return this.validateModules(),this.messageBuilder.buildMessage(ef.MessageType.FILE,e)},e.prototype.createAudioMessage=function(e){return this.validateModules(),this.messageBuilder.buildMessage(ef.MessageType.AUDIO,e)},e.prototype.createVideoMessage=function(e){return this.validateModules(),this.messageBuilder.buildMessage(ef.MessageType.VIDEO,e)},e.prototype.createCustomMessage=function(e){return this.validateModules(),this.messageBuilder.buildMessage(e.type,e)},e.prototype.sendMessage=function(e){var t=this;this["catch"]((function(){t.messageSender.send(e)}),e)},e.prototype.recallMessage=function(e){var t=this;this["catch"]((function(){t.histories.recallMessage(e)}),e)},e.prototype.deleteMessage=function(e){var t=this;this["catch"]((function(){t.histories.deleteMessage(e)}),e)},e.prototype.markGroupMessageAsRead=function(e){var t=this;this["catch"]((function(){return Fp(t,void 0,void 0,(function(){return Gp(this,(function(t){switch(t.label){case 0:return[4,this.histories.groupMarkAsRead(e)];case 1:return t.sent(),[2]}}))}))}),e)},e.prototype.markPrivateMessageAsRead=function(e){var t=this;this["catch"]((function(){return Fp(t,void 0,void 0,(function(){return Gp(this,(function(t){switch(t.label){case 0:return[4,this.histories.privateMarkAsRead(e)];case 1:return t.sent(),[2]}}))}))}),e)},e.prototype.markMessageAsRead=function(e,t){var n=this;this["catch"]((function(){return Fp(n,void 0,void 0,(function(){return Gp(this,(function(n){switch(n.label){case 0:return[4,this.histories.markMessageAsRead(e,t)];case 1:return n.sent(),[2]}}))}))}),e)},e.prototype.latestConversations=function(e){this.validateModules(),this.conversations.latestConversations(e)},e.prototype.removePrivateConversation=function(e){var t=this;this["catch"]((function(){return t.conversations.removePrivateConversation(e)}),e)},e.prototype.removeGroupConversation=function(e){var t=this;this["catch"]((function(){return t.conversations.removeGroupConversation(e)}),e)},e.prototype.topPrivateConversation=function(e){var t=this;this["catch"]((function(){return t.conversations.topPrivateConversation(e)}),e)},e.prototype.topGroupConversation=function(e){var t=this;this["catch"]((function(){return t.conversations.topGroupConversation(e)}),e)},e.prototype.history=function(e,t){var n=this;this["catch"]((function(){n.histories.loadHistory(e,t)}),e)},e.prototype.subscribeUserPresence=function(e){var t=this;this["catch"]((function(){return t._userPresenceSubscriber.presence(e)}),e)},e.prototype.unsubscribeUserPresence=function(e){var t=this;this["catch"]((function(){return t._userPresenceSubscriber.unPresence(e)}),e)},e.prototype.hereNow=function(e){var t=this;this["catch"]((function(){return t._userHereNow.hereNow(e)}),e)},e.prototype.subscribeGroup=function(e){var t=this;this["catch"]((function(){return t.groupMessageSubscriber.subscribe(e)}),e)},e.prototype.unsubscribeGroup=function(e){var t=this;this["catch"]((function(){return t.groupMessageSubscriber.unsubscribe(e)}),e)},e.prototype.subscribeGroupPresence=function(e){var t=this;this["catch"]((function(){return t._groupPresenceSubscriber.presence(e)}),e)},e.prototype.unsubscribeGroupPresence=function(e){var t=this;this["catch"]((function(){return t._groupPresenceSubscriber.unPresence(e)}),e)},e.prototype.groupHereNow=function(e){var t=this;this["catch"]((function(){return t._groupHereNow.hereNow(e)}),e)},e.prototype.groupOnlineCount=function(e){var t=this;this["catch"]((function(){return t._groupOnlineCount.get(e)}),e)},e.prototype.latestPendingConversations=function(e){this.validateModules(),this.conversations.latestPendingConversations(e)},e.prototype.topConversation=function(e){this.validateModules(),this.conversations.topConversation(e)},e.prototype.removeConversation=function(e){this.validateModules(),this.conversations.removeConversation(e)},e}();Jr.IM=rf;var sf={};(function(e){e.__esModule=!0,e.MediaType=void 0,function(e){e["VIDEO"]="VIDEO",e["VOICE"]="VOICE"}(e.MediaType||(e.MediaType={}))})(sf);var af={},cf={},uf={},lf={__esModule:!0,CSStatusQueryRequest:void 0},pf=function(){function e(e,t){this.customerId=e,this.teamId=t}return e}();lf.CSStatusQueryRequest=pf;var ff={__esModule:!0,CSAcceptRequest:void 0},df=function(){function e(e,t){this.customerId=e,this.teamId=t}return e}();ff.CSAcceptRequest=df;var hf={__esModule:!0,CSTransferRequest:void 0},yf=function(){function e(e,t,n){this.customerId=e,this.teamId=t,this.agentId=n}return e}();hf.CSTransferRequest=yf;var mf=e&&e.__awaiter||function(e,t,n,o){function r(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function s(e){try{c(o.next(e))}catch(Kf){i(Kf)}}function a(e){try{c(o["throw"](e))}catch(Kf){i(Kf)}}function c(e){e.done?n(e.value):r(e.value).then(s,a)}c((o=o.apply(e,t||[])).next())}))},vf=e&&e.__generator||function(e,t){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");while(s)try{if(n=1,o&&(r=2&i[0]?o["return"]:i[0]?o["throw"]||((r=o["return"])&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(r=s.trys,!(r=r.length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(Kf){i=[6,Kf],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};uf.__esModule=!0,uf.ConversationHandler=void 0;var gf=lf,bf=ff,Sf=Do,Ef=Un,_f=Mo,Cf=l,wf=yo,Mf=xr,Tf=Fo,If=hf,Af=gs,Of=ws,Nf=ea,kf=function(){function e(e){this.builder=new Nf.RemoteAbbrMessageBuilder,this.teamId=e}return e.prototype.accept=function(e,t){var n=this;Sf["default"].validateId(t.id,"id");var o=t.id,r=o.toString(),i=new bf.CSAcceptRequest(r,e),s=new Ef["default"]({name:_f.RocketTypes.CS_ACCEPT,params:i,permission:Cf.Permission.WRITE,singleTimeout:wf.SocketTimeout.commonRequestSingle,totalTimeout:wf.SocketTimeout.commonRequestTotal,fail:function(e){Mf.CallbackUtils.onFailed(t,e)},success:function(e){var o=n.builder.build(e.content.message);Af.GoEasyEventCenter.fire(Of.IM_INTERNAL_EVENTS.CS_ACCEPTED,o),Mf.CallbackUtils.onSuccess(t)}});Tf.G.s().emit(s)},e.prototype.end=function(e,t){var n=this;Sf["default"].validateId(t.id,"id");var o=t.id.toString(),r=new bf.CSAcceptRequest(o,e),i=new Ef["default"]({name:_f.RocketTypes.CS_END,params:r,permission:Cf.Permission.WRITE,singleTimeout:wf.SocketTimeout.commonRequestSingle,totalTimeout:wf.SocketTimeout.commonRequestTotal,fail:function(e){Mf.CallbackUtils.onFailed(t,e)},success:function(e){var o=n.builder.build(e.content.message);Af.GoEasyEventCenter.fire(Of.IM_INTERNAL_EVENTS.CS_ENDED,o),Mf.CallbackUtils.onSuccess(t)}});Tf.G.s().emit(i)},e.prototype.queryCustomerStatus=function(e,t){return mf(this,void 0,void 0,(function(){var n;return vf(this,(function(o){switch(o.label){case 0:return Sf["default"].validateId(t.id,"id"),[4,this.doCustomerStatus(e,t.id)];case 1:return n=o.sent(),this.activeCustomerStatus=n,this.activeCustomerStatusOptions=t,Mf.CallbackUtils.onSuccess(t,n),[2]}}))}))},e.prototype.doCustomerStatus=function(e,t){var n=t.toString(),o=new gf.CSStatusQueryRequest(n,e);return new Promise((function(e,t){var n=new Ef["default"]({name:_f.RocketTypes.CS_CUSTOMER_STATUS,params:o,permission:Cf.Permission.READ,singleTimeout:wf.SocketTimeout.commonQuerySingle,totalTimeout:wf.SocketTimeout.commonQueryTotal,fail:function(e){t(e)},success:function(t){var n=t.content;n.agent&&(n.agent.data=JSON.parse(n.agent.data)),e(n)}});Tf.G.s().emit(n)}))},e.prototype.transfer=function(e,t){var n=this;Sf["default"].validateId(t.customerId,"customerId"),Sf["default"].validateId(t.agentId,"agentId");var o=t.customerId.toString(),r=t.agentId.toString(),i=new If.CSTransferRequest(o,e,r),s=new Ef["default"]({name:_f.RocketTypes.CS_TRANSFER,params:i,permission:Cf.Permission.WRITE,singleTimeout:wf.SocketTimeout.commonRequestSingle,totalTimeout:wf.SocketTimeout.commonRequestTotal,fail:function(e){Mf.CallbackUtils.onFailed(t,e)},success:function(e){var o=n.builder.build(e.content.message);Af.GoEasyEventCenter.fire(Of.IM_INTERNAL_EVENTS.CS_TRANSFER,o),Mf.CallbackUtils.onSuccess(t)}});Tf.G.s().emit(s)},e}();uf.ConversationHandler=kf;var Rf={__esModule:!0,MessageCreator:void 0},Pf=s,xf=Jr,Df=function(){function e(){}return e.getInstance=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.createTextMessage=function(e,t){var n=xf.IM.instance.createTextMessage(t);this.extendProps(e,n)},e.prototype.createImageMessage=function(e,t){var n=xf.IM.instance.createImageMessage(t);this.extendProps(e,n)},e.prototype.createFileMessage=function(e,t){var n=xf.IM.instance.createFileMessage(t);this.extendProps(e,n)},e.prototype.createAudioMessage=function(e,t){var n=xf.IM.instance.createAudioMessage(t);this.extendProps(e,n)},e.prototype.createVideoMessage=function(e,t){var n=xf.IM.instance.createVideoMessage(t);this.extendProps(e,n)},e.prototype.createCustomMessage=function(e,t){var n=xf.IM.instance.createCustomMessage(t);this.extendProps(e,n)},e.prototype.extendProps=function(e,t){if(t.scene()===Pf.Scene.CS){var n=t;n.teamId=e,n.accepted=!0}},e}();Rf.MessageCreator=Df;var Ff=e&&e.__awaiter||function(e,t,n,o){function r(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function s(e){try{c(o.next(e))}catch(Kf){i(Kf)}}function a(e){try{c(o["throw"](e))}catch(Kf){i(Kf)}}function c(e){e.done?n(e.value):r(e.value).then(s,a)}c((o=o.apply(e,t||[])).next())}))},Gf=e&&e.__generator||function(e,t){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");while(s)try{if(n=1,o&&(r=2&i[0]?o["return"]:i[0]?o["throw"]||((r=o["return"])&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(r=s.trys,!(r=r.length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(Kf){i=[6,Kf],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};cf.__esModule=!0,cf.Team=void 0;var Uf=Do,Lf=xr,jf=Jr,Bf=uf,qf=Za,Vf=Rf,Hf=Xa,Wf=function(){function e(e){this.teamId=e,this.agentStatus=qf.AgentStatus.getInstance(),this.conversationHandler=new Bf.ConversationHandler(e),this.messageCreator=Vf.MessageCreator.getInstance()}return e.prototype["catch"]=function(e,t){return Ff(this,void 0,void 0,(function(){var n;return Gf(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),Uf["default"].validateCallbackOptions(t),[4,e()];case 1:return o.sent(),[3,3];case 2:return n=o.sent(),Lf.CallbackUtils.onFailed(t,n),[3,3];case 3:return[2]}}))}))},e.prototype.isOnline=function(e){var t=this;this["catch"]((function(){t.agentStatus.isOnline(t.teamId,e)}),e)},e.prototype.online=function(e){var t=this;this["catch"]((function(){t.agentStatus.online(t.teamId,e)}),e)},e.prototype.offline=function(e){var t=this;this["catch"]((function(){t.agentStatus.offline(t.teamId,e)}),e)},e.prototype.customerStatus=function(e){var t=this;this["catch"]((function(){t.conversationHandler.queryCustomerStatus(t.teamId,e)}),e)},e.prototype.accept=function(e){var t=this;this["catch"]((function(){t.conversationHandler.accept(t.teamId,e)}),e)},e.prototype.end=function(e){var t=this;this["catch"]((function(){t.conversationHandler.end(t.teamId,e)}),e)},e.prototype.history=function(e){jf.IM.instance.history(e,this.teamId)},e.prototype.markMessageAsRead=function(e){jf.IM.instance.markMessageAsRead(e,this.teamId)},e.prototype.createTextMessage=function(e){this.messageCreator.createTextMessage(this.teamId,e)},e.prototype.createImageMessage=function(e){this.messageCreator.createImageMessage(this.teamId,e)},e.prototype.createFileMessage=function(e){this.messageCreator.createFileMessage(this.teamId,e)},e.prototype.createAudioMessage=function(e){this.messageCreator.createAudioMessage(this.teamId,e)},e.prototype.createVideoMessage=function(e){this.messageCreator.createVideoMessage(this.teamId,e)},e.prototype.createCustomMessage=function(e){this.messageCreator.createCustomMessage(this.teamId,e)},e.prototype.transfer=function(e){var t=this;this["catch"]((function(){t.conversationHandler.transfer(t.teamId,e)}),e)},e.prototype.agents=function(e){var t=this;this["catch"]((function(){t.agentStatus.agents(t.teamId,e)}),e)},e.prototype.liveSession=function(e){var t=this;this["catch"]((function(){Hf.LiveSession.live(t.teamId,e)}),e)},e.prototype.quitLiveSession=function(e){this["catch"]((function(){Hf.LiveSession.quit(e)}),e)},e}();cf.Team=Wf,af.__esModule=!0,af.CS=void 0;var zf=cf,Jf=Do,Xf=function(){function e(){}return e.team=function(e){Jf["default"].validateId(e,"teamId");var t=this.teams.get(e);return t||(t=new zf.Team(e.toString()),this.teams.set(e.toString(),t)),t},e.teams=new Map,e}();af.CS=Xf,function(t){var n=e&&e.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();t.__esModule=!0,t.CSTeam=t.GoEasyIM=t.GoEasyPubSub=t.CustomerStatusOptions=t.User=t.AgentOnlineOptions=t.ConversationDTO=t.MessageStatus=t.Scene=t.CallBackOptions=void 0;var o,r=a,i=c,s=Fn,u=Ro,l=Po,p=Jr,f=To,d=Yr,h=gs,y=sf,m=af,v=Fo,g="2.5.2-1",b=function(){function e(){}return e}();t.CallBackOptions=b,function(e){e["PRIVATE"]="private",e["GROUP"]="group",e["SYSTEM"]="system",e["CS"]="cs"}(o=t.Scene||(t.Scene={})),function(e){e["NEW"]="new",e["SENDING"]="sending",e["SUCCESS"]="success",e["FAIL"]="fail"}(t.MessageStatus||(t.MessageStatus={}));var S=function(){function e(){}return e}();t.ConversationDTO=S;var E=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t}(b);t.AgentOnlineOptions=E;var _=function(){function e(e,t){this.id=e,this.data=t}return e}();t.User=_;var C=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t}(b);t.CustomerStatusOptions=C;var w=function(){function e(e){l.PubSub.init(e)}return e.prototype.initialGoEasySocket=function(){l.PubSub.instance.initialGoEasySocket()},e.prototype.initialBeforeConnect=function(){l.PubSub.instance.initialBeforeConnect()},e.prototype.publish=function(e){l.PubSub.instance.publisher.publish(e)},e.prototype.subscribe=function(e){l.PubSub.instance.subscriber.subscribe(e)},e.prototype.unsubscribe=function(e){l.PubSub.instance.subscriber.unsubscribe(e)},e.prototype.subscribePresence=function(e){l.PubSub.instance.presence.subscribePresence(e)},e.prototype.unsubscribePresence=function(e){l.PubSub.instance.presence.unsubscribePresence(e)},e.prototype.history=function(e){l.PubSub.instance.histories.get(e)},e.prototype.hereNow=function(e){l.PubSub.instance.hereNows.byChannel(e)},e.prototype.hereNowByUserIds=function(e){l.PubSub.instance.hereNows.byUserId(e)},e}();t.GoEasyPubSub=w;var M=function(){function e(e){p.IM.init(e)}return e.prototype.afterConnect=function(){p.IM.instance.afterConnect()},e.prototype.on=function(e,t){p.IM.instance.on(e,t)},e.prototype.off=function(e,t){p.IM.instance.off(e,t)},e.prototype.createTextMessage=function(e){return p.IM.instance.createTextMessage(e)},e.prototype.createImageMessage=function(e){return p.IM.instance.createImageMessage(e)},e.prototype.createFileMessage=function(e){return p.IM.instance.createFileMessage(e)},e.prototype.createAudioMessage=function(e){return p.IM.instance.createAudioMessage(e)},e.prototype.createVideoMessage=function(e){return p.IM.instance.createVideoMessage(e)},e.prototype.createCustomMessage=function(e){return p.IM.instance.createCustomMessage(e)},e.prototype.sendMessage=function(e){p.IM.instance.sendMessage(e)},e.prototype.recallMessage=function(e){p.IM.instance.recallMessage(e)},e.prototype.deleteMessage=function(e){p.IM.instance.deleteMessage(e)},e.prototype.markGroupMessageAsRead=function(e){p.IM.instance.markGroupMessageAsRead(e)},e.prototype.markPrivateMessageAsRead=function(e){p.IM.instance.markPrivateMessageAsRead(e)},e.prototype.latestConversations=function(e){p.IM.instance.latestConversations(e)},e.prototype.removePrivateConversation=function(e){p.IM.instance.removePrivateConversation(e)},e.prototype.removeGroupConversation=function(e){p.IM.instance.removeGroupConversation(e)},e.prototype.topPrivateConversation=function(e){p.IM.instance.topPrivateConversation(e)},e.prototype.topGroupConversation=function(e){p.IM.instance.topGroupConversation(e)},e.prototype.history=function(e){p.IM.instance.history(e)},e.prototype.subscribeUserPresence=function(e){p.IM.instance.subscribeUserPresence(e)},e.prototype.unsubscribeUserPresence=function(e){p.IM.instance.unsubscribeUserPresence(e)},e.prototype.hereNow=function(e){p.IM.instance.hereNow(e)},e.prototype.subscribeGroup=function(e){p.IM.instance.subscribeGroup(e)},e.prototype.unsubscribeGroup=function(e){p.IM.instance.unsubscribeGroup(e)},e.prototype.subscribeGroupPresence=function(e){p.IM.instance.subscribeGroupPresence(e)},e.prototype.unsubscribeGroupPresence=function(e){p.IM.instance.unsubscribeGroupPresence(e)},e.prototype.groupHereNow=function(e){p.IM.instance.groupHereNow(e)},e.prototype.groupOnlineCount=function(e){p.IM.instance.groupOnlineCount(e)},e.prototype.markMessageAsRead=function(e){p.IM.instance.markMessageAsRead(e)},e.prototype.csteam=function(e){return new I(e)},e.prototype.pendingConversations=function(e){p.IM.instance.latestPendingConversations(e)},e.prototype.topConversation=function(e){p.IM.instance.topConversation(e)},e.prototype.removeConversation=function(e){p.IM.instance.removeConversation(e)},e}();t.GoEasyIM=M;var T=function(){function e(t){if(s["default"].isDef(e.instance)&&e.instance.getConnectionStatus()!==r.NetworkStatus.DISCONNECTED)return e.instance;this.validateOptions(t),this.options=t,f.GNS.init(t.allowNotification),this.pubsub=new w(this.options),this.im=new M(this.options)}return e.getInstance=function(t){return s["default"].isUndef(e.instance)&&(e.instance=new e(t)),e.instance},e.prototype.connect=function(e){this.getConnectionStatus()!==r.NetworkStatus.DISCONNECTED&&s["default"].isObject(e)&&s["default"].isFunction(e.onFailed)?e.onFailed({code:408,content:"It is already connected, don't try again until disconnect() is called. "}):(this.confirmUserId(e),h.GoEasyEventCenter.initial(),this.pubsub.initialBeforeConnect(),this.goEasySocket=new i["default"](this.options,e),this.goEasySocket.connect(),v.G.i(this.goEasySocket),this.im.afterConnect(),this.pubsub.initialGoEasySocket())},e.prototype.disconnect=function(e){this.goEasySocket.disconnect().then((function(){s["default"].isObject(e)&&s["default"].isFunction(e.onSuccess)&&e.onSuccess()}))["catch"]((function(t){s["default"].isObject(e)&&s["default"].isFunction(e.onFailed)&&e.onFailed(t)}))},e.prototype.getConnectionStatus=function(){return this.goEasySocket?this.goEasySocket.getStatus():r.NetworkStatus.DISCONNECTED},e.prototype.validateOptions=function(e){var t="";if(!s["default"].isObject(e))throw t="options is require an object.",Error(t);if(!s["default"].isPrimitive(e.appkey)||0==e.appkey.length)throw t="Invalid options:'appkey' is empty.",Error(t);if(!s["default"].isPrimitive(e.host)||0==e.host.length)throw t="Invalid options:'host' is empty.",Error(t);if(!s["default"].isArray(e.modules))throw t="Invalid options: 'modules' must be nonempty array",Error(t);var n=[u.ModuleTypes.IM,u.ModuleTypes.PUBSUB],o=e.modules.map((function(e){var o=e.toUpperCase();if(!n.includes(o))throw t="Invalid options: module '".concat(e,"' is not support"),Error(t);return o}));e.modules=o},e.prototype.onClickNotification=function(e){f.GNS.instance.onClickNotification(e)},e.prototype.confirmUserId=function(e){if(this.options.modules.includes(u.ModuleTypes.IM)&&(s["default"].isEmpty(e.id)||!s["default"].isStringOrNumber(e.id)))throw{code:400,content:"TypeError: id requires number or string."};if("string"===typeof e.id&&e.id.length>60)throw{code:400,content:"id over max length 60"}},e.version=g,e.IM_EVENT=d.ImApiEvents,e.IM_SCENE=o,e.MEDIA_TYPE=y.MediaType,e}();t["default"]=T;var I=function(){function e(e){this.id=e}return e.prototype.isOnline=function(e){m.CS.team(this.id).isOnline(e)},e.prototype.online=function(e){m.CS.team(this.id).online(e)},e.prototype.offline=function(e){m.CS.team(this.id).offline(e)},e.prototype.customerStatus=function(e){m.CS.team(this.id).customerStatus(e)},e.prototype.accept=function(e){m.CS.team(this.id).accept(e)},e.prototype.end=function(e){m.CS.team(this.id).end(e)},e.prototype.history=function(e){m.CS.team(this.id).history(e)},e.prototype.markMessageAsRead=function(e){m.CS.team(this.id).markMessageAsRead(e)},e.prototype.createTextMessage=function(e){m.CS.team(this.id).createTextMessage(e)},e.prototype.createImageMessage=function(e){m.CS.team(this.id).createImageMessage(e)},e.prototype.createFileMessage=function(e){m.CS.team(this.id).createFileMessage(e)},e.prototype.createAudioMessage=function(e){m.CS.team(this.id).createAudioMessage(e)},e.prototype.createVideoMessage=function(e){m.CS.team(this.id).createVideoMessage(e)},e.prototype.createCustomMessage=function(e){m.CS.team(this.id).createCustomMessage(e)},e.prototype.transfer=function(e){m.CS.team(this.id).transfer(e)},e.prototype.agents=function(e){m.CS.team(this.id).agents(e)},e.prototype.liveSession=function(e){m.CS.team(this.id).liveSession(e)},e.prototype.quitLiveSession=function(e){m.CS.team(this.id).quitLiveSession(e)},e}();t.CSTeam=I}(s);var Yf=i(s);return Yf}))}).call(this,n("c8ba"),n("4362"),n("b639").Buffer)}});
//# sourceMappingURL=app.fdce4270.js.map