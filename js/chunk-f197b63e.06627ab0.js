(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-f197b63e"],{"4d5e":function(e,t,n){"use strict";n("ca8c")},"53c6":function(e,t,n){e.exports=n.p+"img/logo.897bbe5b.png"},"6e4d":function(e,t,n){"use strict";n.d(t,"c",(function(){return h})),n.d(t,"d",(function(){return f})),n.d(t,"b",(function(){return p})),n.d(t,"f",(function(){return v})),n.d(t,"a",(function(){return C})),n.d(t,"e",(function(){return E}));class o{getAccessToken(){let e=Object({NODE_ENV:"production",BASE_URL:"/"}).VUE_APP_ENV,t=this.getCookie("goeasy.token."+e);return t}getRefreshToken(){let e=Object({NODE_ENV:"production",BASE_URL:"/"}).VUE_APP_ENV,t=this.getCookie("goeasy.refreshToken."+e);return t}storeTokens(e,t,n){let o=Object({NODE_ENV:"production",BASE_URL:"/"}).VUE_APP_ENV;this.setCookie("goeasy.token."+o,e),this.setCookie("goeasy.refreshToken."+o,t),this.setCookie("goeasy.token.expiresAtMillis."+o,n+"")}setCookie(e,t){console.log("will set "+e+"with value: "+t),document.cookie=e+"="+escape(t)+";domain=goeasy.io"}getCookie(e){let t,n=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return(t=document.cookie.match(n))?unescape(t[2]):null}}var s=new o,a=n("bc3a"),i=n.n(a);const r=Object({NODE_ENV:"production",BASE_URL:"/"}).VUE_APP_ENV;function c(){let e;e=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHttp");let t=`https://${r}sso.goeasy.io`,n=s.getCookie("goeasy.token.expiresAtMillis."+r),o=(new Date).getTime();if(e&&n-o<36e5){let n=s.getRefreshToken();e.open("post",t+"/refreshtoken",!0),e.setRequestHeader("content-type","application/x-www-form-urlencoded"),e.send("refreshToken="+n),e.onreadystatechange=function(){if(4===e.readyState&&200===e.status){let t=JSON.parse(e.responseText),n=t.token,o=t.refreshToken,a=t.expiresAtMillis;s.storeTokens(n,o,a)}}}}const l=i.a.create({baseURL:"",timeout:6e4});l.interceptors.request.use(e=>{c();const t=s.getAccessToken();return t&&(e.headers["Authorization"]="Bearer "+t),e},e=>Promise.reject(e)),l.interceptors.response.use(e=>e.data,e=>Promise.reject(e));var u=l;let d=Object({NODE_ENV:"production",BASE_URL:"/"}).VUE_APP_ENV;const m=`https://${d}center.goeasy.io/api/v1`,g=`https://${d}center.goeasy.io/api/v2/cs-agent`;function h(){let e=g+"/otp";return u({url:e,method:"POST"})}function f(){let e=m+"/admin/currentuser";return u({url:e,method:"GET"})}function p(e){let t=g+"/contacts";return u({url:t,data:{search:e},method:"POST"})}function v(e,t){let n=`${g}/contacts/${e}/mark`;return u({url:n,data:{mark:t},method:"POST"})}function C(e){let t=`${g}/contacts/${e}`;return u({url:t,method:"GET"})}function E(e){let t=`${g}/contacts/${e.openId}/mobile-number`;return u({url:t,data:{mobileNumber:e.mobileNumber},method:"POST"})}},b548:function(e,t,n){"use strict";n.r(t);var o=function(){var e=this,t=e._self._c;return t("div",{staticClass:"home"},[t("div",{staticClass:"home-container"},[t("div",{staticClass:"home-menu"},[t("div",{staticClass:"menu-header"},[e.goeasyTeam.data.avatar?t("img",{staticClass:"shop-avatar",attrs:{src:e.goeasyTeam.data.avatar}}):t("img",{staticClass:"shop-avatar",attrs:{src:n("53c6")}}),t("div",{staticClass:"team-info"},[e._v(" "+e._s(e.goeasyTeam.data.name)+" ")])]),t("div",{staticClass:"menu-box"},[t("div",{staticClass:"menu-list"},[t("div",{staticClass:"menu-item"},[t("router-link",{attrs:{tag:"span",to:"/agent/conversations"}},[t("i",{staticClass:"iconfont icon-zaixiankefu",class:{selected:"conversations"===e.selectedTab}})]),e.unreadAmount+e.pendingConversationAmount?t("span",{staticClass:"menu-unread"},[e._v(e._s(e.unreadAmount+e.pendingConversationAmount))]):e._e()],1),t("div",{staticClass:"menu-item"},[t("router-link",{attrs:{tag:"span",to:"/agent/customers"}},[t("i",{staticClass:"iconfont icon-haoyou",class:{selected:"customers"===e.selectedTab}})])],1)]),e.currentAgent?t("div",{staticClass:"agent-info"},[t("img",{staticClass:"agent-avatar",attrs:{src:e.currentAgent.avatar},on:{click:function(t){e.onlineConfig.visible=!e.onlineConfig.visible}}}),t("span",{class:e.onlineConfig.online?"spot online":"spot offline"}),t("div",{staticClass:"agent-name"},[e._v(e._s(e.currentAgent.name))])]):e._e(),e.onlineConfig.visible?t("div",{staticClass:"action-wrap",on:{click:function(t){return t.preventDefault(),e.closeOnlinePopup()}}},[e.onlineConfig.visible?t("div",{staticClass:"action-box"},[e.onlineConfig.online?t("div",{staticClass:"action-item",on:{click:e.offline}},[e._v("下线")]):t("div",{staticClass:"action-item",on:{click:e.online}},[e._v("上线")])]):e._e()]):e._e()])]),t("div",{staticClass:"home-main"},[t("router-view")],1)])])},s=[],a=(n("f90e"),n("6e4d")),i={name:"Home",data(){return{goeasyTeam:{id:"goeasy-customer-support",data:{name:"GoEasy Support Team",avatar:""}},csteam:null,currentAgent:null,selectedTab:"",unreadAmount:0,pendingConversationAmount:0,onlineConfig:{visible:!1,online:!1}}},async created(){let e=await Object(a["d"])();this.global.currentAgent={id:e.data.userguid,name:e.data.name,avatar:e.data.avatar,teamId:this.goeasyTeam.id},this.currentAgent=this.global.currentAgent,"disconnected"===this.goEasy.getConnectionStatus()&&(await this.connectGoEasy(),this.$router.push({path:"/agent/conversations"})),this.csteam=this.goEasy.im.csteam(this.goeasyTeam.id),this.initialOnlineStatus(),this.goEasy.im.on(this.GoEasy.IM_EVENT.CONVERSATIONS_UPDATED,this.setUnreadAmount),this.goEasy.im.on(this.GoEasy.IM_EVENT.PENDING_CONVERSATIONS_UPDATED,this.setPendingConversationAmount)},watch:{$route:{handler(){let e=this.$route.path,t=e.split("/");this.selectedTab=t[2]},immediate:!0}},methods:{async connectGoEasy(){let e=await Object(a["c"])();return new Promise((t,n)=>{this.goEasy.connect({id:this.currentAgent.id,data:{name:this.currentAgent.name,avatar:this.currentAgent.avatar},otp:e.data,onSuccess:()=>{console.log("GoEasy connect successfully."),t()},onFailed:e=>{console.log("Failed to connect GoEasy, code:"+e.code+",error:"+e.content),n(e)},onProgress:e=>{console.log("GoEasy is connecting",e)}})})},setUnreadAmount(e){this.unreadAmount=e.unreadTotal},setPendingConversationAmount(e){this.pendingConversationAmount=e.conversations.length},initialOnlineStatus(){this.csteam.isOnline({onSuccess:e=>{this.onlineConfig.online=e.content},onFailed:e=>{console.log("获取在线状态失败，error:",e)}})},offline(){this.csteam.offline({onSuccess:()=>{this.onlineConfig.online=!1,this.onlineConfig.visible=!1},onFailed:e=>{console.log("下线失败,error:",e)}})},online(){this.csteam.online({teamData:{name:this.goeasyTeam.name,avatar:this.goeasyTeam.avatar},agentData:{name:this.currentAgent.name,avatar:this.currentAgent.avatar},onSuccess:()=>{this.onlineConfig.online=!0},onFailed:e=>{console.log("上线失败,error:",e)}})},closeOnlinePopup(){this.onlineConfig.visible=!1}}},r=i,c=(n("4d5e"),n("2877")),l=Object(c["a"])(r,o,s,!1,null,"22a12456",null);t["default"]=l.exports},ca8c:function(e,t,n){},f90e:function(e,t,n){}}]);
//# sourceMappingURL=chunk-f197b63e.06627ab0.js.map