{"version":3,"sources":["webpack:///./src/agent/view/Chat.vue?f38a","webpack:///./src/agent/lib/EmojiDecoder.js","webpack:///./src/agent/components/GoEasyAudioPlayer.vue?9f9a","webpack:///src/agent/components/GoEasyAudioPlayer.vue","webpack:///./src/agent/components/GoEasyAudioPlayer.vue?592c","webpack:///./src/agent/components/GoEasyAudioPlayer.vue","webpack:///src/agent/view/Chat.vue","webpack:///./src/agent/view/Chat.vue?7a48","webpack:///./src/agent/view/Chat.vue","webpack:///./src/agent/components/GoEasyAudioPlayer.vue?1d44","webpack:///./src/agent/images/default.png","webpack:///./src/agent/lib/utils.js","webpack:///./src/agent/view/Chat.vue?7635","webpack:///./src/agent/api/utils.js","webpack:///./src/agent/api/index.js","webpack:///./src/agent/api/api.js","webpack:///./src/agent/images/pending.gif"],"names":["render","_vm","this","_c","_self","staticClass","customer","attrs","avatar","_v","_s","renderCustomerName","_e","ref","history","on","$event","loadHistoryMessage","allLoaded","_l","message","index","key","renderMessageDate","type","senderData","name","senderId","currentAgent","id","payload","transferTo","data","class","self","status","domProps","renderTextMessage","text","showImage","url","style","height","getImageHeight","width","duration","showVideo","video","thumbnail","sales","price","customerStatus","pendingTime","acceptSession","agent","emoji","emojiItem","emojiKey","chooseEmoji","showEmojiBox","_m","directives","rawName","value","expression","sendImageMessage","sendVideoMessage","showTransferForm","endSession","target","composing","sendTextMessage","imagePopup","hideImagePreviewPopup","transferForm","agents","_q","to","$set","transfer","hideTransferForm","staticRenderFns","EmojiDecoder","emojiMap","patterns","metaChars","i","hasOwnProperty","push","replace","prototype","decode","RegExp","join","match","play","Math","ceil","playing","onEnd","props","methods","$refs","audioPlayer","src","load","currentTime","component","IMAGE_MAX_WIDTH","IMAGE_MAX_HEIGHT","components","GoEasyAudioPlayer","emojiUrl","csteam","messages","loading","map","visible","decoder","timer","openId","$route","query","nickname","unionId","unionid","appName","mark","mobileNumber","GoEasy","IM_SCENE","CS","global","goEasy","im","teamId","liveSession","quitLiveSession","onSuccess","console","log","onFailed","error","indexOf","customerId","markMessageAsRead","onStatusUpdated","updatePendingTime","start","onNewMessage","onReceivedMessage","time","clearInterval","setInterval","newMessage","findIndex","messageId","scrollToBottom","lastMessageTimeStamp","lastMessage","timestamp","limit","lastTimestamp","result","content","length","concat","code","callParentFunction","functionName","parameters","targetOrigin","document","referrer","window","parent","postMessage","Promise","resolve","reject","isOnline","accept","alert","end","filter","agentId","trim","createTextMessage","sendMessage","err","e","fileList","files","forEach","file","createImageMessage","onProgress","progress","createVideoMessage","$nextTick","bottomView","scrollIntoView","module","exports","formatDate","t","Date","now","str","getMonth","getDate","getHours","getMinutes","formateTime","second","minute","hour","day","getTime","diffValue","secondC","minC","hourC","dayC","parseInt","Utils","env","VUE_APP_ENV","accessToken","getCookie","refreshToken","token","expiresAtMillis","setCookie","cookie","escape","arr","reg","unescape","checkAndRefreshToken","xhr","XMLHttpRequest","ActiveXObject","expiresAt","utils","getRefreshToken","open","setRequestHeader","send","onreadystatechange","readyState","JSON","parse","responseText","newToken","newRefreshToken","storeTokens","http","a","create","baseURL","timeout","interceptors","request","use","config","getAccessToken","headers","response","center","agentBaseUrl","getOTP","method","getWorkerInfo","getContacts","search","updateUserMark","getContact","updateMobileNumber","params"],"mappings":"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","file":"js/chunk-2265b2f0.aa254f69.js","sourcesContent":["var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{staticClass:\"chat-container\"},[(_vm.customer)?_c('div',{staticClass:\"chat-title\"},[(_vm.customer.avatar)?_c('img',{staticClass:\"chat-avatar\",attrs:{\"src\":_vm.customer.avatar}}):_c('img',{staticClass:\"chat-avatar\",attrs:{\"src\":require(\"../images/default.png\")}}),_c('div',{staticClass:\"chat-name\"},[_vm._v(_vm._s(_vm.renderCustomerName(_vm.customer)))])]):_vm._e(),_c('div',{ref:\"scrollView\",staticClass:\"chat-main\"},[_c('div',{ref:\"messageList\",staticClass:\"message-list\"},[(_vm.history.loading)?_c('div',{staticClass:\"history-loading\"},[_c('img',{attrs:{\"src\":require(\"../images/pending.gif\")}})]):_c('div',{staticClass:\"history-loaded\",on:{\"click\":function($event){return _vm.loadHistoryMessage(false)}}},[_vm._v(\" \"+_vm._s(_vm.history.allLoaded ? '已经没有更多的历史消息' : '获取历史消息')+\" \")]),_vm._l((_vm.history.messages),function(message,index){return _c('div',{key:index},[_c('div',{staticClass:\"time-tips\"},[_vm._v(\" \"+_vm._s(_vm.renderMessageDate(message, index))+\" \")]),_c('div',{staticClass:\"message-item\"},[(message.type === 'CS_ACCEPT')?_c('div',{staticClass:\"accept-message\"},[_vm._v(\" \"+_vm._s(message.senderData.name)+\"已接入 \")]):(message.type === 'CS_END')?_c('div',{staticClass:\"accept-message\"},[_vm._v(\" \"+_vm._s(message.senderData.name)+\"已结束会话 \")]):(message.type === 'CS_TRANSFER')?_c('div',{staticClass:\"accept-message\"},[_vm._v(\" \"+_vm._s(message.senderId === _vm.currentAgent.id ? `已转接给` + message.payload.transferTo.data.name : '已接入来自' + message.senderData.name + '的转接')+\" \")]):_c('div',{staticClass:\"message-item-content\",class:{ self: message.senderId !== _vm.customer.id }},[_c('div',{staticClass:\"sender-info\"},[_c('img',{staticClass:\"sender-avatar\",attrs:{\"src\":message.senderData.avatar}}),_c('div',{staticClass:\"sender-name\"},[_vm._v(\" \"+_vm._s(message.senderData.name)+\" \")])]),_c('div',{staticClass:\"message-content\"},[_c('div',{staticClass:\"message-payload\"},[(message.status === 'sending')?_c('div',{staticClass:\"pending\"}):_vm._e(),(message.status === 'fail')?_c('div',{staticClass:\"send-fail\"}):_vm._e(),(message.type === 'text')?_c('div',{staticClass:\"content-text\",domProps:{\"innerHTML\":_vm._s(_vm.renderTextMessage(message.payload.text))}}):_vm._e(),(message.type === 'image')?_c('div',{staticClass:\"content-image\",on:{\"click\":function($event){return _vm.showImage(message.payload.url)}}},[_c('img',{style:({height:_vm.getImageHeight(message.payload.width,message.payload.height)+'px'}),attrs:{\"src\":message.payload.url}})]):_vm._e(),(message.type ==='audio')?_c('goeasy-audio-player',{attrs:{\"duration\":message.payload.duration,\"src\":message.payload.url}}):_vm._e(),(message.type === 'video')?_c('div',{staticClass:\"content-video\",on:{\"click\":function($event){return _vm.showVideo(message.payload.video.url)}}},[_c('img',{style:({height:_vm.getImageHeight(message.payload.thumbnail.width,message.payload.thumbnail.height)+'px'}),attrs:{\"src\":message.payload.thumbnail.url}}),_c('div',{staticClass:\"icon\"})]):_vm._e(),(message.type === 'order')?_c('div',{staticClass:\"content-order\"},[_c('div',{staticClass:\"order-description\"},[_vm._v(\"发送订单：\")]),_c('div',{staticClass:\"order-content\"},[_c('img',{attrs:{\"src\":message.payload.url}}),_c('div',{staticClass:\"order-info\"},[_c('div',{staticClass:\"order-name\"},[_vm._v(_vm._s(message.payload.name))]),_c('div',[_vm._v(\"月销\"+_vm._s(message.payload.sales))]),_c('div',[_vm._v(_vm._s(message.payload.price))])])])]):_vm._e()],1)])])])])})],2),_c('span',{ref:\"bottomView\"})]),_c('div',{staticClass:\"chat-footer\"},[(_vm.customerStatus==null)?_c('div',{staticClass:\"accept-session\"},[_c('div',[_vm._v(\"离线中\")])]):(_vm.customerStatus.status==='PENDING')?_c('div',{staticClass:\"accept-session\"},[_c('div',{staticClass:\"accept-info\"},[_vm._v(\" 会话已等待\"+_vm._s(_vm.pendingTime.duration)+\" \")]),_c('button',{staticClass:\"accept-btn\",on:{\"click\":_vm.acceptSession}},[_vm._v(\"立即接入\")])]):(_vm.customerStatus.status==='ACCEPTED' && _vm.currentAgent.id !== _vm.customerStatus.agent.id)?_c('div',{staticClass:\"accept-session\"},[_c('div',{staticClass:\"accept-info\"},[_vm._v(_vm._s(_vm.customerStatus.agent.data.name)+\"已接入\")])]):(_vm.customerStatus.status==='FREE')?_c('div',{staticClass:\"accept-session\"},[_c('button',{staticClass:\"accept-btn\",on:{\"click\":_vm.acceptSession}},[_vm._v(\"主动接入\")])]):_c('div',{staticClass:\"action-box\"},[_c('div',{staticClass:\"action-bar\"},[_c('div',{staticClass:\"chat-action\"},[_c('div',{staticClass:\"action-item\"},[(_vm.emoji.visible)?_c('div',{staticClass:\"emoji-box\"},_vm._l((_vm.emoji.map),function(emojiItem,emojiKey,index){return _c('img',{key:index,staticClass:\"emoji-item\",attrs:{\"src\":_vm.emoji.url + emojiItem},on:{\"click\":function($event){return _vm.chooseEmoji(emojiKey)}}})}),0):_vm._e(),_c('i',{staticClass:\"iconfont icon-smile\",attrs:{\"title\":\"表情\"},on:{\"click\":_vm.showEmojiBox}})]),_c('div',{staticClass:\"action-item\"},[_vm._m(0),_c('input',{directives:[{name:\"show\",rawName:\"v-show\",value:(false),expression:\"false\"}],attrs:{\"id\":\"img-input\",\"accept\":\"image/*\",\"multiple\":\"\",\"type\":\"file\"},on:{\"change\":_vm.sendImageMessage}})]),_c('div',{staticClass:\"action-item\"},[_vm._m(1),_c('input',{directives:[{name:\"show\",rawName:\"v-show\",value:(false),expression:\"false\"}],attrs:{\"id\":\"video-input\",\"accept\":\"video/*\",\"type\":\"file\"},on:{\"change\":_vm.sendVideoMessage}})])]),_c('div',{staticClass:\"session-action\"},[_c('span',{staticClass:\"transfer\",on:{\"click\":function($event){return _vm.showTransferForm()}}},[_vm._v(\"转接\")]),_c('i',{staticClass:\"iconfont icon-end_chat\",attrs:{\"title\":\"结束会话\"},on:{\"click\":_vm.endSession}})])]),_c('div',{staticClass:\"input-box\"},[_c('textarea',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.text),expression:\"text\"}],ref:\"input\",staticClass:\"input-content\",attrs:{\"autocomplete\":\"off\"},domProps:{\"value\":(_vm.text)},on:{\"input\":function($event){if($event.target.composing)return;_vm.text=$event.target.value}}})]),_c('div',{staticClass:\"send-box\"},[_c('button',{staticClass:\"send-button\",on:{\"click\":_vm.sendTextMessage}},[_vm._v(\"发送\")])])])]),(_vm.imagePopup.visible)?_c('div',{staticClass:\"image-preview\"},[_c('img',{attrs:{\"src\":_vm.imagePopup.url,\"alt\":\"图片\"}}),_c('span',{staticClass:\"close\",on:{\"click\":_vm.hideImagePreviewPopup}},[_vm._v(\"x\")])]):_vm._e(),(_vm.transferForm.visible)?_c('div',{staticClass:\"transfer-popup\"},[_c('div',{staticClass:\"transfer-model\"},[(_vm.transferForm.agents.length)?_c('div',{staticClass:\"transfer-content\"},_vm._l((_vm.transferForm.agents),function(agent,index){return _c('div',{staticClass:\"agent-info\"},[_c('label',{staticClass:\"agent-label\"},[_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.transferForm.to),expression:\"transferForm.to\"}],attrs:{\"name\":agent.data.name,\"type\":\"radio\"},domProps:{\"value\":agent,\"checked\":_vm._q(_vm.transferForm.to,agent)},on:{\"change\":function($event){return _vm.$set(_vm.transferForm, \"to\", agent)}}}),_c('img',{staticClass:\"agent-avatar\",attrs:{\"src\":agent.data.avatar}}),_c('span',{staticClass:\"agent-name\"},[_vm._v(_vm._s(agent.data.name))])])])}),0):_c('div',{staticClass:\"transfer-content\"},[_c('div',{staticClass:\"no-agent\"},[_vm._v(\"-当前无其他客服在线-\")])]),_c('div',{staticClass:\"transfer-bottom\"},[(_vm.transferForm.agents.length)?_c('span',{staticClass:\"transfer-button\",on:{\"click\":function($event){return _vm.transfer()}}},[_vm._v(\"确认\")]):_vm._e(),_c('span',{staticClass:\"transfer-button\",on:{\"click\":function($event){return _vm.hideTransferForm()}}},[_vm._v(\"取消\")])])])]):_vm._e()])\n}\nvar staticRenderFns = [function (){var _vm=this,_c=_vm._self._c;return _c('label',{attrs:{\"for\":\"img-input\"}},[_c('i',{staticClass:\"iconfont icon-picture\",attrs:{\"title\":\"图片\"}})])\n},function (){var _vm=this,_c=_vm._self._c;return _c('label',{attrs:{\"for\":\"video-input\"}},[_c('i',{staticClass:\"iconfont icon-film\",attrs:{\"title\":\"视频\"}})])\n}]\n\nexport { render, staticRenderFns }","function EmojiDecoder(url, emojiMap) {\n    this.url = url;\n    this.patterns = [];\n    this.emojiMap = emojiMap;\n    this.metaChars = /[[\\]{}()*+?.\\\\|^$\\-,&#\\s]/g;\n\n    for (let i in this.emojiMap) {\n        if (this.emojiMap.hasOwnProperty(i)) {\n            this.patterns.push('(' + i.replace(this.metaChars, \"\\\\$&\") + ')');\n        }\n    }\n}\n\nEmojiDecoder.prototype.decode = function (text) {\n    return text.replace(new RegExp(this.patterns.join('|'), 'g'), (match) => {\n        return typeof this.emojiMap[match] != 'undefined' ? '<img height=\"25px\" width=\"25px\" src=\"' + this.url + this.emojiMap[match] + '\" />' : match;\n    });\n}\n\nexport default EmojiDecoder\n","var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{staticClass:\"goeasy-audio-player\",on:{\"click\":_vm.play}},[_c('div',{staticClass:\"audio-facade\",style:({width:Math.ceil(_vm.duration)*7 + 60 + 'px'})},[_c('div',{staticClass:\"audio-facade-bg\",class:{'play-icon':_vm.playing}}),_c('div',[_vm._v(_vm._s(Math.ceil(_vm.duration) || 0)+\"\\\"\")])]),_c('audio',{ref:\"audioPlayer\",on:{\"ended\":_vm.onEnd}})])\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div class=\"goeasy-audio-player\" @click=\"play\">\n    <div class=\"audio-facade\" :style=\"{width:Math.ceil(duration)*7 + 60 + 'px'}\">\n      <div class=\"audio-facade-bg\" :class=\"{'play-icon':playing}\"></div>\n      <div>{{Math.ceil(duration) || 0}}\"</div>\n    </div>\n    <audio ref=\"audioPlayer\" @ended=\"onEnd\"></audio>\n  </div>\n</template>\n\n<script>\n  export default {\n    name: 'goeasy-audio-player',\n    props: ['src', 'duration'],\n    data() {\n      return {\n        playing: false\n      }\n    },\n    methods: {\n      play() {\n        this.playing = true;\n        this.$refs.audioPlayer.src = this.src;\n        this.$refs.audioPlayer.load();\n        this.$refs.audioPlayer.currentTime = 0;\n        this.$refs.audioPlayer.play();\n      },\n      onEnd() {\n        this.playing = false;\n      }\n    }\n  }\n</script>\n\n<style scoped>\n  .goeasy-audio-player {\n    -webkit-tap-highlight-color: rgba(0, 0, 0, 0);\n  }\n\n  .audio-facade {\n    min-width: 12px;\n    background: #eeeeee;\n    border-radius: 7px;\n    display: flex;\n    font-size: 14px;\n    padding: 8px;\n    margin: 5px 10px;\n    line-height: 25px;\n    cursor: pointer;\n  }\n\n  .audio-facade-bg {\n    background: url(\"/static/images/voice.png\") no-repeat center;\n    background-size: 15px;\n    width: 20px;\n  }\n\n  .audio-facade-bg.play-icon {\n    background: url(\"/static/images/play.gif\") no-repeat center;\n    background-size: 20px;\n  }\n</style>\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./GoEasyAudioPlayer.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./GoEasyAudioPlayer.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./GoEasyAudioPlayer.vue?vue&type=template&id=2edd0738&scoped=true&\"\nimport script from \"./GoEasyAudioPlayer.vue?vue&type=script&lang=js&\"\nexport * from \"./GoEasyAudioPlayer.vue?vue&type=script&lang=js&\"\nimport style0 from \"./GoEasyAudioPlayer.vue?vue&type=style&index=0&id=2edd0738&prod&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"2edd0738\",\n  null\n  \n)\n\nexport default component.exports","<template>\n  <div class=\"chat-container\">\n    <div class=\"chat-title\" v-if=\"customer\">\n      <img v-if=\"customer.avatar\" :src=\"customer.avatar\" class=\"chat-avatar\"/>\n      <img v-else src=\"../images/default.png\" class=\"chat-avatar\"/>\n      <div class=\"chat-name\">{{ renderCustomerName(customer) }}</div>\n    </div>\n    <div ref=\"scrollView\" class=\"chat-main\">\n      <div ref=\"messageList\" class=\"message-list\">\n        <div v-if=\"history.loading\" class=\"history-loading\">\n          <img src=\"../images/pending.gif\"/>\n        </div>\n        <div v-else class=\"history-loaded\" @click=\"loadHistoryMessage(false)\">\n          {{ history.allLoaded ? '已经没有更多的历史消息' : '获取历史消息' }}\n        </div>\n        <div v-for=\"(message, index) in history.messages\" :key=\"index\">\n          <div class=\"time-tips\">\n            {{ renderMessageDate(message, index) }}\n          </div>\n          <div class=\"message-item\">\n            <div v-if=\"message.type === 'CS_ACCEPT'\" class=\"accept-message\">\n              {{ message.senderData.name }}已接入\n            </div>\n            <div v-else-if=\"message.type === 'CS_END'\" class=\"accept-message\">\n              {{ message.senderData.name }}已结束会话\n            </div>\n            <div v-else-if=\"message.type === 'CS_TRANSFER'\" class=\"accept-message\">\n              {{\n                message.senderId === currentAgent.id ? `已转接给` + message.payload.transferTo.data.name :\n                  '已接入来自' + message.senderData.name + '的转接'\n              }}\n            </div>\n            <div v-else :class=\"{ self: message.senderId !== customer.id }\" class=\"message-item-content\">\n              <div class=\"sender-info\">\n                <img :src=\"message.senderData.avatar\" class=\"sender-avatar\"/>\n                <div class=\"sender-name\">\n                  {{ message.senderData.name }}\n                </div>\n              </div>\n              <div class=\"message-content\">\n                <div class=\"message-payload\">\n                  <div v-if=\"message.status === 'sending'\" class=\"pending\"></div>\n                  <div v-if=\"message.status === 'fail'\" class=\"send-fail\"></div>\n                  <div v-if=\"message.type === 'text'\" class=\"content-text\"\n                       v-html=\"renderTextMessage(message.payload.text)\"></div>\n                  <div v-if=\"message.type === 'image'\" class=\"content-image\"\n                       @click=\"showImage(message.payload.url)\">\n                    <img :src=\"message.payload.url\"\n                         :style=\"{height:getImageHeight(message.payload.width,message.payload.height)+'px'}\"/>\n                  </div>\n                  <goeasy-audio-player\n                    v-if=\"message.type ==='audio'\"\n                    :duration=\"message.payload.duration\"\n                    :src=\"message.payload.url\"\n                  />\n                  <div v-if=\"message.type === 'video'\" class=\"content-video\" @click=\"showVideo(message.payload.video.url)\">\n                    <img :style=\"{height:getImageHeight(message.payload.thumbnail.width,message.payload.thumbnail.height)+'px'}\" :src=\"message.payload.thumbnail.url\"/>\n                    <div class=\"icon\"></div>\n                  </div>\n                  <div v-if=\"message.type === 'order'\" class=\"content-order\">\n                    <div class=\"order-description\">发送订单：</div>\n                    <div class=\"order-content\">\n                      <img :src=\"message.payload.url\"/>\n                      <div class=\"order-info\">\n                        <div class=\"order-name\">{{ message.payload.name }}</div>\n                        <div>月销{{ message.payload.sales }}</div>\n                        <div>{{ message.payload.price }}</div>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n      <span ref=\"bottomView\"></span>\n    </div>\n    <div class=\"chat-footer\">\n      <div v-if=\"customerStatus==null\" class=\"accept-session\">\n        <div>离线中</div>\n      </div>\n      <div v-else-if=\"customerStatus.status==='PENDING'\" class=\"accept-session\">\n        <div class=\"accept-info\">\n          会话已等待{{ pendingTime.duration }}\n        </div>\n        <button class=\"accept-btn\" @click=\"acceptSession\">立即接入</button>\n      </div>\n      <div v-else-if=\"customerStatus.status==='ACCEPTED' && currentAgent.id !== customerStatus.agent.id\"\n           class=\"accept-session\">\n        <div class=\"accept-info\">{{ customerStatus.agent.data.name }}已接入</div>\n      </div>\n      <div v-else-if=\"customerStatus.status==='FREE'\" class=\"accept-session\">\n        <button class=\"accept-btn\" @click=\"acceptSession\">主动接入</button>\n      </div>\n      <div v-else class=\"action-box\">\n        <div class=\"action-bar\">\n          <div class=\"chat-action\">\n            <!-- 表情 -->\n            <div class=\"action-item\">\n              <div v-if=\"emoji.visible\" class=\"emoji-box\">\n                <img\n                  v-for=\"(emojiItem, emojiKey, index) in emoji.map\"\n                  :key=\"index\"\n                  :src=\"emoji.url + emojiItem\"\n                  class=\"emoji-item\"\n                  @click=\"chooseEmoji(emojiKey)\"\n                />\n              </div>\n              <i class=\"iconfont icon-smile\" title=\"表情\" @click=\"showEmojiBox\"></i>\n            </div>\n            <!-- 图片 -->\n            <div class=\"action-item\">\n              <label for=\"img-input\">\n                <i class=\"iconfont icon-picture\" title=\"图片\"></i>\n              </label>\n              <input v-show=\"false\" id=\"img-input\" accept=\"image/*\" multiple type=\"file\"\n                     @change=\"sendImageMessage\"/>\n            </div>\n            <!-- 视频 -->\n            <div class=\"action-item\">\n              <label for=\"video-input\"><i class=\"iconfont icon-film\" title=\"视频\"></i></label>\n              <input v-show=\"false\" id=\"video-input\" accept=\"video/*\" type=\"file\"\n                     @change=\"sendVideoMessage\"/>\n            </div>\n          </div>\n          <div class=\"session-action\">\n            <span class=\"transfer\" @click=\"showTransferForm()\">转接</span>\n            <i class=\"iconfont icon-end_chat\" title=\"结束会话\" @click=\"endSession\"></i>\n          </div>\n        </div>\n        <div class=\"input-box\">\n          <textarea ref=\"input\" v-model=\"text\" autocomplete=\"off\" class=\"input-content\"></textarea>\n        </div>\n        <div class=\"send-box\">\n          <button class=\"send-button\" @click=\"sendTextMessage\">发送</button>\n        </div>\n      </div>\n    </div>\n    <!-- 图片预览弹窗 -->\n    <div v-if=\"imagePopup.visible\" class=\"image-preview\">\n      <img :src=\"imagePopup.url\" alt=\"图片\"/>\n      <span class=\"close\" @click=\"hideImagePreviewPopup\">x</span>\n    </div>\n    <!-- 转接弹窗 -->\n    <div v-if=\"transferForm.visible\" class=\"transfer-popup\">\n      <div class=\"transfer-model\">\n        <div v-if=\"transferForm.agents.length\" class=\"transfer-content\">\n          <div v-for=\"(agent, index) in transferForm.agents\" class=\"agent-info\">\n            <label class=\"agent-label\">\n              <input v-model=\"transferForm.to\" :name=\"agent.data.name\" :value=\"agent\" type=\"radio\"/>\n              <img :src=\"agent.data.avatar\" class=\"agent-avatar\"/>\n              <span class=\"agent-name\">{{ agent.data.name }}</span>\n            </label>\n          </div>\n        </div>\n        <div v-else class=\"transfer-content\">\n          <div class=\"no-agent\">-当前无其他客服在线-</div>\n        </div>\n        <div class=\"transfer-bottom\">\n          <span v-if=\"transferForm.agents.length\" class=\"transfer-button\" @click=\"transfer()\">确认</span>\n          <span class=\"transfer-button\" @click=\"hideTransferForm()\">取消</span>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\n  import {formatDate, formateTime} from '../lib/utils.js'\n  import EmojiDecoder from '../lib/EmojiDecoder';\n  import GoEasyAudioPlayer from \"../components/GoEasyAudioPlayer\";\n  import {getContact} from \"../api/api.js\";\n\n  const IMAGE_MAX_WIDTH = 200;\n  const IMAGE_MAX_HEIGHT = 150;\n  export default {\n    name: \"Chat\",\n    components: {\n      \"goeasy-audio-player\": GoEasyAudioPlayer,\n    },\n    data() {\n      const emojiUrl = 'https://imgcache.qq.com/open/qcloud/tim/assets/emoji/';\n      const emojiMap = {\n        '[么么哒]': 'emoji_3@2x.png',\n        '[乒乓]': 'emoji_4@2x.png',\n        '[便便]': 'emoji_5@2x.png',\n        '[信封]': 'emoji_6@2x.png',\n        '[偷笑]': 'emoji_7@2x.png',\n        '[傲慢]': 'emoji_8@2x.png',\n      };\n      return {\n        currentAgent: null,\n        csteam: null,\n\n        customer: null,\n        customerStatus: null,\n\n        to: {},//用于创建消息时传入\n\n        history: {\n          messages: [],\n          allLoaded: false,\n          loading: true\n        },\n\n        text: '',\n        emoji: {\n          url: emojiUrl,\n          map: emojiMap,\n          visible: false,\n          decoder: new EmojiDecoder(emojiUrl, emojiMap),\n        },\n        imagePopup: {\n          visible: false,\n          url: ''\n        },\n        transferForm: {\n          visible: false,\n          agents: [],\n          to: {}\n        },\n        pendingTime: {\n          timer: null,\n          duration: ''\n        }\n      }\n    },\n    async created() {\n      const openId = this.$route.query.id;\n      let data = await getContact(openId);\n      this.customer = {\n        id: data.data.openId,\n        name: data.data.nickname,\n        avatar: data.data.avatar,\n        unionId: data.data.unionid, //todo?有用吗？\n        appName: data.data.appName,\n        mark: data.data.mark,\n        mobileNumber: data.data.mobileNumber\n      }\n\n      this.to = {\n        type: this.GoEasy.IM_SCENE.CS,\n        id: this.customer.id,\n        data: this.customer,\n      };\n      this.currentAgent = this.global.currentAgent;\n      this.csteam = this.goEasy.im.csteam(this.currentAgent.teamId);\n\n      this.liveSession();\n      this.loadHistoryMessage(true, 0);\n    },\n    beforeDestroy() {\n      this.csteam.quitLiveSession({\n        onSuccess: () => {\n          console.log('quit successfully ');\n        },\n        onFailed: (error) => {\n          console.log('failed to quit:', error);\n        },\n      });\n    },\n    methods: {\n      renderCustomerName (customer) {\n        if (customer.mark) {\n          return customer.mark;\n        } else if (customer.name.indexOf('游客') !== -1 && customer.mobileNumber || !customer.name) {\n          return customer.mobileNumber;\n        }\n        return customer.mobileNumber;\n      },\n      renderTextMessage(text) {\n        return this.emoji.decoder.decode(text);\n      },\n      liveSession() {\n        this.csteam.liveSession({\n          customerId: this.customer.id,\n          onSuccess: () => {\n            console.log('live successfully');\n            this.markMessageAsRead();\n          },\n          onFailed: (error) => {\n            console.log('failed to live session:', error);\n          },\n          onStatusUpdated: (customerStatus) => {\n            this.customerStatus = customerStatus;\n            if (customerStatus.status==='PENDING') {\n              this.updatePendingTime(customerStatus.start);\n            }\n          },\n          onNewMessage: (message) => {\n            console.log('onNewMessage',message);\n            this.onReceivedMessage(message);\n          },\n        })\n      },\n      updatePendingTime (time) {\n        clearInterval(this.pendingTime.timer);\n        this.pendingTime.timer = setInterval(() => {\n          this.pendingTime.duration = formateTime(time);\n        },1800);\n      },\n      onReceivedMessage(newMessage) {\n        //如果该消息已存在，跳过\n        if (this.history.messages.findIndex((message) => newMessage.id === message.messageId) >= 0) {\n          return;\n        }\n        this.history.messages.push(newMessage);\n        this.markMessageAsRead();\n        this.scrollToBottom();\n      },\n      markMessageAsRead() {\n        this.csteam.markMessageAsRead({\n          type: this.GoEasy.IM_SCENE.CS,\n          id: this.customer.id,\n          onSuccess: function () {\n            console.log('标记已读成功');\n          },\n          onFailed: function (error) {\n            console.log('标记已读失败', error);\n          }\n        });\n      },\n      loadHistoryMessage(scrollToBottom) {\n        this.history.loading = true;\n        let lastMessageTimeStamp;\n        let lastMessage = this.history.messages[0];\n        if (lastMessage) {\n          lastMessageTimeStamp = lastMessage.timestamp;\n        }\n        let limit = 10;\n        this.csteam.history({\n          id: this.customer.id,\n          type: this.GoEasy.IM_SCENE.CS,\n          lastTimestamp: lastMessageTimeStamp,\n          limit: limit,\n          onSuccess: (result) => {\n            this.history.loading = false;\n            let messages = result.content;\n            if (messages.length === 0) {\n              this.history.allLoaded = true;\n            } else {\n              if (lastMessageTimeStamp) {\n                this.history.messages = messages.concat(this.history.messages);\n              } else {\n                this.history.messages = messages;\n              }\n              if (scrollToBottom) {\n                this.scrollToBottom();\n              }\n            }\n          },\n          onFailed: (error) => {\n            //获取失败\n            this.history.loading = false;\n            console.log('获取历史消息失败, code:' + error.code + ',错误信息:' + error.content);\n          },\n        });\n      },\n      /**\n       * 核心就是设置高度，产生明确占位\n       *\n       * 小  (宽度和高度都小于预设尺寸)\n       *    设高=原始高度\n       * 宽 (宽度>高度)\n       *    高度= 根据宽度等比缩放\n       * 窄  (宽度<高度)或方(宽度=高度)\n       *    设高=MAX height\n       *\n       * @param width,height\n       * @returns number\n       */\n      getImageHeight(width, height) {\n        if (width < IMAGE_MAX_WIDTH && height < IMAGE_MAX_HEIGHT) {\n          return height;\n        } else if (width > height) {\n          return IMAGE_MAX_WIDTH / width * height;\n        } else if (width === height || width < height) {\n          return IMAGE_MAX_HEIGHT;\n        }\n      },\n      renderMessageDate(message, index) {\n        if (index === 0) {\n          return formatDate(message.timestamp);\n        } else {\n          if (message.timestamp - this.history.messages[index - 1].timestamp > 5 * 60 * 1000) {\n            return formatDate(message.timestamp);\n          }\n        }\n        return '';\n      },\n      showImage(url) {\n        this.callParentFunction('showImage', {url:url});\n      },\n      showVideo (url) {\n        this.callParentFunction('showVideo', {url:url});\n      },\n      callParentFunction (functionName, parameters) {\n        const targetOrigin = document.referrer;\n        window.parent.postMessage({\n          'function': functionName,\n          'parameters': parameters,\n        }, targetOrigin);\n      },\n\n      isOnline() {\n        return new Promise((resolve, reject) => {\n          this.csteam.isOnline({\n            onSuccess: (result) => {\n              resolve(result);\n            },\n            onFailed: (error) => {\n              console.log('获取在线状态失败，error:', error)\n              reject(error);\n            }\n          })\n        })\n      },\n\n      async acceptSession() {\n        if (await this.isOnline()) {\n          this.csteam.accept({\n            id: this.customer.id,\n            onSuccess: () => {\n              console.log('accept successfully.');\n              clearInterval(this.pendingTime.timer);\n            },\n            onFailed: (error) => {\n              console.log('accept failed', error);\n            }\n          });\n        } else {\n          alert('您还不是一名该团队的在线客服，请点击左下角头像进行上线操作')\n        }\n      },\n      endSession() {\n        this.csteam.end({\n          id: this.customer.id,\n          onSuccess: () => {\n            console.log('end successfully.');\n          },\n          onFailed: (error) => {\n            console.log('end failed', error);\n          }\n        })\n      },\n      showTransferForm() {\n        this.csteam.agents({\n          onSuccess: (result) => {\n            this.transferForm.visible = true;\n            this.transferForm.agents = result.content.filter((agent) => {\n              return agent.id !== this.currentAgent.id;\n            });\n          },\n          onFailed: (error) => {\n            console.log('query online agents failed', error);\n          }\n        });\n      },\n      transfer() {\n        this.csteam.transfer({\n          customerId: this.customer.id,\n          agentId: this.transferForm.to.id,\n          onSuccess: () => {\n            this.transferForm.visible = false;\n            console.log('transfer successfully.');\n          },\n          onFailed: (error) => {\n            console.log('transfer failed', error);\n          }\n        })\n      },\n      hideTransferForm() {\n        this.transferForm.visible = false;\n      },\n      showEmojiBox() {\n        this.emoji.visible = !this.emoji.visible;\n      },\n      chooseEmoji(emojiKey) {\n        this.text += emojiKey;\n        this.emoji.visible = false;\n      },\n      sendTextMessage() {\n        if (this.text.trim().length === 0) {\n          console.log('输入为空');\n          return\n        }\n        this.csteam.createTextMessage({\n          text: this.text,\n          to: this.to,\n          onSuccess: (message) => {\n            this.sendMessage(message);\n            this.text = '';\n          },\n          onFailed: (err) => {\n            console.log(\"创建消息err:\", err);\n          }\n        });\n      },\n      sendImageMessage(e) {\n        let fileList = [...e.target.files];\n        fileList.forEach((file) => {\n          this.csteam.createImageMessage({\n            file: file,\n            to: this.to,\n            onProgress: function (progress) {\n              console.log(progress)\n            },\n            onSuccess: (message) => {\n              this.sendMessage(message);\n            },\n            onFailed: (e) => {\n              console.log('error :', e);\n            }\n          });\n        })\n      },\n      sendVideoMessage(e) {\n        const file = e.target.files[0];\n        this.csteam.createVideoMessage({\n          file: file,\n          to: this.to,\n          onProgress: function (progress) {\n            console.log(progress)\n          },\n          onSuccess: (message) => {\n            this.sendMessage(message);\n          },\n          onFailed: (e) => {\n            console.log('error :', e);\n          }\n        });\n      },\n      sendMessage(message) {\n        this.history.messages.push(message);\n        this.scrollToBottom();\n        this.goEasy.im.sendMessage({\n          message: message,\n          onSuccess: (message) => {\n            console.log('发送成功', message);\n          },\n          onFailed: function (error) {\n            if (error.code === 507) {\n              console.log('发送语音/图片/视频/文件失败，没有配置OSS存储，详情参考：https://www.goeasy.io/cn/docs/goeasy-2.x/im/message/media/send-media-message.html');\n            } else {\n              console.log('发送失败:', error);\n            }\n          }\n        });\n      },\n      scrollToBottom() {\n        this.$nextTick(() => {\n          if (this.$refs.bottomView) {\n            this.$refs.bottomView.scrollIntoView();\n          }\n        })\n      }\n    }\n  };\n</script>\n\n<style lang=\"scss\" scoped>\n  .chat-container {\n    width: 100%;\n    height: 100%;\n    display: flex;\n    flex-direction: column;\n\n    .chat-title {\n      height: 61px;\n      padding: 15px;\n      display: flex;\n      align-items: center;\n      font-size: 18px;\n\n      .chat-avatar {\n        width: 40px;\n        height: 40px;\n        border-radius: 50%;\n      }\n\n      .chat-name {\n        width: 400px;\n        margin-left: 10px;\n        white-space: nowrap;\n        overflow: hidden;\n        text-overflow: ellipsis;\n        word-break: break-all;\n      }\n\n    }\n\n    .chat-main {\n      display: flex;\n      flex-direction: column;\n      overflow-y: auto;\n      flex: 1;\n\n      .message-list {\n        padding: 0 15px;\n      }\n\n      .history-loaded {\n        text-align: center;\n        font-size: 12px;\n        color: #d02129;\n        cursor: pointer;\n        line-height: 20px;\n      }\n\n      .history-loading {\n        width: 100%;\n        text-align: center;\n      }\n\n      .time-tips {\n        color: #999;\n        text-align: center;\n        font-size: 12px;\n      }\n\n      .message-item {\n        display: flex;\n\n        .accept-message {\n          width: 100%;\n          text-align: center;\n          color: #606164;\n          line-height: 25px;\n          font-size: 12px;\n        }\n\n        .message-item-content {\n          flex: 1;\n          max-height: 230px;\n          margin: 5px 0;\n          overflow: hidden;\n          display: flex;\n\n          .sender-info {\n            margin: 5px;\n\n            .sender-avatar {\n              width: 40px;\n              height: 40px;\n              border-radius: 50%;\n            }\n\n            .sender-name {\n              color: #606164;\n              text-align: center;\n              font-size: 12px;\n            }\n\n          }\n\n          .message-content {\n            max-width: calc(100% - 100px);\n\n            .message-payload {\n              display: flex;\n              align-items: center;\n            }\n\n            .pending {\n              background: url(\"../images/pending.gif\") no-repeat center;\n              background-size: 13px;\n              width: 15px;\n              height: 15px;\n            }\n\n            .send-fail {\n              background: url(\"../images/failed.png\") no-repeat center;\n              background-size: 13px;\n              width: 15px;\n              height: 15px;\n            }\n\n            .content-text {\n              display: flex;\n              align-items: center;\n              text-align: left;\n              background: #eeeeee;\n              font-size: 14px;\n              font-weight: 500;\n              padding: 6px 8px;\n              margin: 5px 0;\n              line-height: 25px;\n              white-space: pre-line;\n              overflow-wrap: anywhere;\n              border-radius: 8px;\n            }\n\n            .content-image {\n              display: block;\n              margin: 5px 10px;\n              cursor: pointer;\n            }\n\n            .content-video {\n              display: block;\n              margin: 0 10px;\n              cursor: pointer;\n              position: relative;\n              height: 100%;\n\n              img {\n                height: 100%;\n              }\n\n              .icon {\n                position: absolute;\n                width: 20px;\n                height: 20px;\n                background: url('../images/play.png') no-repeat center;\n                background-size: 100%;\n                top: 0;\n                left: 0;\n                right: 0;\n                bottom: 0;\n                margin: auto;\n              }\n\n            }\n\n          }\n        }\n\n        .self {\n          overflow: hidden;\n          display: flex;\n          justify-content: flex-start;\n          flex-direction: row-reverse;\n        }\n\n        .self /deep/ .play-icon {\n          background: url(\"../images/play.gif\") no-repeat center;\n          background-size: 20px;\n          -moz-transform: rotate(180deg);\n          -webkit-transform: rotate(180deg);\n          -o-transform: rotate(180deg);\n          transform: rotate(180deg);\n        }\n\n      }\n    }\n\n    .chat-footer {\n      border-top: 1px solid #dcdfe6;\n      width: 100%;\n      height: 200px;\n      background: #FFFFFF;\n\n      .action-box {\n        width: 100%;\n        height: 100%;\n        display: flex;\n        flex-direction: column;\n\n        .action-bar {\n          display: flex;\n          flex-direction: row;\n          justify-content: space-between;\n\n          .iconfont {\n            font-size: 22px;\n            margin: 0 10px;\n            z-index: 3;\n            color: #606266;\n            cursor: pointer;\n\n            &\n            :focus {\n              outline: none;\n            }\n\n            &\n            :hover {\n              color: #d02129;\n            }\n\n          }\n\n          .chat-action {\n            display: flex;\n            flex-direction: row;\n            padding: 0 10px;\n\n            .action-item {\n              text-align: left;\n              padding: 10px 0;\n              position: relative;\n\n              .emoji-box {\n                width: 250px;\n                position: absolute;\n                top: -125px;\n                left: -11px;\n                z-index: 2007;\n                background: #fff;\n                border: 1px solid #ebeef5;\n                padding: 12px;\n                text-align: justify;\n                font-size: 14px;\n                box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);\n                word-break: break-all;\n                border-radius: 4px;\n\n                .emoji-list {\n                  display: flex;\n                  flex-wrap: wrap;\n                }\n\n                .emoji-item {\n                  width: 45px;\n                  height: 45px;\n                  margin: 0 2px\n                }\n\n              }\n\n              .link-box {\n                width: 160px;\n                position: absolute;\n                top: -146px;\n                left: -11px;\n                z-index: 2007;\n                background: #fff;\n                border: 1px solid #ebeef5;\n                padding: 12px;\n                text-align: justify;\n                font-size: 14px;\n                box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);\n                word-break: break-all;\n                border-radius: 4px;\n\n                .order-item {\n                  display: flex;\n                  align-items: center;\n                  margin: 5px 0;\n                  cursor: pointer;\n\n                  .order-img {\n                    width: 40px;\n                    height: 40px;\n                    margin-right: 5px;\n                  }\n\n                }\n              }\n            }\n          }\n\n          .session-action {\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            position: relative;\n\n            .transfer {\n              padding: 2px;\n              display: inline-block;\n              max-width: 60px;\n              border: 1px solid gray;\n              border-radius: 2px;\n              text-align: center;\n              cursor: pointer;\n            }\n\n          }\n        }\n\n        .input-box {\n          padding: 0 10px;\n          flex: 1;\n\n          .input-content {\n            height: 110px;\n            border: none;\n            resize: none;\n            display: block;\n            padding: 5px 15px;\n            box-sizing: border-box;\n            width: 100%;\n            color: #606266;\n            outline: none;\n            background: #FFFFFF;\n          }\n\n        }\n\n        .send-box {\n          padding: 5px 10px;\n          text-align: right;\n\n          .send-button {\n            width: 60px;\n            height: 30px;\n            font-size: 15px;\n            border: 1px solid #d02129;\n            background-color: #ffffff;\n            color: #d02129;\n            border-radius: 5px;\n          }\n\n        }\n      }\n\n      .accept-session {\n        width: 100%;\n        height: 100%;\n        display: flex;\n        flex-direction: column;\n        align-items: center;\n        justify-content: center;\n\n        .accept-info {\n          font-size: 18px;\n          color: #d02129;\n          margin-bottom: 10px;\n        }\n\n        .accept-btn {\n          width: 75px;\n          height: 30px;\n          font-size: 15px;\n          border: 1px solid #d02129;\n          background-color: #ffffff;\n          color: #d02129;\n          border-radius: 5px;\n          cursor: pointer;\n        }\n\n      }\n    }\n\n    .image-preview {\n      max-width: 750px;\n      max-height: 500px;\n      background: rgba(0, 0, 0, 0.8);\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      position: fixed;\n      margin: auto;\n      top: 0;\n      bottom: 0;\n      left: 0;\n      right: 0;\n      z-index: 9998;\n\n      img {\n        max-width: 750px;\n        max-height: 500px;\n      }\n\n      .close {\n        padding: 0 8px;\n        background: #f6f2f2;\n        border: 1px solid #eeeeee;\n        font-size: 15px;\n        cursor: pointer;\n        color: #333333;\n        position: absolute;\n        top: 4px;\n        right: 10px;\n      }\n\n    }\n\n    .transfer-popup {\n      position: absolute;\n      left: 0;\n      right: 0;\n      top: 0;\n      bottom: 0;\n\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      background: rgba(33, 33, 33, 0.7);\n\n      .transfer-model {\n        width: 450px;\n        min-height: 200px;\n        display: flex;\n        flex-direction: column;\n        padding: 5px;\n        border: 1px solid gainsboro;\n        border-radius: 4px;\n        text-align: center;\n        background: #ffffff;\n\n        .transfer-content {\n          flex: 1;\n          display: flex;\n          align-items: center;\n          flex-wrap: wrap;\n\n          .agent-info {\n            width: 110px;\n            padding: 20px;\n\n            .agent-label {\n              display: flex;\n              align-items: center;\n            }\n\n            .agent-avatar {\n              width: 40px;\n              height: 40px;\n              min-width: 40px;\n              min-height: 40px;\n              margin: 0 5px;\n            }\n\n            .agent-name {\n              font-size: 14px;\n              word-break: break-all;\n            }\n\n          }\n\n          .no-agent {\n            flex: 1;\n          }\n\n        }\n\n        .transfer-bottom {\n          height: 50px;\n          display: flex;\n          margin: 0 50px;\n          align-items: center;\n          justify-content: space-around;\n\n          .transfer-button {\n            display: inline-block;\n            padding: 8px 15px;\n            font-size: 13px;\n            border: 1px solid #d02129;\n            color: #d02129;\n            border-radius: 4px;\n            cursor: pointer;\n          }\n\n        }\n      }\n    }\n  }\n</style>\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Chat.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Chat.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Chat.vue?vue&type=template&id=6f10133c&scoped=true&\"\nimport script from \"./Chat.vue?vue&type=script&lang=js&\"\nexport * from \"./Chat.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Chat.vue?vue&type=style&index=0&id=6f10133c&prod&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"6f10133c\",\n  null\n  \n)\n\nexport default component.exports","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--7-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--7-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--7-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./GoEasyAudioPlayer.vue?vue&type=style&index=0&id=2edd0738&prod&scoped=true&lang=css&\"","module.exports = __webpack_public_path__ + \"img/default.f0e98eaa.png\";","/**\n * 格式化日期\n * @prama t 时间戳\n * @return str MM-dd HH:mm\n */\nexport function formatDate(t) {\n    t = t || Date.now();\n    let time = new Date(t);\n    let str = time.getMonth() < 9 ? '0' + (time.getMonth() + 1) : time.getMonth() + 1;\n    str += '-';\n    str += time.getDate() < 10 ? '0' + time.getDate() : time.getDate();\n    str += ' ';\n    str += time.getHours();\n    str += ':';\n    str += time.getMinutes() < 10 ? '0' + time.getMinutes() : time.getMinutes();\n    return str;\n};\n\n/**\n * 距当前时间点的时长\n * @prama time 13位时间戳\n * @return str x秒 / x分钟 / x小时\n */\nexport function formateTime(time) {\n    const second = 600;\n    const minute = second * 60;\n    const hour = minute * 60;\n    const day = hour * 24;\n    const now = new Date().getTime();\n    const diffValue = now - time;\n\n    // 计算差异时间的量级\n    const secondC = diffValue / second;\n    const minC = diffValue / minute;\n    const hourC = diffValue / hour;\n    const dayC = diffValue / day;\n\n    if (dayC >= 1) {\n        return parseInt(dayC) + \"天\";\n    } else if (hourC >= 1) {\n        return parseInt(hourC) + \"小时\";\n    } else if (minC >= 1) {\n        return parseInt(minC) + \"分钟\";\n    } else if (secondC >= 1) {\n        return parseInt(secondC) + \"秒\";\n    } else {\n        return '0秒';\n    }\n}","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--9-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--9-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--9-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--9-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Chat.vue?vue&type=style&index=0&id=6f10133c&prod&lang=scss&scoped=true&\"","class Utils {\n\n    getAccessToken() {\n        let env = process.env.VUE_APP_ENV;\n        let accessToken = this.getCookie(`goeasy.token.${env}`);\n        return accessToken;\n    }\n\n    getRefreshToken() {\n        let env = process.env.VUE_APP_ENV;\n        let refreshToken = this.getCookie(`goeasy.refreshToken.${env}`);\n        return refreshToken;\n    }\n\n    storeTokens(token, refreshToken, expiresAtMillis) {\n        let env = process.env.VUE_APP_ENV;\n        this.setCookie(`goeasy.token.${env}`, token);\n        this.setCookie(`goeasy.refreshToken.${env}`, refreshToken);\n        this.setCookie(`goeasy.token.expiresAtMillis.${env}`, expiresAtMillis + \"\");\n    }\n\n    setCookie(name, value) {\n        console.log(\"will set \" + name + \"with value: \" + value);\n        document.cookie = name + \"=\" + escape(value) + \";domain=goeasy.io\";\n    }\n\n\n    getCookie(name) {\n        let arr, reg = new RegExp(\"(^| )\" + name + \"=([^;]*)(;|$)\");\n        if (arr = document.cookie.match(reg)) {\n            return unescape(arr[2]);\n        }\n        return null;\n    }\n}\n\nexport default new Utils();\n\n","import utils from \"./utils\";\nimport axios from 'axios';\n\nconst env = process.env.VUE_APP_ENV;\n\nfunction checkAndRefreshToken() {\n    let xhr;\n    if (window.XMLHttpRequest) {\n        xhr = new XMLHttpRequest();\n    } else {\n        xhr = new ActiveXObject(\"Microsoft.XMLHttp\")\n    }\n    let url = `https://${env}sso.goeasy.io`;\n    let expiresAt = utils.getCookie(`goeasy.token.expiresAtMillis.${env}`);\n    let currentTime = new Date().getTime();\n    if (xhr && expiresAt - currentTime < 3600 * 1000) {//less than 1 hour\n        let refreshToken = utils.getRefreshToken();\n        xhr.open(\"post\", url + \"/refreshtoken\", true);\n        xhr.setRequestHeader('content-type', 'application/x-www-form-urlencoded');\n        xhr.send(\"refreshToken=\" + refreshToken);\n        xhr.onreadystatechange = function () {\n            if (xhr.readyState === 4) {\n                if (xhr.status === 200) {\n                    let result = JSON.parse(xhr.responseText);\n                    let newToken = result.token;\n                    let newRefreshToken = result.refreshToken;\n                    let expiresAtMillis = result.expiresAtMillis;\n                    utils.storeTokens(newToken, newRefreshToken, expiresAtMillis);\n                } else {\n                    // console.log(\"xxxx error: \", xhr.status)\n                }\n            } else {\n                // console.log(xhr.status);\n            }\n        }\n    }\n}\n\nconst http = axios.create({\n    baseURL: '',\n    timeout: 60000\n});\n\n// 请求拦截器\nhttp.interceptors.request.use((config) => {\n    checkAndRefreshToken();\n    const token = utils.getAccessToken();\n    if (token) {\n        config.headers['Authorization'] = \"Bearer \" + token\n    }\n    return config;\n}, (error) => {\n    return Promise.reject(error);\n});\n\n// 响应拦截器\nhttp.interceptors.response.use((response) => {\n    return response.data;\n}, (error) => {\n    return Promise.reject(error);\n});\n\nexport default http;\n","import http from \"./index\";\n\nlet env = process.env.VUE_APP_ENV;\nconst center = `https://${env}center.goeasy.io/api/v1`;\nconst agentBaseUrl = `https://${env}center.goeasy.io/api/v2/cs-agent`;\n\nexport function getOTP() {\n    let url =`${agentBaseUrl}/otp`;\n    return http({\n        url: url,\n        method: \"POST\"\n    })\n}\n\nexport function getWorkerInfo() {\n    let url = `${center}/admin/currentuser`;\n    return http({\n        url: url,\n        method: 'GET'\n    })\n}\n\nexport function getContacts(search) {\n    let url = `${agentBaseUrl}/contacts`;\n    return http({\n        url: url,\n        data: {\n            search: search\n        },\n        method: 'POST'\n    })\n}\n\nexport function updateUserMark(openId, mark) {\n    let url = `${agentBaseUrl}/contacts/${openId}/mark`;\n    return http({\n        url: url,\n        data: {\n            mark: mark\n        },\n        method: 'POST'\n    })\n}\n\nexport function getContact(openId) {\n    let url = `${agentBaseUrl}/contacts/${openId}`;\n    return http({\n        url: url,\n        method: 'GET'\n    })\n}\n\nexport function updateMobileNumber(params) {\n    let url = `${agentBaseUrl}/contacts/${params.openId}/mobile-number`;\n    return http({\n        url: url,\n        data: {\n            mobileNumber: params.mobileNumber\n        },\n        method: 'POST'\n    })\n}","module.exports = \"data:image/gif;base64,R0lGODlhEAAQALMMAKqooJGOhp2bk7e1rZ2bkre1rJCPhqqon8PBudDOxXd1bISCef///wAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh+QQFAAAMACwAAAAAEAAQAAAET5DJyYyhmAZ7sxQEs1nMsmACGJKmSaVEOLXnK1PuBADepCiMg/DQ+/2GRI8RKOxJfpTCIJNIYArS6aRajWYZCASDa41Ow+Fx2YMWOyfpTAQAIfkEBQAADAAsAAAAABAAEAAABE6QyckEoZgKe7MEQMUxhoEd6FFdQWlOqTq15SlT9VQM3rQsjMKO5/n9hANixgjc9SQ/CgKRUSgw0ynFapVmGYkEg3v1gsPibg8tfk7CnggAIfkEBQAADAAsAAAAABAAEAAABE2QycnOoZjaA/IsRWV1goCBoMiUJTW8A0XMBPZmM4Ug3hQEjN2uZygahDyP0RBMEpmTRCKzWGCkUkq1SsFOFQrG1tr9gsPc3jnco4A9EQAh+QQFAAAMACwAAAAAEAAQAAAETpDJyUqhmFqbJ0LMIA7McWDfF5LmAVApOLUvLFMmlSTdJAiM3a73+wl5HYKSEET2lBSFIhMIYKRSimFriGIZiwWD2/WCw+Jt7xxeU9qZCAAh+QQFAAAMACwAAAAAEAAQAAAETZDJyRCimFqbZ0rVxgwF9n3hSJbeSQ2rCWIkpSjddBzMfee7nQ/XCfJ+OQYAQFksMgQBxumkEKLSCfVpMDCugqyW2w18xZmuwZycdDsRACH5BAUAAAwALAAAAAAQABAAAARNkMnJUqKYWpunUtXGIAj2feFIlt5JrWybkdSydNNQMLaND7pC79YBFnY+HENHMRgyhwPGaQhQotGm00oQMLBSLYPQ9QIASrLAq5x0OxEAIfkEBQAADAAsAAAAABAAEAAABE2QycmUopham+da1cYkCfZ94UiW3kmtbJuRlGF0E4Iwto3rut6tA9wFAjiJjkIgZAYDTLNJgUIpgqyAcTgwCuACJssAdL3gpLmbpLAzEQA7\""],"sourceRoot":""}