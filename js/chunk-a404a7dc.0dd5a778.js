(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-a404a7dc"],{1567:function(t,s,e){"use strict";e.r(s);var i=function(){var t=this,s=t._self._c;return s("div",{staticClass:"conversation-container"},[s("div",{staticClass:"conversation-list"},[s("div",{staticClass:"conversation-list-item"},[s("div",{staticClass:"conversation-list-title"},[t._v("待接入 "+t._s(t.pendingConversations.length))]),s("div",{staticClass:"conversation-list-body"},t._l(t.pendingConversations,(function(i,a){return s("div",{key:a,staticClass:"conversation-item",class:{checked:i.id===t.$route.query.id},on:{click:function(s){return t.chat(i.id)}}},[s("div",{staticClass:"item-head"},[i.data.avatar?s("img",{staticClass:"item-avatar",attrs:{src:i.data.avatar}}):s("img",{staticClass:"item-avatar",attrs:{src:e("1dee")}})]),s("div",{staticClass:"item-info"},[s("div",{staticClass:"item-info-name"},[t._v(t._s(t.renderCustomerName(i.data)))]),"text"===i.lastMessage.type?s("div",{staticClass:"item-info-message"},[t._v(t._s(i.lastMessage.payload.text)+" ")]):"image"===i.lastMessage.type?s("div",{staticClass:"item-info-message"},[t._v(" [图片消息] ")]):"video"===i.lastMessage.type?s("div",{staticClass:"item-info-message"},[t._v(" [视频消息] ")]):"audio"===i.lastMessage.type?s("div",{staticClass:"item-info-message"},[t._v(" [语音消息] ")]):"order"===i.lastMessage.type?s("div",{staticClass:"item-info-message"},[t._v(" [自定义消息:订单] ")]):t._e()])])})),0)]),s("div",{staticClass:"conversation-list-item"},[s("div",{staticClass:"conversation-list-title"},[t._v("已接入 "+t._s(t.conversations.length))]),t.conversations.length?s("div",{staticClass:"conversation-list-body"},t._l(t.conversations,(function(i,a){return s("div",{key:a,staticClass:"conversation-item",class:{checked:i.id===t.$route.query.id},on:{click:function(s){return t.chat(i.id)},contextmenu:function(s){return s.preventDefault(),s.stopPropagation(),(s=>t.showRightClickMenu(s,i)).apply(null,arguments)}}},[s("div",{staticClass:"item-head"},[i.data.avatar?s("img",{staticClass:"item-avatar",attrs:{src:i.data.avatar}}):s("img",{staticClass:"item-avatar",attrs:{src:e("1dee")}}),i.unread?s("span",{staticClass:"item-unread-num"},[t._v(t._s(i.unread))]):t._e()]),s("div",{staticClass:"item-info"},[s("div",{staticClass:"item-info-top"},[s("div",{staticClass:"item-info-name"},[t._v(t._s(t.renderCustomerName(i.data)))]),s("div",{staticClass:"item-info-time"},[t._v(t._s(t.formatDate(i.lastMessage.timestamp)))])]),s("div",{staticClass:"item-info-bottom"},["sending"===i.lastMessage.status?s("div",{staticClass:"item-info-sending"}):t._e(),"fail"===i.lastMessage.status?s("div",{staticClass:"item-info-failed"}):t._e(),"text"===i.lastMessage.type?s("div",{staticClass:"item-info-message"},[t._v(t._s(i.lastMessage.payload.text)+" ")]):"image"===i.lastMessage.type?s("div",{staticClass:"item-info-message"},[t._v(" [图片消息] ")]):"video"===i.lastMessage.type?s("div",{staticClass:"item-info-message"},[t._v(" [视频消息] ")]):"audio"===i.lastMessage.type?s("div",{staticClass:"item-info-message"},[t._v(" [语音消息] ")]):"order"===i.lastMessage.type?s("div",{staticClass:"item-info-message"},[t._v(" [自定义消息:订单] ")]):"CS_END"===i.lastMessage.type?s("div",{staticClass:"item-info-message"},[t._v(" 会话已结束 ")]):"CS_ACCEPT"===i.lastMessage.type?s("div",{staticClass:"item-info-message"},[t._v("接入成功 ")]):"CS_TRANSFER"===i.lastMessage.type?s("div",{staticClass:"item-info-message"},[t._v(" "+t._s(i.lastMessage.senderId===t.currentAgent.id?"已转接给"+i.lastMessage.payload.transferTo.data.name:"已接入来自"+i.lastMessage.senderData.name+"的转接")+" ")]):s("div",{staticClass:"item-info-message"},[t._v("[未识别内容]")])])])])})),0):t._e()]),t.rightClickMenu.visible?s("div",{staticClass:"action-box",style:{left:t.rightClickMenu.x+"px",top:t.rightClickMenu.y+"px"}},[s("div",{staticClass:"action-item",on:{click:t.topConversation}},[t._v(t._s(t.rightClickMenu.conversation.top?"取消置顶":"置顶"))]),s("div",{staticClass:"action-item",on:{click:t.deleteConversation}},[t._v("删除聊天")])]):t._e()]),s("div",{staticClass:"conversation-main"},[s("router-view",{key:t.$route.query.id})],1)])},a=[],n=e("303d"),o={name:"Conversation",data(){return{pendingConversations:[],conversations:[],rightClickMenu:{conversation:null,visible:!1,x:null,y:null},currentAgent:null}},created(){document.addEventListener("click",()=>{this.hideRightClickMenu()}),this.currentAgent=this.global.currentAgent,this.listenConversationUpdate(),this.loadConversations()},beforeDestroy(){this.goEasy.im.off(this.GoEasy.IM_EVENT.CONVERSATIONS_UPDATED,this.renderLatestConversations),this.goEasy.im.off(this.GoEasy.IM_EVENT.PENDING_CONVERSATIONS_UPDATED,this.renderPendingConversations)},methods:{formatDate:n["a"],renderCustomerName(t){return t.mark?t.mark:(-1!==t.name.indexOf("游客")&&t.mobileNumber||t.name,t.mobileNumber)},loadConversations(){this.goEasy.im.pendingConversations({onSuccess:t=>{this.renderPendingConversations(t.content)},onFailed:t=>{console.log("获取待接入列表失败, code:"+t.code+"content:"+t.content)}}),this.goEasy.im.latestConversations({onSuccess:t=>{this.renderLatestConversations(t.content)},onFailed:t=>{console.log("获取已接入列表失败, code:"+t.code+"content:"+t.content)}})},listenConversationUpdate(){this.goEasy.im.on(this.GoEasy.IM_EVENT.CONVERSATIONS_UPDATED,this.renderLatestConversations),this.goEasy.im.on(this.GoEasy.IM_EVENT.PENDING_CONVERSATIONS_UPDATED,this.renderPendingConversations)},renderPendingConversations(t){this.pendingConversations=t.conversations},renderLatestConversations(t){this.conversations=t.conversations},chat(t){this.$router.push({path:"/agent/conversations/chat",query:{id:t}})},showRightClickMenu(t,s){this.rightClickMenu.conversation=s,this.rightClickMenu.visible=!0,this.rightClickMenu.x=t.pageX,this.rightClickMenu.y=t.pageY},hideRightClickMenu(){this.rightClickMenu.visible=!1},topConversation(){let t=this.rightClickMenu.conversation,s=t.top?"取消置顶":"置顶";this.goEasy.im.topConversation({top:!t.top,conversation:t,onSuccess:function(){console.log(s,"成功")},onFailed:function(t){console.log(s,"失败：",t)}})},deleteConversation(){let t=confirm("确认要删除这条会话吗？");!0===t&&this.goEasy.im.removeConversation({conversation:this.rightClickMenu.conversation,onSuccess:function(){console.log("删除会话成功")},onFailed:function(t){console.log(t)}})}}},r=o,c=(e("f0cf"),e("2877")),l=Object(c["a"])(r,i,a,!1,null,"48d2bb10",null);s["default"]=l.exports},"1dee":function(t,s,e){t.exports=e.p+"img/default.f0e98eaa.png"},"303d":function(t,s,e){"use strict";function i(t){t=t||Date.now();let s=new Date(t),e=s.getMonth()<9?"0"+(s.getMonth()+1):s.getMonth()+1;return e+="-",e+=s.getDate()<10?"0"+s.getDate():s.getDate(),e+=" ",e+=s.getHours(),e+=":",e+=s.getMinutes()<10?"0"+s.getMinutes():s.getMinutes(),e}function a(t){const s=600,e=60*s,i=60*e,a=24*i,n=(new Date).getTime(),o=n-t,r=o/s,c=o/e,l=o/i,d=o/a;return d>=1?parseInt(d)+"天":l>=1?parseInt(l)+"小时":c>=1?parseInt(c)+"分钟":r>=1?parseInt(r)+"秒":"0秒"}e.d(s,"a",(function(){return i})),e.d(s,"b",(function(){return a}))},d4e9:function(t,s,e){},f0cf:function(t,s,e){"use strict";e("d4e9")}}]);
//# sourceMappingURL=chunk-a404a7dc.0dd5a778.js.map