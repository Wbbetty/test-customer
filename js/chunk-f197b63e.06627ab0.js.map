{"version":3,"sources":["webpack:///./src/agent/view/Home.vue?a97e","webpack:///./src/agent/images/logo.png","webpack:///./src/agent/api/utils.js","webpack:///./src/agent/api/index.js","webpack:///./src/agent/api/api.js","webpack:///./src/agent/view/Home.vue?b3ee","webpack:///src/agent/view/Home.vue","webpack:///./src/agent/view/Home.vue?55fa","webpack:///./src/agent/view/Home.vue"],"names":["module","exports","Utils","env","VUE_APP_ENV","accessToken","this","getCookie","refreshToken","token","expiresAtMillis","setCookie","name","value","console","log","document","cookie","escape","arr","reg","RegExp","match","unescape","checkAndRefreshToken","xhr","window","XMLHttpRequest","ActiveXObject","url","expiresAt","utils","currentTime","Date","getTime","getRefreshToken","open","setRequestHeader","send","onreadystatechange","readyState","status","result","JSON","parse","responseText","newToken","newRefreshToken","storeTokens","http","a","create","baseURL","timeout","interceptors","request","use","config","getAccessToken","headers","error","Promise","reject","response","data","center","agentBaseUrl","getOTP","method","getWorkerInfo","getContacts","search","updateUserMark","openId","mark","getContact","updateMobileNumber","params","mobileNumber","render","_vm","_c","_self","staticClass","goeasyTeam","attrs","avatar","_v","_s","class","selected","selectedTab","unreadAmount","pendingConversationAmount","_e","currentAgent","on","$event","onlineConfig","visible","online","preventDefault","closeOnlinePopup","offline","staticRenderFns","id","csteam","global","userguid","teamId","goEasy","getConnectionStatus","connectGoEasy","$router","push","path","im","initialOnlineStatus","GoEasy","IM_EVENT","CONVERSATIONS_UPDATED","setUnreadAmount","PENDING_CONVERSATIONS_UPDATED","setPendingConversationAmount","watch","$route","urls","split","immediate","methods","resolve","connect","otp","onSuccess","onFailed","code","content","onProgress","attempts","unreadTotal","conversations","length","isOnline","teamData","agentData","component"],"mappings":"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","file":"js/chunk-f197b63e.06627ab0.js","sourcesContent":["export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--9-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--9-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--9-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--9-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Home.vue?vue&type=style&index=0&id=22a12456&prod&lang=scss&scoped=true&\"","module.exports = __webpack_public_path__ + \"img/logo.897bbe5b.png\";","class Utils {\n\n    getAccessToken() {\n        let env = process.env.VUE_APP_ENV;\n        let accessToken = this.getCookie(`goeasy.token.${env}`);\n        return accessToken;\n    }\n\n    getRefreshToken() {\n        let env = process.env.VUE_APP_ENV;\n        let refreshToken = this.getCookie(`goeasy.refreshToken.${env}`);\n        return refreshToken;\n    }\n\n    storeTokens(token, refreshToken, expiresAtMillis) {\n        let env = process.env.VUE_APP_ENV;\n        this.setCookie(`goeasy.token.${env}`, token);\n        this.setCookie(`goeasy.refreshToken.${env}`, refreshToken);\n        this.setCookie(`goeasy.token.expiresAtMillis.${env}`, expiresAtMillis + \"\");\n    }\n\n    setCookie(name, value) {\n        console.log(\"will set \" + name + \"with value: \" + value);\n        document.cookie = name + \"=\" + escape(value) + \";domain=goeasy.io\";\n    }\n\n\n    getCookie(name) {\n        let arr, reg = new RegExp(\"(^| )\" + name + \"=([^;]*)(;|$)\");\n        if (arr = document.cookie.match(reg)) {\n            return unescape(arr[2]);\n        }\n        return null;\n    }\n}\n\nexport default new Utils();\n\n","import utils from \"./utils\";\nimport axios from 'axios';\n\nconst env = process.env.VUE_APP_ENV;\n\nfunction checkAndRefreshToken() {\n    let xhr;\n    if (window.XMLHttpRequest) {\n        xhr = new XMLHttpRequest();\n    } else {\n        xhr = new ActiveXObject(\"Microsoft.XMLHttp\")\n    }\n    let url = `https://${env}sso.goeasy.io`;\n    let expiresAt = utils.getCookie(`goeasy.token.expiresAtMillis.${env}`);\n    let currentTime = new Date().getTime();\n    if (xhr && expiresAt - currentTime < 3600 * 1000) {//less than 1 hour\n        let refreshToken = utils.getRefreshToken();\n        xhr.open(\"post\", url + \"/refreshtoken\", true);\n        xhr.setRequestHeader('content-type', 'application/x-www-form-urlencoded');\n        xhr.send(\"refreshToken=\" + refreshToken);\n        xhr.onreadystatechange = function () {\n            if (xhr.readyState === 4) {\n                if (xhr.status === 200) {\n                    let result = JSON.parse(xhr.responseText);\n                    let newToken = result.token;\n                    let newRefreshToken = result.refreshToken;\n                    let expiresAtMillis = result.expiresAtMillis;\n                    utils.storeTokens(newToken, newRefreshToken, expiresAtMillis);\n                } else {\n                    // console.log(\"xxxx error: \", xhr.status)\n                }\n            } else {\n                // console.log(xhr.status);\n            }\n        }\n    }\n}\n\nconst http = axios.create({\n    baseURL: '',\n    timeout: 60000\n});\n\n// 请求拦截器\nhttp.interceptors.request.use((config) => {\n    checkAndRefreshToken();\n    const token = utils.getAccessToken();\n    if (token) {\n        config.headers['Authorization'] = \"Bearer \" + token\n    }\n    return config;\n}, (error) => {\n    return Promise.reject(error);\n});\n\n// 响应拦截器\nhttp.interceptors.response.use((response) => {\n    return response.data;\n}, (error) => {\n    return Promise.reject(error);\n});\n\nexport default http;\n","import http from \"./index\";\n\nlet env = process.env.VUE_APP_ENV;\nconst center = `https://${env}center.goeasy.io/api/v1`;\nconst agentBaseUrl = `https://${env}center.goeasy.io/api/v2/cs-agent`;\n\nexport function getOTP() {\n    let url =`${agentBaseUrl}/otp`;\n    return http({\n        url: url,\n        method: \"POST\"\n    })\n}\n\nexport function getWorkerInfo() {\n    let url = `${center}/admin/currentuser`;\n    return http({\n        url: url,\n        method: 'GET'\n    })\n}\n\nexport function getContacts(search) {\n    let url = `${agentBaseUrl}/contacts`;\n    return http({\n        url: url,\n        data: {\n            search: search\n        },\n        method: 'POST'\n    })\n}\n\nexport function updateUserMark(openId, mark) {\n    let url = `${agentBaseUrl}/contacts/${openId}/mark`;\n    return http({\n        url: url,\n        data: {\n            mark: mark\n        },\n        method: 'POST'\n    })\n}\n\nexport function getContact(openId) {\n    let url = `${agentBaseUrl}/contacts/${openId}`;\n    return http({\n        url: url,\n        method: 'GET'\n    })\n}\n\nexport function updateMobileNumber(params) {\n    let url = `${agentBaseUrl}/contacts/${params.openId}/mobile-number`;\n    return http({\n        url: url,\n        data: {\n            mobileNumber: params.mobileNumber\n        },\n        method: 'POST'\n    })\n}","var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{staticClass:\"home\"},[_c('div',{staticClass:\"home-container\"},[_c('div',{staticClass:\"home-menu\"},[_c('div',{staticClass:\"menu-header\"},[(_vm.goeasyTeam.data.avatar)?_c('img',{staticClass:\"shop-avatar\",attrs:{\"src\":_vm.goeasyTeam.data.avatar}}):_c('img',{staticClass:\"shop-avatar\",attrs:{\"src\":require(\"../images/logo.png\")}}),_c('div',{staticClass:\"team-info\"},[_vm._v(\" \"+_vm._s(_vm.goeasyTeam.data.name)+\" \")])]),_c('div',{staticClass:\"menu-box\"},[_c('div',{staticClass:\"menu-list\"},[_c('div',{staticClass:\"menu-item\"},[_c('router-link',{attrs:{\"tag\":\"span\",\"to\":\"/agent/conversations\"}},[_c('i',{staticClass:\"iconfont icon-zaixiankefu\",class:{ selected: _vm.selectedTab === 'conversations'}})]),(_vm.unreadAmount + _vm.pendingConversationAmount)?_c('span',{staticClass:\"menu-unread\"},[_vm._v(_vm._s(_vm.unreadAmount + _vm.pendingConversationAmount))]):_vm._e()],1),_c('div',{staticClass:\"menu-item\"},[_c('router-link',{attrs:{\"tag\":\"span\",\"to\":\"/agent/customers\"}},[_c('i',{staticClass:\"iconfont icon-haoyou\",class:{ selected: _vm.selectedTab === 'customers' }})])],1)]),(_vm.currentAgent)?_c('div',{staticClass:\"agent-info\"},[_c('img',{staticClass:\"agent-avatar\",attrs:{\"src\":_vm.currentAgent.avatar},on:{\"click\":function($event){_vm.onlineConfig.visible = !_vm.onlineConfig.visible}}}),_c('span',{class:_vm.onlineConfig.online ?'spot online':'spot offline'}),_c('div',{staticClass:\"agent-name\"},[_vm._v(_vm._s(_vm.currentAgent.name))])]):_vm._e(),(_vm.onlineConfig.visible)?_c('div',{staticClass:\"action-wrap\",on:{\"click\":function($event){$event.preventDefault();return _vm.closeOnlinePopup()}}},[(_vm.onlineConfig.visible)?_c('div',{staticClass:\"action-box\"},[(_vm.onlineConfig.online)?_c('div',{staticClass:\"action-item\",on:{\"click\":_vm.offline}},[_vm._v(\"下线\")]):_c('div',{staticClass:\"action-item\",on:{\"click\":_vm.online}},[_vm._v(\"上线\")])]):_vm._e()]):_vm._e()])]),_c('div',{staticClass:\"home-main\"},[_c('router-view')],1)])])\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div class=\"home\">\n    <div class=\"home-container\">\n      <div class=\"home-menu\">\n        <div class=\"menu-header\">\n          <img v-if=\"goeasyTeam.data.avatar\" class=\"shop-avatar\" :src=\"goeasyTeam.data.avatar\"/>\n          <img v-else class=\"shop-avatar\" src=\"../images/logo.png\"/>\n          <div class=\"team-info\">\n            {{goeasyTeam.data.name}}\n          </div>\n        </div>\n        <div class=\"menu-box\">\n          <div class=\"menu-list\">\n            <div class=\"menu-item\">\n              <router-link tag=\"span\" to=\"/agent/conversations\">\n                <i\n                  class=\"iconfont icon-zaixiankefu\"\n                  :class=\"{ selected: selectedTab === 'conversations'}\"\n                ></i>\n              </router-link>\n              <span v-if=\"unreadAmount + pendingConversationAmount\" class=\"menu-unread\">{{ unreadAmount + pendingConversationAmount }}</span>\n            </div>\n            <div class=\"menu-item\">\n              <router-link tag=\"span\" to=\"/agent/customers\">\n                <i\n                  class=\"iconfont icon-haoyou\"\n                  :class=\"{ selected: selectedTab === 'customers' }\"\n                ></i>\n              </router-link>\n            </div>\n          </div>\n          <div v-if=\"currentAgent\" class=\"agent-info\">\n            <img class=\"agent-avatar\" :src=\"currentAgent.avatar\"\n                 @click=\"onlineConfig.visible = !onlineConfig.visible\"/>\n            <span :class=\"onlineConfig.online ?'spot online':'spot offline'\"></span>\n            <div class=\"agent-name\">{{currentAgent.name}}</div>\n          </div>\n          <div @click.prevent=\"closeOnlinePopup()\" class=\"action-wrap\" v-if=\"onlineConfig.visible\">\n            <div class=\"action-box\" v-if=\"onlineConfig.visible\">\n              <div v-if=\"onlineConfig.online\" class=\"action-item\" @click=\"offline\">下线</div>\n              <div v-else class=\"action-item\" @click=\"online\">上线</div>\n            </div>\n          </div>\n        </div>\n      </div>\n      <div class=\"home-main\">\n        <router-view/>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\n  // 引入阿里字体图标\n  import '../assets/iconfont/iconfont.css';\n  import {getOTP, getWorkerInfo} from \"../api/api\";\n\n  export default {\n    name: 'Home',\n    data() {\n      return {\n        goeasyTeam: {\n          id: 'goeasy-customer-support',\n          data: {\n            name:'GoEasy Support Team',\n            avatar: \"\"\n          },\n        },\n        csteam: null,\n        currentAgent: null,\n        selectedTab: \"\",\n        unreadAmount: 0,\n        pendingConversationAmount: 0,\n\n        onlineConfig: {\n          visible: false,\n          online: false\n        }\n      };\n    },\n    async created() {\n\n      let data = await getWorkerInfo();\n\n      this.global.currentAgent = {\n        id: data.data.userguid,\n        name: data.data.name,\n        avatar: data.data.avatar,\n        teamId: this.goeasyTeam.id\n      };\n\n      this.currentAgent = this.global.currentAgent;\n\n      if (this.goEasy.getConnectionStatus() === 'disconnected') {\n        await this.connectGoEasy();\n        this.$router.push({\n          path: \"/agent/conversations\"\n        });\n      }\n      this.csteam = this.goEasy.im.csteam(this.goeasyTeam.id);\n      this.initialOnlineStatus();\n      this.goEasy.im.on(this.GoEasy.IM_EVENT.CONVERSATIONS_UPDATED, this.setUnreadAmount);\n      this.goEasy.im.on(this.GoEasy.IM_EVENT.PENDING_CONVERSATIONS_UPDATED, this.setPendingConversationAmount);\n    },\n    watch: {\n      $route: {\n        handler() {\n          let path = this.$route.path;\n          let urls = path.split(\"/\");\n          this.selectedTab = urls[2];\n        },\n        immediate: true,\n      }\n    },\n    methods: {\n      async connectGoEasy() {\n        let data = await getOTP();\n        return new Promise((resolve, reject) => {\n          this.goEasy.connect({\n            id: this.currentAgent.id,\n            data: {name: this.currentAgent.name, avatar: this.currentAgent.avatar},\n            otp: data.data,\n            onSuccess: () => {\n              console.log(\"GoEasy connect successfully.\")\n              resolve();\n            },\n            onFailed: (error) => {\n              console.log(\"Failed to connect GoEasy, code:\" + error.code + \",error:\" + error.content);\n              reject(error);\n            },\n            onProgress: (attempts) => {\n              console.log(\"GoEasy is connecting\", attempts);\n            }\n          });\n        });\n      },\n      setUnreadAmount(content) {\n        this.unreadAmount = content.unreadTotal;\n      },\n      setPendingConversationAmount(content) {\n        this.pendingConversationAmount = content.conversations.length;\n      },\n      initialOnlineStatus() {\n        this.csteam.isOnline({\n          onSuccess: (result) => {\n            this.onlineConfig.online = result.content;\n          },\n          onFailed: (error) => {\n            console.log('获取在线状态失败，error:', error)\n          }\n        })\n      },\n      offline() {\n        this.csteam.offline({\n          onSuccess: () => {\n            this.onlineConfig.online = false;\n            this.onlineConfig.visible = false;\n          },\n          onFailed: (error) => {\n            console.log('下线失败,error:', error);\n          }\n        })\n      },\n      online() {\n        this.csteam.online({\n          teamData: {name: this.goeasyTeam.name, avatar: this.goeasyTeam.avatar},\n          agentData: {name: this.currentAgent.name, avatar: this.currentAgent.avatar},\n          onSuccess: () => {\n            this.onlineConfig.online = true;\n          },\n          onFailed: (error) => {\n            console.log('上线失败,error:', error);\n          }\n        })\n      },\n      closeOnlinePopup() {\n        this.onlineConfig.visible = false;\n      }\n    },\n  };\n</script>\n\n<style lang=\"scss\" scoped>\n  .home {\n\n    .home-container {\n      position: fixed;\n      left: 50%;\n      top: 50%;\n      transform: translate(-50%, -50%);\n      z-index: 1000;\n\n      width: 850px;\n      height: 600px;\n      background: #FFFFFF;\n      display: flex;\n      box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);\n\n      .home-menu {\n        width: 80px;\n        background-color: #F7F7F7;\n        border-right: 1px solid #eeeeee;\n        display: flex;\n        flex-direction: column;\n        align-items: center;\n\n        .shop-avatar {\n          width: 50px;\n          height: 50px;\n          border-radius: 10px;\n        }\n\n        .menu-header {\n          position: relative;\n          margin: 20px auto;\n          cursor: pointer;\n        }\n\n        .menu-header:hover .team-info {\n          display: block;\n          text-decoration: none;\n        }\n\n        .team-info {\n          display: none;\n          position: absolute;\n          bottom: -20px;\n          left: 0;\n          right: 0;\n          z-index: 1;\n\n          width: 100px;\n          padding: 0 8px;\n\n          border: 0.5px solid hsla(0, 9%, 39%, .15);\n          border-radius: 4px;\n          box-sizing: border-box;\n\n          overflow: hidden;\n          text-overflow: ellipsis;\n          white-space: nowrap;\n          font-size: 12px;\n          color: rgba(0, 0, 0, .5);\n        }\n\n        .menu-box {\n          padding: 40px 0;\n          flex: 1;\n          display: flex;\n          flex-direction: column;\n          justify-content: space-between;\n          align-items: center;\n        }\n\n        .menu-list {\n          display: flex;\n          flex-direction: column;\n          align-items: center;\n\n          .iconfont {\n            padding: 15px;\n            font-size: 28px;\n            color: #606266;\n          }\n\n          .menu-item {\n            color: #303133;\n            cursor: pointer;\n            box-sizing: border-box;\n            height: 56px;\n            position: relative;\n          }\n\n          .menu-unread {\n            position: absolute;\n            top: -5px;\n            right: 5px;\n            width: 18px;\n            height: 18px;\n            line-height: 18px;\n            text-align: center;\n            border-radius: 50%;\n            background-color: #fa5151;\n            color: #ffffff;\n          }\n\n          .selected {\n            color: #d02129 !important;\n          }\n\n        }\n\n        .agent-info:hover .agent-name {\n          visibility: visible;\n          text-decoration: none;\n        }\n\n        .agent-info {\n          position: relative;\n\n          .agent-avatar {\n            width: 45px;\n            height: 45px;\n            border-radius: 50%;\n            position: relative;\n            cursor: pointer;\n          }\n\n          .spot {\n            position: absolute;\n            left: 34px;\n            top: 34px;\n            width: 10px;\n            height: 10px;\n            border-radius: 50%;\n          }\n\n          .online {\n            background-color: #56d547;\n          }\n\n          .offline {\n            background-color: #999999;\n          }\n\n          .agent-name {\n            visibility: hidden;\n            position: absolute;\n            top: 32px;\n            bottom: 0px;\n            left: 32px;\n            right: 0;\n            border: .5px solid hsla(0, 9%, 39%, .15);\n            border-radius: 4px;\n            width: fit-content;\n            max-width: 120px;\n            height: 24px;\n            line-height: 24px;\n            padding: 0 8px;\n            overflow: hidden;\n            text-overflow: ellipsis;\n            white-space: nowrap;\n            box-sizing: border-box;\n            word-wrap: break-word;\n            background: #fff;\n            color: rgba(0, 0, 0, .5);\n            font-size: 12px;\n            font-weight: 400;\n            transition: all 0.4s 0.4s;\n          }\n\n          .action-box {\n            position: absolute;\n            left: 78px;\n            bottom: 40px;\n            width: 100px;\n            height: 100px;\n            background: #fff;\n            border-radius: 10px;\n            font-size: 14px;\n            text-align: center;\n            z-index: 3;\n            box-shadow: 2px 8px 20px #999999;\n\n            .action-item {\n              height: 50px;\n              display: flex;\n              align-items: center;\n              justify-content: center;\n\n              &\n              :hover {\n                cursor: pointer;\n              }\n\n            }\n          }\n        }\n\n        .action-wrap {\n          position: absolute;\n          top: 0;\n          left: 0;\n          right: 0;\n          bottom: 0;\n          z-index: 2;\n\n          .action-box {\n            position: absolute;\n            left: 80px;\n            bottom: 40px;\n            width: 100px;\n            background: #fff;\n            border-radius: 10px;\n            font-size: 14px;\n            text-align: center;\n            z-index: 3;\n            box-shadow: 2px 8px 20px #999999;\n\n            .action-item {\n              height: 50px;\n              display: flex;\n              align-items: center;\n              justify-content: center;\n              cursor: pointer;\n\n              &\n              :hover {\n                cursor: pointer;\n              }\n\n            }\n          }\n        }\n      }\n\n      .home-main {\n        padding: 0;\n        flex: 1;\n      }\n\n    }\n  }\n\n  .consult-customer-service {\n    position: fixed;\n    bottom: 40px;\n    left: 30px;\n    z-index: 10;\n    display: flex;\n    flex-direction: column;\n    width: 64px;\n    margin: 0 30px 26px 0;\n    box-sizing: border-box;\n    border-radius: 3px;\n  }\n\n  .consult-customer-service-avatar {\n    padding: 10px;\n    cursor: pointer;\n    border-radius: 100%;\n    transition: all 0.2s;\n    background: #D02129;\n  }\n\n  .consult-customer-service-avatar:hover {\n    transform: scale(1.1);\n  }\n</style>\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Home.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Home.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Home.vue?vue&type=template&id=22a12456&scoped=true&\"\nimport script from \"./Home.vue?vue&type=script&lang=js&\"\nexport * from \"./Home.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Home.vue?vue&type=style&index=0&id=22a12456&prod&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"22a12456\",\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}