{"version":3,"sources":["webpack:///./src/agent/view/Home.vue?0501","webpack:///./src/agent/api/api.ts","webpack:///./src/agent/images/logo.png","webpack:///./src/agent/view/Home.vue?caa5","webpack:///src/agent/view/Home.vue","webpack:///./src/agent/view/Home.vue?55fa","webpack:///./src/agent/view/Home.vue","webpack:///./src/agent/api/http.ts"],"names":["Object","defineProperty","exports","value","http_1","API","config","this","http","default","center","concat","rest_host","agentBaseUrl","prototype","getOTP","url","call","method","getWorkerInfo","getContacts","search","data","updateUserMark","openId","mark","getContact","updateMobileNumber","params","mobileNumber","getWelcome","module","render","_vm","_c","_self","staticClass","goeasyTeam","attrs","avatar","_v","_s","name","class","selected","selectedTab","unreadAmount","pendingConversationAmount","_e","currentAgent","on","$event","onlineConfig","visible","online","preventDefault","closeOnlinePopup","offline","version","staticRenderFns","id","csteam","JSON","parse","$route","query","cs_agent_config","global","api","goEasy","getInstance","host","goEasy_host","appkey","goEasy_appKey","modules","GoEasy","welcome","userguid","teamId","getConnectionStatus","connectGoEasy","$router","push","path","im","initialOnlineStatus","initListeners","watch","urls","split","immediate","methods","document","addEventListener","hidden","callParentFunction","IM_EVENT","CONVERSATIONS_UPDATED","onConversationUpdate","PENDING_CONVERSATIONS_UPDATED","onPendingConversationUpdate","Promise","resolve","reject","connect","otp","onSuccess","console","log","onFailed","error","code","content","onProgress","attempts","unreadTotal","sendNotification","conversations","length","visibilityState","notification","title","body","functionName","parameters","targetOrigin","referrer","window","parent","postMessage","isOnline","result","alert","teamData","agentData","component","axios_1","Http","_this","cookie_token_key","sso_cookie_suffix","cookie_refresh_token_key","cookie_expiresAtMillis_key","create","baseURL","timeout","interceptors","request","use","checkAndRefreshToken","token","getAccessToken","headers","response","xhr","XMLHttpRequest","ActiveXObject","expiresAt","getExpiresAtMillis","currentTime","Date","getTime","refreshToken","getRefreshToken","open","sso_host","setRequestHeader","send","onreadystatechange","readyState","status","responseText","newToken","newRefreshToken","expiresAtMillis","storeTokens","getCookie","setCookie","cookie","escape","arr","reg","RegExp","match","unescape"],"mappings":"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","file":"js/chunk-3a304d11.2ce6f39c.js","sourcesContent":["export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--9-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--9-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--9-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--9-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Home.vue?vue&type=style&index=0&id=2e79c718&prod&lang=scss&scoped=true&\"","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar http_1 = require(\"./http\");\nvar API = (function () {\n    function API(config) {\n        this.config = config;\n        this.http = new http_1.default(config);\n        this.center = \"\".concat(config.rest_host, \"/api/v1\");\n        this.agentBaseUrl = \"\".concat(config.rest_host, \"/api/v2/cs-agent\");\n    }\n    API.prototype.getOTP = function () {\n        var url = \"\".concat(this.agentBaseUrl, \"/otp\");\n        return this.http.call({\n            url: url,\n            method: \"POST\"\n        });\n    };\n    API.prototype.getWorkerInfo = function () {\n        var url = \"\".concat(this.center, \"/admin/currentuser\");\n        return this.http.call({\n            url: url,\n            method: 'GET'\n        });\n    };\n    API.prototype.getContacts = function (search) {\n        var url = \"\".concat(this.agentBaseUrl, \"/contacts\");\n        return this.http.call({\n            url: url,\n            data: {\n                search: search\n            },\n            method: 'POST'\n        });\n    };\n    API.prototype.updateUserMark = function (openId, mark) {\n        var url = \"\".concat(this.agentBaseUrl, \"/contacts/\").concat(openId, \"/mark\");\n        return this.http.call({\n            url: url,\n            data: {\n                mark: mark\n            },\n            method: 'POST'\n        });\n    };\n    API.prototype.getContact = function (openId) {\n        var url = \"\".concat(this.agentBaseUrl, \"/contacts/\").concat(openId);\n        return this.http.call({\n            url: url,\n            method: 'GET'\n        });\n    };\n    API.prototype.updateMobileNumber = function (params) {\n        var url = \"\".concat(this.agentBaseUrl, \"/contacts/\").concat(params.openId, \"/mobile-number\");\n        return this.http.call({\n            url: url,\n            data: {\n                mobileNumber: params.mobileNumber\n            },\n            method: 'POST'\n        });\n    };\n    API.prototype.getWelcome = function () {\n        var url = \"\".concat(this.agentBaseUrl, \"/mywelcome\");\n        return this.http.call({\n            url: url,\n            method: 'GET'\n        });\n    };\n    return API;\n}());\nexports.default = API;\n","module.exports = __webpack_public_path__ + \"img/logo.897bbe5b.png\";","var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{staticClass:\"home\"},[_c('div',{staticClass:\"home-container\"},[_c('div',{staticClass:\"home-menu\"},[_c('div',{staticClass:\"menu-header\"},[(_vm.goeasyTeam.data.avatar)?_c('img',{staticClass:\"shop-avatar\",attrs:{\"src\":_vm.goeasyTeam.data.avatar}}):_c('img',{staticClass:\"shop-avatar\",attrs:{\"src\":require(\"../images/logo.png\")}}),_c('div',{staticClass:\"team-info\"},[_vm._v(\" \"+_vm._s(_vm.goeasyTeam.data.name)+\" \")])]),_c('div',{staticClass:\"menu-box\"},[_c('div',{staticClass:\"menu-list\"},[_c('div',{staticClass:\"menu-item\"},[_c('router-link',{attrs:{\"tag\":\"span\",\"to\":\"/agent/conversations\"}},[_c('i',{staticClass:\"iconfont icon-zaixiankefu\",class:{ selected: _vm.selectedTab === 'conversations'}})]),(_vm.unreadAmount + _vm.pendingConversationAmount)?_c('span',{staticClass:\"menu-unread\"},[_vm._v(_vm._s(_vm.unreadAmount + _vm.pendingConversationAmount))]):_vm._e()],1),_c('div',{staticClass:\"menu-item\"},[_c('router-link',{attrs:{\"tag\":\"span\",\"to\":\"/agent/customers\"}},[_c('i',{staticClass:\"iconfont icon-haoyou\",class:{ selected: _vm.selectedTab === 'customers' }})])],1)]),(_vm.currentAgent)?_c('div',{staticClass:\"agent-info\"},[_c('img',{staticClass:\"agent-avatar\",attrs:{\"src\":_vm.currentAgent.avatar},on:{\"click\":function($event){_vm.onlineConfig.visible = !_vm.onlineConfig.visible}}}),_c('span',{class:_vm.onlineConfig.online ?'spot online':'spot offline'}),_c('div',{staticClass:\"agent-name\"},[_vm._v(_vm._s(_vm.currentAgent.name))])]):_vm._e(),(_vm.onlineConfig.visible)?_c('div',{staticClass:\"action-wrap\",on:{\"click\":function($event){$event.preventDefault();return _vm.closeOnlinePopup()}}},[(_vm.onlineConfig.visible)?_c('div',{staticClass:\"action-box\"},[_c('div',{staticClass:\"action-item\",on:{\"click\":_vm.online}},[_c('div',{class:_vm.onlineConfig.online ? 'checked': 'action-title'},[_vm._v(\"客服在线\")]),_c('div',{staticClass:\"action-detail\"},[_vm._v(\"接收客服消息通知\")])]),_c('div',{staticClass:\"action-item\",on:{\"click\":_vm.offline}},[_c('div',{class:!_vm.onlineConfig.online ? 'checked': 'action-title'},[_vm._v(\"客服离线\")]),_c('div',{staticClass:\"action-detail\"},[_vm._v(\"不接收客服消息通知\")])])]):_vm._e()]):_vm._e()]),_c('div',{staticClass:\"version\"},[_vm._v(_vm._s(_vm.version))])]),_c('div',{staticClass:\"home-main\"},[_c('router-view')],1)])])\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div class=\"home\">\n    <div class=\"home-container\">\n      <div class=\"home-menu\">\n        <div class=\"menu-header\">\n          <img v-if=\"goeasyTeam.data.avatar\" class=\"shop-avatar\" :src=\"goeasyTeam.data.avatar\"/>\n          <img v-else class=\"shop-avatar\" src=\"../images/logo.png\"/>\n          <div class=\"team-info\">\n            {{goeasyTeam.data.name}}\n          </div>\n        </div>\n        <div class=\"menu-box\">\n          <div class=\"menu-list\">\n            <div class=\"menu-item\">\n              <router-link tag=\"span\" to=\"/agent/conversations\">\n                <i\n                  class=\"iconfont icon-zaixiankefu\"\n                  :class=\"{ selected: selectedTab === 'conversations'}\"\n                ></i>\n              </router-link>\n              <span v-if=\"unreadAmount + pendingConversationAmount\" class=\"menu-unread\">{{ unreadAmount + pendingConversationAmount }}</span>\n            </div>\n            <div class=\"menu-item\">\n              <router-link tag=\"span\" to=\"/agent/customers\">\n                <i\n                  class=\"iconfont icon-haoyou\"\n                  :class=\"{ selected: selectedTab === 'customers' }\"\n                ></i>\n              </router-link>\n            </div>\n          </div>\n          <div v-if=\"currentAgent\" class=\"agent-info\">\n            <img class=\"agent-avatar\" :src=\"currentAgent.avatar\"\n                 @click=\"onlineConfig.visible = !onlineConfig.visible\"/>\n            <span :class=\"onlineConfig.online ?'spot online':'spot offline'\"></span>\n            <div class=\"agent-name\">{{currentAgent.name}}</div>\n          </div>\n          <div v-if=\"onlineConfig.visible\" class=\"action-wrap\" @click.prevent=\"closeOnlinePopup()\">\n            <div v-if=\"onlineConfig.visible\" class=\"action-box\">\n              <div class=\"action-item\" @click=\"online\">\n                <div :class=\"onlineConfig.online ? 'checked': 'action-title'\">客服在线</div>\n                <div class=\"action-detail\">接收客服消息通知</div>\n              </div>\n              <div class=\"action-item\" @click=\"offline\">\n                <div :class=\"!onlineConfig.online ? 'checked': 'action-title'\">客服离线</div>\n                <div class=\"action-detail\">不接收客服消息通知</div>\n              </div>\n            </div>\n          </div>\n        </div>\n        <div class=\"version\">{{ version }}</div>\n      </div>\n      <div class=\"home-main\">\n        <router-view/>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\n  // 引入阿里字体图标\n  import '../assets/iconfont/iconfont.css';\n  import API from \"../api/api\";\n  import GoEasy from \"../../lib/goeasy-2.5.3.min\";\n  import { version } from '../../../package.json'\n\n  export default {\n    name: 'Home',\n    data() {\n      return {\n        version: version,\n        goeasyTeam: {\n          id: 'goeasy-customer-support',\n          data: {\n            name:'GoEasy Support Team',\n            avatar: \"\"\n          },\n        },\n        csteam: null,\n        currentAgent: null,\n        selectedTab: \"\",\n        unreadAmount: 0,\n        pendingConversationAmount: 0,\n\n        onlineConfig: {\n          visible: false,\n          online: false\n        }\n      };\n    },\n    async created() {\n      let config = JSON.parse(this.$route.query.cs_agent_config);\n      this.global.api = new API(config);\n      let goEasy = GoEasy.getInstance({\n        host: config.goEasy_host,\n        appkey: config.goEasy_appKey,\n        modules: [\"im\"]\n      });\n      this.global.GoEasy = GoEasy;\n      this.global.goEasy = goEasy;\n\n      let data = await this.global.api.getWorkerInfo();\n      let welcome = await this.global.api.getWelcome();\n      this.global.welcome = welcome.data;\n      this.global.currentAgent = {\n        id: data.data.userguid,\n        name: data.data.name,\n        avatar: data.data.avatar,\n        teamId: this.goeasyTeam.id\n      };\n\n      this.currentAgent = this.global.currentAgent;\n\n      if (this.global.goEasy.getConnectionStatus() === 'disconnected') {\n        await this.connectGoEasy();\n        this.$router.push({\n          path: \"/agent/conversations\"\n        });\n      }\n      this.csteam = this.global.goEasy.im.csteam(this.goeasyTeam.id);\n      this.initialOnlineStatus();\n      this.initListeners();\n    },\n    watch: {\n      $route: {\n        handler() {\n          let path = this.$route.path;\n          let urls = path.split(\"/\");\n          this.selectedTab = urls[2];\n        },\n        immediate: true,\n      }\n    },\n    methods: {\n      initListeners () {\n        document.addEventListener('visibilitychange', () => {\n          if (!document.hidden) {\n            this.callParentFunction('clearNotificationTitle');\n          }\n        });\n        this.global.goEasy.im.on(this.global.GoEasy.IM_EVENT.CONVERSATIONS_UPDATED, this.onConversationUpdate);\n        this.global.goEasy.im.on(this.global.GoEasy.IM_EVENT.PENDING_CONVERSATIONS_UPDATED, this.onPendingConversationUpdate);\n      },\n      async connectGoEasy() {\n        let data = await this.global.api.getOTP();\n        return new Promise((resolve, reject) => {\n          this.global.goEasy.connect({\n            id: this.currentAgent.id,\n            data: {name: this.currentAgent.name, avatar: this.currentAgent.avatar},\n            otp: data.data,\n            onSuccess: () => {\n              console.log(\"GoEasy connect successfully.\")\n              resolve();\n            },\n            onFailed: (error) => {\n              console.log(\"Failed to connect GoEasy, code:\" + error.code + \",error:\" + error.content);\n              reject(error);\n            },\n            onProgress: (attempts) => {\n              console.log(\"GoEasy is connecting\", attempts);\n            }\n          });\n        });\n      },\n      onConversationUpdate(content) {\n        if (content.unreadTotal > this.unreadAmount ) {\n          this.sendNotification();\n          this.callParentFunction('showPopup');\n        }\n        this.unreadAmount = content.unreadTotal;\n      },\n      onPendingConversationUpdate(content) {\n        if (content.conversations.length > this.pendingConversationAmount ) {\n          this.sendNotification();\n          this.callParentFunction('showPopup');\n        }\n        this.pendingConversationAmount = content.conversations.length;\n      },\n      sendNotification () {\n        if (document.visibilityState === 'visible') {\n          return\n        }\n        const notification = {\n          title: 'GoEasy Agent',\n          body: '您有一条新的消息'\n        }\n        this.callParentFunction('createNotification',notification);\n      },\n      callParentFunction (functionName, parameters) {\n        const targetOrigin = document.referrer;\n        window.parent.postMessage({\n          'function': functionName,\n          'parameters': parameters,\n        }, targetOrigin);\n      },\n      initialOnlineStatus() {\n        this.csteam.isOnline({\n          onSuccess: (result) => {\n            this.onlineConfig.online = result;\n          },\n          onFailed: (error) => {\n            console.log('获取在线状态失败，error:', error)\n          }\n        })\n      },\n      offline() {\n        this.csteam.offline({\n          onSuccess: () => {\n            this.onlineConfig.online = false;\n            this.onlineConfig.visible = false;\n          },\n          onFailed: (error) => {\n            if (error.content===\"Please end your accepted conversations first\") {\n              alert(`下线失败,请先结束已接入的会话！`);\n            }\n            console.log('下线失败,error:', error);\n          }\n        })\n      },\n      online() {\n        this.csteam.online({\n          teamData: {name: this.goeasyTeam.name, avatar: this.goeasyTeam.avatar},\n          agentData: {name: this.currentAgent.name, avatar: this.currentAgent.avatar},\n          onSuccess: () => {\n            this.onlineConfig.online = true;\n          },\n          onFailed: (error) => {\n            console.log('上线失败,error:', error);\n          }\n        })\n      },\n      closeOnlinePopup() {\n        this.onlineConfig.visible = false;\n      }\n    },\n  };\n</script>\n\n<style lang=\"scss\" scoped>\n  .home {\n\n    .home-container {\n      position: fixed;\n      left: 50%;\n      top: 50%;\n      transform: translate(-50%, -50%);\n      z-index: 1000;\n\n      width: 850px;\n      height: 600px;\n      background: #FFFFFF;\n      display: flex;\n      box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);\n\n      .home-menu {\n        width: 80px;\n        background-color: #F7F7F7;\n        border-right: 1px solid #eeeeee;\n        display: flex;\n        flex-direction: column;\n        align-items: center;\n        position: relative;\n\n        .version {\n          position: absolute;\n          color: #666666;\n          font-size: 12px;\n          bottom: 14px;\n        }\n\n        .shop-avatar {\n          width: 50px;\n          height: 50px;\n          border-radius: 10px;\n        }\n\n        .menu-header {\n          position: relative;\n          margin: 20px auto;\n          cursor: pointer;\n        }\n\n        .menu-header:hover .team-info {\n          display: block;\n          text-decoration: none;\n        }\n\n        .team-info {\n          display: none;\n          position: absolute;\n          bottom: -20px;\n          left: 0;\n          right: 0;\n          z-index: 1;\n\n          width: 100px;\n          padding: 0 8px;\n\n          border: 0.5px solid hsla(0, 9%, 39%, .15);\n          border-radius: 4px;\n          box-sizing: border-box;\n\n          overflow: hidden;\n          text-overflow: ellipsis;\n          white-space: nowrap;\n          font-size: 12px;\n          color: rgba(0, 0, 0, .5);\n        }\n\n        .menu-box {\n          padding: 40px 0;\n          flex: 1;\n          display: flex;\n          flex-direction: column;\n          justify-content: space-between;\n          align-items: center;\n        }\n\n        .menu-list {\n          display: flex;\n          flex-direction: column;\n          align-items: center;\n\n          .iconfont {\n            padding: 15px;\n            font-size: 28px;\n            color: #606266;\n          }\n\n          .menu-item {\n            color: #303133;\n            cursor: pointer;\n            box-sizing: border-box;\n            height: 56px;\n            position: relative;\n          }\n\n          .menu-unread {\n            position: absolute;\n            top: -5px;\n            right: 5px;\n            width: 18px;\n            height: 18px;\n            line-height: 18px;\n            text-align: center;\n            border-radius: 50%;\n            background-color: #fa5151;\n            color: #ffffff;\n          }\n\n          .selected {\n            color: #d02129 !important;\n          }\n\n        }\n\n        .agent-info:hover .agent-name {\n          visibility: visible;\n          text-decoration: none;\n        }\n\n        .agent-info {\n          position: relative;\n\n          .agent-avatar {\n            width: 45px;\n            height: 45px;\n            border-radius: 50%;\n            position: relative;\n            cursor: pointer;\n          }\n\n          .spot {\n            position: absolute;\n            left: 34px;\n            top: 34px;\n            width: 10px;\n            height: 10px;\n            border-radius: 50%;\n          }\n\n          .online {\n            background-color: #56d547;\n          }\n\n          .offline {\n            background-color: #999999;\n          }\n\n          .agent-name {\n            visibility: hidden;\n            position: absolute;\n            top: 32px;\n            bottom: 0px;\n            left: 32px;\n            right: 0;\n            border: .5px solid hsla(0, 9%, 39%, .15);\n            border-radius: 4px;\n            width: fit-content;\n            max-width: 120px;\n            height: 24px;\n            line-height: 24px;\n            padding: 0 8px;\n            overflow: hidden;\n            text-overflow: ellipsis;\n            white-space: nowrap;\n            box-sizing: border-box;\n            word-wrap: break-word;\n            background: #fff;\n            color: rgba(0, 0, 0, .5);\n            font-size: 12px;\n            font-weight: 400;\n            transition: all 0.4s 0.4s;\n          }\n        }\n\n        .action-wrap {\n          position: absolute;\n          top: 0;\n          left: 0;\n          right: 0;\n          bottom: 0;\n          z-index: 2;\n\n          .action-box {\n            position: absolute;\n            left: 80px;\n            bottom: 40px;\n            width: 150px;\n            padding: 0 10px;\n            background: #fff;\n            border-radius: 10px;\n            font-size: 14px;\n            z-index: 3;\n            box-shadow: 2px 8px 20px #999999;\n\n            .action-item {\n              display: flex;\n              flex-direction: column;\n              border-bottom: 1px solid #efeeee;\n              padding: 5px 0;\n\n              &\n              :hover {\n                cursor: pointer;\n              }\n\n              .action-title {\n                line-height: 24px;\n              }\n\n              .action-detail {\n                color: #5c5a5a;\n                font-size: 12px;\n                line-height: 26px;\n              }\n\n              .checked {\n                margin: 5px 0;\n                background: url(\"../images/tick.png\") no-repeat center center;\n                background-size: 15px;\n              }\n\n            }\n          }\n        }\n      }\n\n      .home-main {\n        padding: 0;\n        flex: 1;\n      }\n\n    }\n  }\n\n  .consult-customer-service {\n    position: fixed;\n    bottom: 40px;\n    left: 30px;\n    z-index: 10;\n    display: flex;\n    flex-direction: column;\n    width: 64px;\n    margin: 0 30px 26px 0;\n    box-sizing: border-box;\n    border-radius: 3px;\n  }\n\n  .consult-customer-service-avatar {\n    padding: 10px;\n    cursor: pointer;\n    border-radius: 100%;\n    transition: all 0.2s;\n    background: #D02129;\n  }\n\n  .consult-customer-service-avatar:hover {\n    transform: scale(1.1);\n  }\n</style>\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Home.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Home.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Home.vue?vue&type=template&id=2e79c718&scoped=true&\"\nimport script from \"./Home.vue?vue&type=script&lang=js&\"\nexport * from \"./Home.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Home.vue?vue&type=style&index=0&id=2e79c718&prod&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"2e79c718\",\n  null\n  \n)\n\nexport default component.exports","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar axios_1 = require(\"axios\");\nvar Http = (function () {\n    function Http(config) {\n        var _this = this;\n        this.config = config;\n        this.cookie_token_key = \"goeasy.token.\".concat(this.config.sso_cookie_suffix);\n        this.cookie_refresh_token_key = \"goeasy.refreshToken.\".concat(this.config.sso_cookie_suffix);\n        this.cookie_expiresAtMillis_key = \"goeasy.token.expiresAtMillis.\".concat(this.config.sso_cookie_suffix);\n        this.call = axios_1.default.create({\n            baseURL: '',\n            timeout: 60000\n        });\n        this.call.interceptors.request.use(function (config) {\n            _this.checkAndRefreshToken();\n            var token = _this.getAccessToken();\n            if (token) {\n                config.headers['Authorization'] = \"Bearer \" + token;\n            }\n            return config;\n        }, function (error) {\n            return Promise.reject(error);\n        });\n        this.call.interceptors.response.use(function (response) {\n            return response.data;\n        }, function (error) {\n            return Promise.reject(error);\n        });\n    }\n    Http.prototype.checkAndRefreshToken = function () {\n        var _this = this;\n        var xhr;\n        if (window.XMLHttpRequest) {\n            xhr = new XMLHttpRequest();\n        }\n        else {\n            xhr = new ActiveXObject(\"Microsoft.XMLHttp\");\n        }\n        var expiresAt = this.getExpiresAtMillis();\n        var currentTime = new Date().getTime();\n        if (xhr && expiresAt - currentTime < 3600 * 1000) {\n            var refreshToken = this.getRefreshToken();\n            xhr.open(\"post\", \"\".concat(this.config.sso_host, \"/refreshtoken\"), true);\n            xhr.setRequestHeader('content-type', 'application/x-www-form-urlencoded');\n            xhr.send(\"refreshToken=\" + refreshToken);\n            xhr.onreadystatechange = function () {\n                if (xhr.readyState === 4) {\n                    if (xhr.status === 200) {\n                        var result = JSON.parse(xhr.responseText);\n                        var newToken = result.token;\n                        var newRefreshToken = result.refreshToken;\n                        var expiresAtMillis = result.expiresAtMillis;\n                        _this.storeTokens(newToken, newRefreshToken, expiresAtMillis);\n                    }\n                    else {\n                    }\n                }\n                else {\n                }\n            };\n        }\n    };\n    Http.prototype.getExpiresAtMillis = function () {\n        return this.getCookie(this.cookie_expiresAtMillis_key);\n    };\n    Http.prototype.getAccessToken = function () {\n        return this.getCookie(\"goeasy.token.\".concat(this.config.sso_cookie_suffix));\n    };\n    Http.prototype.getRefreshToken = function () {\n        return this.getCookie(\"goeasy.refreshToken.\".concat(this.config.sso_cookie_suffix));\n    };\n    Http.prototype.storeTokens = function (token, refreshToken, expiresAtMillis) {\n        this.setCookie(this.cookie_token_key, token);\n        this.setCookie(this.cookie_refresh_token_key, refreshToken);\n        this.setCookie(this.cookie_expiresAtMillis_key, expiresAtMillis + \"\");\n    };\n    Http.prototype.setCookie = function (name, value) {\n        console.log(\"will set \" + name + \"with value: \" + value);\n        document.cookie = name + \"=\" + escape(value) + \";domain=goeasy.io\";\n    };\n    Http.prototype.getCookie = function (name) {\n        var arr, reg = new RegExp(\"(^| )\" + name + \"=([^;]*)(;|$)\");\n        if (arr = document.cookie.match(reg)) {\n            return unescape(arr[2]);\n        }\n        return null;\n    };\n    return Http;\n}());\nexports.default = Http;\n"],"sourceRoot":""}